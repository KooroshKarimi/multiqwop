!function(){var t={185:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2088),n=i(3216),r=i(1428),a=(i(2669),i(4474)),h=(i(7221),i(7191),i(6130)),m=i(3960),c=(i(2409),i(2219)),l=i(2355);m.addType(l.TYPE,c.TYPE,function(t,e,i,m,_,u,p){s&&o.assert(i.getType()==l.TYPE),s&&o.assert(u.getType()==c.TYPE),function(t,e,i,s,o){t.pointCount=0;for(var m=r.mulVec2(o,s.m_p),c=r.mulTVec2(i,m),l=0,_=-1/0,u=e.m_radius+s.m_radius,p=e.m_count,d=e.m_vertices,y=e.m_normals,f=0;f<p;++f){var v=a.dot(y[f],a.sub(c,d[f]));if(v>u)return;v>_&&(_=v,l=f)}var g=l,x=g+1<p?g+1:0,A=d[g],b=d[x];if(_<n.EPSILON)return t.pointCount=1,t.type=h.e_faceA,t.localNormal.set(y[l]),t.localPoint.setCombine(.5,A,.5,b),t.points[0].localPoint=s.m_p,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=h.e_vertex);var B=a.dot(a.sub(c,A),a.sub(b,A)),w=a.dot(a.sub(c,b),a.sub(A,b));if(B<=0){if(a.distanceSquared(c,A)>u*u)return;t.pointCount=1,t.type=h.e_faceA,t.localNormal.setCombine(1,c,-1,A),t.localNormal.normalize(),t.localPoint=A,t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}else if(w<=0){if(a.distanceSquared(c,b)>u*u)return;t.pointCount=1,t.type=h.e_faceA,t.localNormal.setCombine(1,c,-1,b),t.localNormal.normalize(),t.localPoint.set(b),t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}else{var S=a.mid(A,b);if((_=a.dot(c,y[g])-a.dot(S,y[g]))>u)return;t.pointCount=1,t.type=h.e_faceA,t.localNormal.set(y[g]),t.localPoint.set(S),t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}}(t,i.getShape(),e,u.getShape(),_)})},355:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=u;var s=i(4299),o=i(7191),n=i(3216),r=i(4474),a=i(905),h=(i(5154),i(4052)),m=i(2669),c=(i(4124),i(1428),i(9753),i(4529),i(5868)),l=i(8878);u.TYPE="weld-joint",c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var _={frequencyHz:0,dampingRatio:0};function u(t,e,i,o){if(!(this instanceof u))return new u(t,e,i,o);t=s(t,_),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_localAnchorA=r.clone(o?e.getLocalPoint(o):t.localAnchorA||r.zero()),this.m_localAnchorB=r.clone(o?i.getLocalPoint(o):t.localAnchorB||r.zero()),this.m_referenceAngle=n.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=a(),this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new h}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(l,t.bodyA,e),t.bodyB=i(l,t.bodyB,e),new u(t)},u.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},u.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},u.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},u.prototype.getReferenceAngle=function(){return this.m_referenceAngle},u.prototype.setFrequency=function(t){this.m_frequencyHz=t},u.prototype.getFrequency=function(){return this.m_frequencyHz},u.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},u.prototype.getDampingRatio=function(){return this.m_dampingRatio},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return r.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},u.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,l=m.neo(e),_=m.neo(o);this.m_rA=m.mulVec2(l,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=m.mulVec2(_,r.sub(this.m_localAnchorB,this.m_localCenterB));var u=this.m_invMassA,p=this.m_invMassB,d=this.m_invIA,y=this.m_invIB,f=new h;if(f.ex.x=u+p+this.m_rA.y*this.m_rA.y*d+this.m_rB.y*this.m_rB.y*y,f.ey.x=-this.m_rA.y*this.m_rA.x*d-this.m_rB.y*this.m_rB.x*y,f.ez.x=-this.m_rA.y*d-this.m_rB.y*y,f.ex.y=f.ey.x,f.ey.y=u+p+this.m_rA.x*this.m_rA.x*d+this.m_rB.x*this.m_rB.x*y,f.ez.y=this.m_rA.x*d+this.m_rB.x*y,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=d+y,this.m_frequencyHz>0){f.getInverse22(this.m_mass);var v=d+y,g=v>0?1/v:0,x=o-e-this.m_referenceAngle,A=2*n.PI*this.m_frequencyHz,b=2*g*this.m_dampingRatio*A,B=g*A*A,w=t.dt;this.m_gamma=w*(b+w*B),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=x*w*B*this.m_gamma,v+=this.m_gamma,this.m_mass.ez.z=0!=v?1/v:0}else 0==f.ez.z?(f.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(f.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var S=r.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(u,S),s-=d*(r.cross(this.m_rA,S)+this.m_impulse.z),a.addMul(p,S),c+=y*(r.cross(this.m_rB,S)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=c},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,l=this.m_invIB;if(this.m_frequencyHz>0){var _=o-i,u=-this.m_mass.ez.z*(_+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,i-=c*u,o+=l*u,(y=r.zero()).addCombine(1,s,1,r.cross(o,this.m_rB)),y.subCombine(1,e,1,r.cross(i,this.m_rA));var p=r.neg(h.mulVec2(this.m_mass,y));this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var d=r.clone(p);e.subMul(n,d),i-=c*r.cross(this.m_rA,d),s.addMul(m,d),o+=l*r.cross(this.m_rB,d)}else{var y;(y=r.zero()).addCombine(1,s,1,r.cross(o,this.m_rB)),y.subCombine(1,e,1,r.cross(i,this.m_rA)),_=o-i;var f=a(y.x,y.y,_),v=a.neg(h.mulVec3(this.m_mass,f));this.m_impulse.add(v),d=r.neo(v.x,v.y),e.subMul(n,d),i-=c*(r.cross(this.m_rA,d)+v.z),s.addMul(m,d),o+=l*(r.cross(this.m_rB,d)+v.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){var e,i,s=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,l=this.m_bodyB.c_position.c,_=this.m_bodyB.c_position.a,u=m.neo(c),p=m.neo(_),d=this.m_invMassA,y=this.m_invMassB,f=this.m_invIA,v=this.m_invIB,g=m.mulVec2(u,r.sub(this.m_localAnchorA,this.m_localCenterA)),x=m.mulVec2(p,r.sub(this.m_localAnchorB,this.m_localCenterB)),A=new h;if(A.ex.x=d+y+g.y*g.y*f+x.y*x.y*v,A.ey.x=-g.y*g.x*f-x.y*x.x*v,A.ez.x=-g.y*f-x.y*v,A.ex.y=A.ey.x,A.ey.y=d+y+g.x*g.x*f+x.x*x.x*v,A.ez.y=g.x*f+x.x*v,A.ex.z=A.ez.x,A.ey.z=A.ez.y,A.ez.z=f+v,this.m_frequencyHz>0){(B=r.zero()).addCombine(1,l,1,x),B.subCombine(1,s,1,g),e=B.length(),i=0;var b=r.neg(A.solve22(B));s.subMul(d,b),c-=f*r.cross(g,b),l.addMul(y,b),_+=v*r.cross(x,b)}else{var B;(B=r.zero()).addCombine(1,l,1,x),B.subCombine(1,s,1,g);var w=_-c-this.m_referenceAngle;e=B.length(),i=n.abs(w);var S=a(B.x,B.y,w),M=a();if(A.ez.z>0)M=a.neg(A.solve33(S));else{var C=r.neg(A.solve22(B));M.set(C.x,C.y,0)}b=r.neo(M.x,M.y),s.subMul(d,b),c-=f*(r.cross(g,b)+M.z),l.addMul(y,b),_+=v*(r.cross(x,b)+M.z)}return this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=c,this.m_bodyB.c_position.c=l,this.m_bodyB.c_position.a=_,e<=o.linearSlop&&i<=o.angularSlop}},905:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(2088),r=i(3216);function a(t,e,i){if(!(this instanceof a))return new a(t,e,i);void 0===t?(this.x=0,this.y=0,this.z=0):"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),o&&a.assert(this)}a.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},a._deserialize=function(t){var e=Object.create(a.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e},a.neo=function(t,e,i){var s=Object.create(a.prototype);return s.x=t,s.y=e,s.z=i,s},a.clone=function(t){return o&&a.assert(t),a.neo(t.x,t.y,t.z)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isFinite(t.x)&&r.isFinite(t.y)&&r.isFinite(t.z)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Vec3!")},a.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},a.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},a.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},a.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},a.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},a.areEqual=function(t,e){return o&&a.assert(t),o&&a.assert(e),t==e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},a.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},a.cross=function(t,e){return new a(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},a.add=function(t,e){return new a(t.x+e.x,t.y+e.y,t.z+e.z)},a.sub=function(t,e){return new a(t.x-e.x,t.y-e.y,t.z-e.z)},a.mul=function(t,e){return new a(e*t.x,e*t.y,e*t.z)},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.neg=function(t){return new a(-t.x,-t.y,-t.z)}},919:function(t){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=function(t){var e=[],i=t.max||1/0,s=t.create,o=t.allocate,n=t.release,r=t.discard,a=0,h=0,m=0,c=0;this.max=function(t){return"number"==typeof t?(i=t,this):i},this.size=function(){return e.length},this.allocate=function(){var t;return e.length>0?t=e.shift():(a++,t="function"==typeof s?s():{}),h++,"function"==typeof o&&o(t),t},this.release=function(t){e.length<i?(m++,"function"==typeof n&&n(t),e.push(t)):(c++,"function"==typeof r&&(t=r(t)))},this.toString=function(){return" +"+a+" >"+h+" <"+m+" -"+c+" ="+e.length+"/"+i}}},1158:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=p;var o=i(2088),n=i(4299),r=i(3216),a=i(4474),h=(i(905),i(5154)),m=(i(4052),i(2669)),c=(i(4124),i(1428)),l=(i(9753),i(4529),i(5868)),_=i(8878);p.TYPE="mouse-joint",l.TYPES[p.TYPE]=p,p._super=l,p.prototype=Object.create(p._super.prototype);var u={maxForce:0,frequencyHz:5,dampingRatio:.7};function p(t,e,i,m){if(!(this instanceof p))return new p(t,e,i,m);t=n(t,u),l.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=p.TYPE,s&&o.assert(r.isFinite(t.maxForce)&&t.maxForce>=0),s&&o.assert(r.isFinite(t.frequencyHz)&&t.frequencyHz>=0),s&&o.assert(r.isFinite(t.dampingRatio)&&t.dampingRatio>=0),this.m_targetA=m?a.clone(m):t.target||a.zero(),this.m_localAnchorB=c.mulTVec2(i.getTransform(),this.m_targetA),this.m_maxForce=t.maxForce,this.m_impulse=a.zero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=a.zero(),this.m_localCenterB=a.zero(),this.m_invMassB=0,this.m_invIB=0,this.mass=new h,this.m_C=a.zero()}p.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},p._deserialize=function(t,e,i){(t=Object.assign({},t)).bodyA=i(_,t.bodyA,e),t.bodyB=i(_,t.bodyB,e),t.target=a(t.target);var s=new p(t);return t._localAnchorB&&(s.m_localAnchorB=t._localAnchorB),s},p.prototype.setTarget=function(t){0==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=a.clone(t)},p.prototype.getTarget=function(){return this.m_targetA},p.prototype.setMaxForce=function(t){this.m_maxForce=t},p.getMaxForce=function(){return this.m_maxForce},p.prototype.setFrequency=function(t){this.m_frequencyHz=t},p.prototype.getFrequency=function(){return this.m_frequencyHz},p.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},p.prototype.getDampingRatio=function(){return this.m_dampingRatio},p.prototype.getAnchorA=function(){return a.clone(this.m_targetA)},p.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},p.prototype.getReactionForce=function(t){return a.mul(t,this.m_impulse)},p.prototype.getReactionTorque=function(t){return 0*t},p.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},p.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,n=e.c,c=e.a,l=i.v,_=i.w,u=m.neo(c),p=this.m_bodyB.getMass(),d=2*r.PI*this.m_frequencyHz,y=2*p*this.m_dampingRatio*d,f=p*(d*d),v=t.dt;s&&o.assert(y+v*f>r.EPSILON),this.m_gamma=v*(y+v*f),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=v*f*this.m_gamma,this.m_rB=m.mulVec2(u,a.sub(this.m_localAnchorB,this.m_localCenterB));var g=new h;g.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,g.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,g.ey.x=g.ex.y,g.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=g.getInverse(),this.m_C.set(n),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),_*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),l.addMul(this.m_invMassB,this.m_impulse),_+=this.m_invIB*a.cross(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.set(l),i.w=_},p.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=a.clone(e.v),s=e.w,o=a.cross(s,this.m_rB);o.add(i),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();var n=h.mulVec2(this.m_mass,o),r=a.clone(this.m_impulse);this.m_impulse.add(n);var m=t.dt*this.m_maxForce;this.m_impulse.clamp(m),n=a.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),s+=this.m_invIB*a.cross(this.m_rB,n),e.v.set(i),e.w=s},p.prototype.solvePositionConstraints=function(t){return!0}},1428:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var n=i(2088),r=i(4474),a=i(2669);function h(t,e){if(!(this instanceof h))return new h(t,e);this.p=r.zero(),this.q=a.identity(),void 0!==t&&this.p.set(t),void 0!==e&&this.q.set(e)}h.clone=function(t){var e=Object.create(h.prototype);return e.p=r.clone(t.p),e.q=a.clone(t.q),e},h.neo=function(t,e){var i=Object.create(h.prototype);return i.p=r.clone(t),i.q=a.clone(e),i},h.identity=function(){var t=Object.create(h.prototype);return t.p=r.zero(),t.q=a.identity(),t},h.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},h.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},h.isValid=function(t){return t&&r.isValid(t.p)&&a.isValid(t.q)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid Transform!")},h.mul=function(t,e){if(o&&h.assert(t),Array.isArray(e)){for(var i=[],s=0;s<e.length;s++)i[s]=h.mul(t,e[s]);return i}if("x"in e&&"y"in e){o&&r.assert(e);var n=t.q.c*e.x-t.q.s*e.y+t.p.x,m=t.q.s*e.x+t.q.c*e.y+t.p.y;return r.neo(n,m)}if("p"in e&&"q"in e){o&&h.assert(e);var c=h.identity();return c.q=a.mulRot(t.q,e.q),c.p=r.add(a.mulVec2(t.q,e.p),t.p),c}},h.mulAll=function(t,e){o&&h.assert(t);for(var i=[],s=0;s<e.length;s++)i[s]=h.mul(t,e[s]);return i},h.mulFn=function(t){return o&&h.assert(t),function(e){return h.mul(t,e)}},h.mulVec2=function(t,e){o&&h.assert(t),o&&r.assert(e);var i=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return r.neo(i,s)},h.mulXf=function(t,e){o&&h.assert(t),o&&h.assert(e);var i=h.identity();return i.q=a.mulRot(t.q,e.q),i.p=r.add(a.mulVec2(t.q,e.p),t.p),i},h.mulT=function(t,e){if(o&&h.assert(t),"x"in e&&"y"in e){o&&r.assert(e);var i=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*i+t.q.s*s,m=-t.q.s*i+t.q.c*s;return r.neo(n,m)}if("p"in e&&"q"in e){o&&h.assert(e);var c=h.identity();return c.q.set(a.mulTRot(t.q,e.q)),c.p.set(a.mulTVec2(t.q,r.sub(e.p,t.p))),c}},h.mulTVec2=function(t,e){o&&h.assert(t),o&&r.assert(e);var i=e.x-t.p.x,s=e.y-t.p.y,n=t.q.c*i+t.q.s*s,a=-t.q.s*i+t.q.c*s;return r.neo(n,a)},h.mulTXf=function(t,e){o&&h.assert(t),o&&h.assert(e);var i=h.identity();return i.q.set(a.mulTRot(t.q,e.q)),i.p.set(a.mulTVec2(t.q,r.sub(e.p,t.p))),i}},2088:function(t,e){var i="undefined"!=typeof DEBUG&&DEBUG,s="undefined"!=typeof ASSERT&&ASSERT;e.debug=function(){i&&console.log.apply(console,arguments)},e.assert=function(t,e,i){if(s&&!t)throw i&&console.log(i),new Error(e)}},2219:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=m;var o=i(2088),n=(i(4299),i(3216)),r=(i(1428),i(2669)),a=i(4474),h=(i(7221),i(7191),i(2409));function m(t,e){if(!(this instanceof m))return new m(t,e);m._super.call(this),this.m_type=m.TYPE,this.m_p=a.zero(),this.m_radius=1,"object"==typeof t&&a.isValid(t)?(this.m_p.set(t),"number"==typeof e&&(this.m_radius=e)):"number"==typeof t&&(this.m_radius=t)}m._super=h,m.prototype=Object.create(m._super.prototype),m.TYPE="circle",h.TYPES[m.TYPE]=m,m.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},m._deserialize=function(t){return new m(t.p,t.radius)},m.prototype.getRadius=function(){return this.m_radius},m.prototype.getCenter=function(){return this.m_p},m.prototype.getVertex=function(t){return s&&o.assert(0==t),this.m_p},m.prototype.getVertexCount=function(t){return 1},m.prototype._clone=function(){var t=new m;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},m.prototype.getChildCount=function(){return 1},m.prototype.testPoint=function(t,e){var i=a.add(t.p,r.mulVec2(t.q,this.m_p)),s=a.sub(e,i);return a.dot(s,s)<=this.m_radius*this.m_radius},m.prototype.rayCast=function(t,e,i,s){var o=a.add(i.p,r.mulVec2(i.q,this.m_p)),h=a.sub(e.p1,o),m=a.dot(h,h)-this.m_radius*this.m_radius,c=a.sub(e.p2,e.p1),l=a.dot(h,c),_=a.dot(c,c),u=l*l-_*m;if(u<0||_<n.EPSILON)return!1;var p=-(l+n.sqrt(u));return 0<=p&&p<=e.maxFraction*_&&(p/=_,t.fraction=p,t.normal=a.add(h,a.mul(p,c)),t.normal.normalize(),!0)},m.prototype.computeAABB=function(t,e,i){var s=a.add(e.p,r.mulVec2(e.q,this.m_p));t.lowerBound.set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.set(s.x+this.m_radius,s.y+this.m_radius)},m.prototype.computeMass=function(t,e){t.mass=e*n.PI*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+a.dot(this.m_p,this.m_p))},m.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},2238:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=c;var o=i(2088),n=(i(4299),i(3216),i(1428)),r=(i(2669),i(4474)),a=(i(7221),i(7191)),h=i(2409),m=i(4560);function c(t,e){if(!(this instanceof c))return new c(t,e);c._super.call(this),this.m_type=c.TYPE,this.m_radius=a.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_isLoop=e,t&&t.length&&(e?this._createLoop(t):this._createChain(t))}c._super=h,c.prototype=Object.create(c._super.prototype),c.TYPE="chain",h.TYPES[c.TYPE]=c,c.prototype._serialize=function(){const t={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},c._deserialize=function(t,e,i){var s=[];if(t.vertices)for(var o=0;o<t.vertices.length;o++)s.push(i(r,t.vertices[o]));var n=new c(s,t.isLoop);return t.prevVertex&&n.setPrevVertex(t.prevVertex),t.nextVertex&&n.setNextVertex(t.nextVertex),n},c.prototype._createLoop=function(t){s&&o.assert(0==this.m_vertices.length&&0==this.m_count),s&&o.assert(t.length>=3);for(var e=1;e<t.length;++e){var i=t[e-1],n=t[e];s&&o.assert(r.distanceSquared(i,n)>a.linearSlopSquared)}for(this.m_vertices=[],this.m_count=t.length+1,e=0;e<t.length;++e)this.m_vertices[e]=r.clone(t[e]);return this.m_vertices[t.length]=r.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},c.prototype._createChain=function(t){s&&o.assert(0==this.m_vertices.length&&0==this.m_count),s&&o.assert(t.length>=2);for(var e=1;e<t.length;++e){var i=t[e-1],n=t[e];s&&o.assert(r.distanceSquared(i,n)>a.linearSlopSquared)}for(this.m_count=t.length,e=0;e<t.length;++e)this.m_vertices[e]=r.clone(t[e]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},c.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},c.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},c.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},c.prototype._clone=function(){var t=new c;return t.createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},c.prototype.getChildCount=function(){return this.m_count-1},c.prototype.getChildEdge=function(t,e){s&&o.assert(0<=e&&e<this.m_count-1),t.m_type=m.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},c.prototype.getVertex=function(t){return s&&o.assert(0<=t&&t<=this.m_count),t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},c.prototype.testPoint=function(t,e){return!1},c.prototype.rayCast=function(t,e,i,n){return s&&o.assert(0<=n&&n<this.m_count),new m(this.getVertex(n),this.getVertex(n+1)).rayCast(t,e,i,0)},c.prototype.computeAABB=function(t,e,i){s&&o.assert(0<=i&&i<this.m_count);var r=n.mulVec2(e,this.getVertex(i)),a=n.mulVec2(e,this.getVertex(i+1));t.combinePoints(r,a)},c.prototype.computeMass=function(t,e){t.mass=0,t.center=r.neo(),t.I=0},c.prototype.computeDistanceProxy=function(t,e){s&&o.assert(0<=e&&e<this.m_count),t.m_buffer[0]=this.getVertex(e),t.m_buffer[1]=this.getVertex(e+1),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius}},2355:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=l;var o=i(2088),n=(i(4299),i(3216)),r=i(1428),a=i(2669),h=i(4474),m=(i(7221),i(7191)),c=i(2409);function l(t){if(!(this instanceof l))return new l(t);l._super.call(this),this.m_type=l.TYPE,this.m_radius=m.polygonRadius,this.m_centroid=h.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,t&&t.length&&this._set(t)}l._super=c,l.prototype=Object.create(l._super.prototype),l.TYPE="polygon",c.TYPES[l.TYPE]=l,l.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},l._deserialize=function(t,e,i){var s=[];if(t.vertices)for(var o=0;o<t.vertices.length;o++)s.push(i(h,t.vertices[o]));return new l(s)},l.prototype.getVertex=function(t){return s&&o.assert(0<=t&&t<this.m_count),this.m_vertices[t]},l.prototype._clone=function(){var t=new l;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.set(this.m_centroid);for(var e=0;e<this.m_count;e++)t.m_vertices.push(this.m_vertices[e].clone());for(e=0;e<this.m_normals.length;e++)t.m_normals.push(this.m_normals[e].clone());return t},l.prototype.getChildCount=function(){return 1},l.prototype._reset=function(){this._set(this.m_vertices)},l.prototype._set=function(t){if(s&&o.assert(3<=t.length&&t.length<=m.maxPolygonVertices),t.length<3)this._setAsBox(1,1);else{for(var e=n.min(t.length,m.maxPolygonVertices),i=[],r=0;r<e;++r){for(var a=t[r],c=!0,l=0;l<i.length;++l)if(h.distanceSquared(a,i[l])<.25*m.linearSlopSquared){c=!1;break}c&&i.push(a)}if((e=i.length)<3)return s&&o.assert(!1),void this._setAsBox(1,1);var _=0,u=i[0].x;for(r=1;r<e;++r){var p=i[r].x;(p>u||p===u&&i[r].y<i[_].y)&&(_=r,u=p)}for(var d=[],y=0,f=_;;){d[y]=f;var v=0;for(l=1;l<e;++l)if(v!==f){var g=h.sub(i[v],i[d[y]]),x=(a=h.sub(i[l],i[d[y]]),h.cross(g,a));x<0&&(v=l),0===x&&a.lengthSquared()>g.lengthSquared()&&(v=l)}else v=l;if(++y,f=v,v===_)break}if(y<3)return s&&o.assert(!1),void this._setAsBox(1,1);for(this.m_count=y,this.m_vertices=[],r=0;r<y;++r)this.m_vertices[r]=i[d[r]];for(r=0;r<y;++r){var A=r,b=r+1<y?r+1:0,B=h.sub(this.m_vertices[b],this.m_vertices[A]);s&&o.assert(B.lengthSquared()>n.EPSILON*n.EPSILON),this.m_normals[r]=h.cross(B,1),this.m_normals[r].normalize()}this.m_centroid=function(t,e){s&&o.assert(e>=3);for(var i=h.zero(),r=0,a=h.zero(),m=1/3,c=0;c<e;++c){var l=a,_=t[c],u=c+1<e?t[c+1]:t[0],p=h.sub(_,l),d=h.sub(u,l),y=.5*h.cross(p,d);r+=y,i.addMul(y*m,l),i.addMul(y*m,_),i.addMul(y*m,u)}return s&&o.assert(r>n.EPSILON),i.mul(1/r),i}(this.m_vertices,y)}},l.prototype._setAsBox=function(t,e,i,s){if(this.m_vertices[0]=h.neo(t,-e),this.m_vertices[1]=h.neo(t,e),this.m_vertices[2]=h.neo(-t,e),this.m_vertices[3]=h.neo(-t,-e),this.m_normals[0]=h.neo(1,0),this.m_normals[1]=h.neo(0,1),this.m_normals[2]=h.neo(-1,0),this.m_normals[3]=h.neo(0,-1),this.m_count=4,h.isValid(i)){s=s||0,this.m_centroid.set(i);var o=r.identity();o.p.set(i),o.q.set(s);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=r.mulVec2(o,this.m_vertices[n]),this.m_normals[n]=a.mulVec2(o.q,this.m_normals[n])}},l.prototype.testPoint=function(t,e){for(var i=a.mulTVec2(t.q,h.sub(e,t.p)),s=0;s<this.m_count;++s)if(h.dot(this.m_normals[s],h.sub(i,this.m_vertices[s]))>0)return!1;return!0},l.prototype.rayCast=function(t,e,i,n){for(var r=a.mulTVec2(i.q,h.sub(e.p1,i.p)),m=a.mulTVec2(i.q,h.sub(e.p2,i.p)),c=h.sub(m,r),l=0,_=e.maxFraction,u=-1,p=0;p<this.m_count;++p){var d=h.dot(this.m_normals[p],h.sub(this.m_vertices[p],r)),y=h.dot(this.m_normals[p],c);if(0==y){if(d<0)return!1}else y<0&&d<l*y?(l=d/y,u=p):y>0&&d<_*y&&(_=d/y);if(_<l)return!1}return s&&o.assert(0<=l&&l<=e.maxFraction),u>=0&&(t.fraction=l,t.normal=a.mulVec2(i.q,this.m_normals[u]),!0)},l.prototype.computeAABB=function(t,e,i){for(var s=1/0,o=1/0,a=-1/0,h=-1/0,m=0;m<this.m_count;++m){var c=r.mulVec2(e,this.m_vertices[m]);s=n.min(s,c.x),a=n.max(a,c.x),o=n.min(o,c.y),h=n.max(h,c.y)}t.lowerBound.set(s,o),t.upperBound.set(a,h),t.extend(this.m_radius)},l.prototype.computeMass=function(t,e){s&&o.assert(this.m_count>=3);for(var i=h.zero(),r=0,a=0,m=h.zero(),c=0;c<this.m_count;++c)m.add(this.m_vertices[c]);m.mul(1/this.m_count);var l=1/3;for(c=0;c<this.m_count;++c){var _=h.sub(this.m_vertices[c],m),u=c+1<this.m_count?h.sub(this.m_vertices[c+1],m):h.sub(this.m_vertices[0],m),p=h.cross(_,u),d=.5*p;r+=d,i.addCombine(d*l,_,d*l,u);var y=_.x,f=_.y,v=u.x,g=u.y;a+=.25*l*p*(y*y+v*y+v*v+(f*f+g*f+g*g))}t.mass=e*r,s&&o.assert(r>n.EPSILON),i.mul(1/r),t.center.setCombine(1,i,1,m),t.I=e*a,t.I+=t.mass*(h.dot(t.center,t.center)-h.dot(i,i))},l.prototype.validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=t<this.m_count-1?e+1:0,s=this.m_vertices[e],o=h.sub(this.m_vertices[i],s),n=0;n<this.m_count;++n)if(n!=e&&n!=i){var r=h.sub(this.m_vertices[n],s);if(h.cross(o,r)<0)return!1}return!0},l.prototype.computeDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},2409:function(t,e,i){function s(){this.m_type,this.m_radius}"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=s,i(3216),s.prototype._reset=function(){},s.prototype._serialize=function(){return{}},s.TYPES={},s._deserialize=function(t,e,i){var o=s.TYPES[t.type];return o&&i(o,t)},s.isValid=function(t){return!!t},s.prototype.getRadius=function(){return this.m_radius},s.prototype.getType=function(){return this.m_type},s.prototype._clone=function(){},s.prototype.getChildCount=function(){},s.prototype.testPoint=function(t,e){},s.prototype.rayCast=function(t,e,i,s){},s.prototype.computeAABB=function(t,e,i){},s.prototype.computeMass=function(t,e){},s.prototype.computeDistanceProxy=function(t){}},2669:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var n=i(2088),r=i(4474),a=i(3216);function h(t){if(!(this instanceof h))return new h(t);"number"==typeof t?this.setAngle(t):"object"==typeof t?this.set(t):this.setIdentity()}h.neo=function(t){var e=Object.create(h.prototype);return e.setAngle(t),e},h.clone=function(t){o&&h.assert(t);var e=Object.create(h.prototype);return e.s=t.s,e.c=t.c,e},h.identity=function(){var t=Object.create(h.prototype);return t.s=0,t.c=1,t},h.isValid=function(t){return t&&a.isFinite(t.s)&&a.isFinite(t.c)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid Rot!")},h.prototype.setIdentity=function(){this.s=0,this.c=1},h.prototype.set=function(t){"object"==typeof t?(o&&h.assert(t),this.s=t.s,this.c=t.c):(o&&a.assert(t),this.s=a.sin(t),this.c=a.cos(t))},h.prototype.setAngle=function(t){o&&a.assert(t),this.s=a.sin(t),this.c=a.cos(t)},h.prototype.getAngle=function(){return a.atan2(this.s,this.c)},h.prototype.getXAxis=function(){return r.neo(this.c,this.s)},h.prototype.getYAxis=function(){return r.neo(-this.s,this.c)},h.mul=function(t,e){if(o&&h.assert(t),"c"in e&&"s"in e){o&&h.assert(e);var i=h.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i}if("x"in e&&"y"in e)return o&&r.assert(e),r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},h.mulRot=function(t,e){o&&h.assert(t),o&&h.assert(e);var i=h.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i},h.mulVec2=function(t,e){return o&&h.assert(t),o&&r.assert(e),r.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},h.mulSub=function(t,e,i){var s=t.c*(e.x-i.x)-t.s*(e.y-i.y),o=t.s*(e.x-i.x)+t.c*(e.y-i.y);return r.neo(s,o)},h.mulT=function(t,e){if("c"in e&&"s"in e){o&&h.assert(e);var i=h.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i}if("x"in e&&"y"in e)return o&&r.assert(e),r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},h.mulTRot=function(t,e){o&&h.assert(e);var i=h.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i},h.mulTVec2=function(t,e){return o&&r.assert(e),r.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}},3216:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT,n=i(2088),r=Math,a=t.exports=Object.create(r);a.EPSILON=1e-9,a.isFinite=function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},a.assert=function(t){if(o&&!a.isFinite(t))throw s&&n.debug(t),new Error("Invalid Number!")},a.invSqrt=function(t){return 1/r.sqrt(t)},a.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)},a.isPowerOfTwo=function(t){return t>0&&!(t&t-1)},a.mod=function(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)},a.clamp=function(t,e,i){return t<e?e:t>i?i:t},a.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t==e?t:r.random()*(e-t)+t}},3627:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2088),n=i(3216),r=i(1428),a=i(4474),h=i(2669),m=i(7191),c=(i(2409),i(3960)),l=i(6130),_=i(4560),u=i(2238),p=i(2355);c.addType(_.TYPE,p.TYPE,function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==_.TYPE),s&&o.assert(a.getType()==p.TYPE),B(t,i.getShape(),e,a.getShape(),r)}),c.addType(u.TYPE,p.TYPE,function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==u.TYPE),s&&o.assert(a.getType()==p.TYPE);var m=i.getShape(),c=new _;m.getChildEdge(c,n),B(t,c,e,a.getShape(),r)});var d=-1,y=1,f=2;function v(){this.type,this.index,this.separation}var g=new v,x=new v,A=new function(){this.vertices=[],this.normals=[],this.count=0},b=new function(){this.i1,this.i2,this.v1,this.v2,this.normal=a.zero(),this.sideNormal1=a.zero(),this.sideOffset1,this.sideNormal2=a.zero(),this.sideOffset2};function B(t,e,i,s,o){var c=r.mulTXf(i,o),_=r.mulVec2(c,s.m_centroid),u=e.m_vertex0,p=e.m_vertex1,v=e.m_vertex2,B=e.m_vertex3,w=e.m_hasVertex0,S=e.m_hasVertex3,M=a.sub(v,p);M.normalize();var C,I=a.neo(M.y,-M.x),T=a.dot(I,a.sub(_,p)),P=0,E=0,z=!1,V=!1;if(w){var L=a.sub(p,u);L.normalize();var F=a.neo(L.y,-L.x);z=a.cross(L,M)>=0,P=a.dot(F,_)-a.dot(F,u)}if(S){var D=a.sub(B,v);D.normalize();var k=a.neo(D.y,-D.x);V=a.cross(M,D)>0,E=a.dot(k,_)-a.dot(k,v)}var R=a.zero(),q=a.zero(),j=a.zero();w&&S?z&&V?(C=P>=0||T>=0||E>=0)?(R.set(I),q.set(F),j.set(k)):(R.setMul(-1,I),q.setMul(-1,I),j.setMul(-1,I)):z?(C=P>=0||T>=0&&E>=0)?(R.set(I),q.set(F),j.set(I)):(R.setMul(-1,I),q.setMul(-1,k),j.setMul(-1,I)):V?(C=E>=0||P>=0&&T>=0)?(R.set(I),q.set(I),j.set(k)):(R.setMul(-1,I),q.setMul(-1,I),j.setMul(-1,F)):(C=P>=0&&T>=0&&E>=0)?(R.set(I),q.set(I),j.set(I)):(R.setMul(-1,I),q.setMul(-1,k),j.setMul(-1,F)):w?z?(C=P>=0||T>=0)?(R.set(I),q.set(F),j.setMul(-1,I)):(R.setMul(-1,I),q.set(I),j.setMul(-1,I)):(C=P>=0&&T>=0)?(R.set(I),q.set(I),j.setMul(-1,I)):(R.setMul(-1,I),q.set(I),j.setMul(-1,F)):S?V?(C=T>=0||E>=0)?(R.set(I),q.setMul(-1,I),j.set(k)):(R.setMul(-1,I),q.setMul(-1,I),j.set(I)):(C=T>=0&&E>=0)?(R.set(I),q.setMul(-1,I),j.set(I)):(R.setMul(-1,I),q.setMul(-1,k),j.set(I)):(C=T>=0)?(R.set(I),q.setMul(-1,I),j.setMul(-1,I)):(R.setMul(-1,I),q.set(I),j.set(I)),A.count=s.m_count;for(var G=0;G<s.m_count;++G)A.vertices[G]=r.mulVec2(c,s.m_vertices[G]),A.normals[G]=h.mulVec2(c.q,s.m_normals[G]);var O=2*m.polygonRadius;for(t.pointCount=0,g.type=y,g.index=C?0:1,g.separation=1/0,G=0;G<A.count;++G)(N=a.dot(R,a.sub(A.vertices[G],p)))<g.separation&&(g.separation=N);if(g.type!=d&&!(g.separation>O)){x.type=d,x.index=-1,x.separation=-1/0;var U=a.neo(-R.y,R.x);for(G=0;G<A.count;++G){var N,Y=a.neg(A.normals[G]),J=a.dot(Y,a.sub(A.vertices[G],p)),H=a.dot(Y,a.sub(A.vertices[G],v));if((N=n.min(J,H))>O){x.type=f,x.index=G,x.separation=N;break}if(a.dot(Y,U)>=0){if(a.dot(a.sub(Y,j),R)<-m.angularSlop)continue}else if(a.dot(a.sub(Y,q),R)<-m.angularSlop)continue;N>x.separation&&(x.type=f,x.index=G,x.separation=N)}if(!(x.type!=d&&x.separation>O)){var W;W=x.type==d?g:x.separation>.98*g.separation+.001?x:g;var K=[new l.clipVertex,new l.clipVertex];if(W.type==y){t.type=l.e_faceA;var Z=0,X=a.dot(R,A.normals[0]);for(G=1;G<A.count;++G){var $=a.dot(R,A.normals[G]);$<X&&(X=$,Z=G)}var Q=Z,tt=Q+1<A.count?Q+1:0;K[0].v=A.vertices[Q],K[0].id.cf.indexA=0,K[0].id.cf.indexB=Q,K[0].id.cf.typeA=l.e_face,K[0].id.cf.typeB=l.e_vertex,K[1].v=A.vertices[tt],K[1].id.cf.indexA=0,K[1].id.cf.indexB=tt,K[1].id.cf.typeA=l.e_face,K[1].id.cf.typeB=l.e_vertex,C?(b.i1=0,b.i2=1,b.v1=p,b.v2=v,b.normal.set(I)):(b.i1=1,b.i2=0,b.v1=v,b.v2=p,b.normal.setMul(-1,I))}else t.type=l.e_faceB,K[0].v=p,K[0].id.cf.indexA=0,K[0].id.cf.indexB=W.index,K[0].id.cf.typeA=l.e_vertex,K[0].id.cf.typeB=l.e_face,K[1].v=v,K[1].id.cf.indexA=0,K[1].id.cf.indexB=W.index,K[1].id.cf.typeA=l.e_vertex,K[1].id.cf.typeB=l.e_face,b.i1=W.index,b.i2=b.i1+1<A.count?b.i1+1:0,b.v1=A.vertices[b.i1],b.v2=A.vertices[b.i2],b.normal.set(A.normals[b.i1]);b.sideNormal1.set(b.normal.y,-b.normal.x),b.sideNormal2.setMul(-1,b.sideNormal1),b.sideOffset1=a.dot(b.sideNormal1,b.v1),b.sideOffset2=a.dot(b.sideNormal2,b.v2);var et=[new l.clipVertex,new l.clipVertex],it=[new l.clipVertex,new l.clipVertex];if(!(l.clipSegmentToLine(et,K,b.sideNormal1,b.sideOffset1,b.i1)<m.maxManifoldPoints||l.clipSegmentToLine(it,et,b.sideNormal2,b.sideOffset2,b.i2)<m.maxManifoldPoints)){W.type==y?(t.localNormal=a.clone(b.normal),t.localPoint=a.clone(b.v1)):(t.localNormal=a.clone(s.m_normals[b.i1]),t.localPoint=a.clone(s.m_vertices[b.i1]));var st=0;for(G=0;G<m.maxManifoldPoints;++G)if(a.dot(b.normal,a.sub(it[G].v,b.v1))<=O){var ot=t.points[st];W.type==y?(ot.localPoint=r.mulT(c,it[G].v),ot.id=it[G].id):(ot.localPoint=it[G].v,ot.id.cf.typeA=it[G].id.cf.typeB,ot.id.cf.typeB=it[G].id.cf.typeA,ot.id.cf.indexA=it[G].id.cf.indexB,ot.id.cf.indexB=it[G].id.cf.indexA),++st}t.pointCount=st}}}}},3933:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2088),n=(i(3216),i(1428)),r=i(4474),a=(i(2669),i(7191),i(2409),i(3960)),h=i(6130),m=i(4560),c=i(2238),l=i(2219);function _(t,e,i,a,m){t.pointCount=0;var c=n.mulTVec2(i,n.mulVec2(m,a.m_p)),l=e.m_vertex1,_=e.m_vertex2,u=r.sub(_,l),p=r.dot(u,r.sub(_,c)),d=r.dot(u,r.sub(c,l)),y=e.m_radius+a.m_radius;if(d<=0){var f=r.clone(l),v=r.sub(c,f);if(r.dot(v,v)>y*y)return;if(e.m_hasVertex0){var g=e.m_vertex0,x=l,A=r.sub(x,g);if(r.dot(A,r.sub(x,c))>0)return}return t.type=h.e_circles,t.localNormal.setZero(),t.localPoint.set(f),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=h.e_vertex)}if(p<=0){if(f=r.clone(_),v=r.sub(c,f),r.dot(v,v)>y*y)return;if(e.m_hasVertex3){var b=e.m_vertex3,B=_,w=r.sub(b,B);if(r.dot(w,r.sub(c,B))>0)return}return t.type=h.e_circles,t.localNormal.setZero(),t.localPoint.set(f),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=1,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,void(t.points[0].id.cf.typeB=h.e_vertex)}var S=r.dot(u,u);if(s&&o.assert(S>0),f=r.combine(p/S,l,d/S,_),v=r.sub(c,f),!(r.dot(v,v)>y*y)){var M=r.neo(-u.y,u.x);r.dot(M,r.sub(c,l))<0&&M.set(-M.x,-M.y),M.normalize(),t.type=h.e_faceA,t.localNormal=M,t.localPoint.set(l),t.pointCount=1,t.points[0].localPoint.set(a.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_face,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}}a.addType(m.TYPE,l.TYPE,function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==m.TYPE),s&&o.assert(a.getType()==l.TYPE),_(t,i.getShape(),e,a.getShape(),r)}),a.addType(c.TYPE,l.TYPE,function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==c.TYPE),s&&o.assert(a.getType()==l.TYPE);var u=i.getShape(),p=new m;u.getChildEdge(p,n),_(t,p,e,a.getShape(),r)})},3960:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2088),n=i(3216),r=i(4474),a=i(1428),h=i(5154),m=i(2669),c=i(7191),l=i(6130),_=i(9352);function u(t){this.contact=t,this.prev,this.next,this.other}function p(t,e,i,s,o){this.m_nodeA=new u(this),this.m_nodeB=new u(this),this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=o,this.m_manifold=new l,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=y(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=f(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution),this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.v_points=[],this.v_normal=r.zero(),this.v_normalMass=new h,this.v_K=new h,this.v_pointCount,this.v_tangentSpeed,this.v_friction,this.v_restitution,this.v_invMassA,this.v_invMassB,this.v_invIA,this.v_invIB,this.p_localPoints=[],this.p_localNormal=r.zero(),this.p_localPoint=r.zero(),this.p_localCenterA=r.zero(),this.p_localCenterB=r.zero(),this.p_type,this.p_radiusA,this.p_radiusB,this.p_pointCount,this.p_invMassA,this.p_invMassB,this.p_invIA,this.p_invIB}function d(){this.rA=r.zero(),this.rB=r.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}function y(t,e){return n.sqrt(t*e)}function f(t,e){return t>e?t:e}t.exports=p,p.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getShape(),a=i.getShape(),h=e.getBody(),m=i.getBody(),c=this.getManifold(),l=c.pointCount;s&&o.assert(l>0),this.v_invMassA=h.m_invMass,this.v_invMassB=m.m_invMass,this.v_invIA=h.m_invI,this.v_invIB=m.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=l,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=h.m_invMass,this.p_invMassB=m.m_invMass,this.p_invIA=h.m_invI,this.p_invIB=m.m_invI,this.p_localCenterA=r.clone(h.m_sweep.localCenter),this.p_localCenterB=r.clone(m.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=a.m_radius,this.p_type=c.type,this.p_localNormal=r.clone(c.localNormal),this.p_localPoint=r.clone(c.localPoint),this.p_pointCount=l;for(var _=0;_<l;++_){var u=c.points[_],p=this.v_points[_]=new d;t.warmStarting?(p.normalImpulse=t.dtRatio*u.normalImpulse,p.tangentImpulse=t.dtRatio*u.tangentImpulse):(p.normalImpulse=0,p.tangentImpulse=0),p.rA.setZero(),p.rB.setZero(),p.normalMass=0,p.tangentMass=0,p.velocityBias=0,this.p_localPoints[_]=r.clone(u.localPoint)}},p.prototype.getManifold=function(){return this.m_manifold},p.prototype.getWorldManifold=function(t){var e=this.m_fixtureA.getBody(),i=this.m_fixtureB.getBody(),s=this.m_fixtureA.getShape(),o=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,e.getTransform(),s.m_radius,i.getTransform(),o.m_radius)},p.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},p.prototype.isEnabled=function(){return this.m_enabledFlag},p.prototype.isTouching=function(){return this.m_touchingFlag},p.prototype.getNext=function(){return this.m_next},p.prototype.getFixtureA=function(){return this.m_fixtureA},p.prototype.getFixtureB=function(){return this.m_fixtureB},p.prototype.getChildIndexA=function(){return this.m_indexA},p.prototype.getChildIndexB=function(){return this.m_indexB},p.prototype.flagForFiltering=function(){this.m_filterFlag=!0},p.prototype.setFriction=function(t){this.m_friction=t},p.prototype.getFriction=function(){return this.m_friction},p.prototype.resetFriction=function(){this.m_friction=y(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},p.prototype.setRestitution=function(t){this.m_restitution=t},p.prototype.getRestitution=function(){return this.m_restitution},p.prototype.resetRestitution=function(){this.m_restitution=f(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},p.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},p.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},p.prototype.evaluate=function(t,e,i){this.m_evaluateFcn(t,e,this.m_fixtureA,this.m_indexA,i,this.m_fixtureB,this.m_indexB)},p.prototype.update=function(t){this.m_enabledFlag=!0;var e=!1,i=this.m_touchingFlag,s=this.m_fixtureA.isSensor(),o=this.m_fixtureB.isSensor(),n=s||o,r=this.m_fixtureA.getBody(),a=this.m_fixtureB.getBody(),h=r.getTransform(),m=a.getTransform();if(n){var c=this.m_fixtureA.getShape(),u=this.m_fixtureB.getShape();e=_.testOverlap(c,this.m_indexA,u,this.m_indexB,h,m),this.m_manifold.pointCount=0}else{var p=this.m_manifold;this.m_manifold=new l,this.evaluate(this.m_manifold,h,m),e=this.m_manifold.pointCount>0;for(var d=0;d<this.m_manifold.pointCount;++d){var y=this.m_manifold.points[d];y.normalImpulse=0,y.tangentImpulse=0;for(var f=0;f<p.pointCount;++f){var v=p.points[f];if(v.id.key==y.id.key){y.normalImpulse=v.normalImpulse,y.tangentImpulse=v.tangentImpulse;break}}}e!=i&&(r.setAwake(!0),a.setAwake(!0))}this.m_touchingFlag=e,0==i&&1==e&&t&&t.beginContact(this),1==i&&0==e&&t&&t.endContact(this),0==n&&e&&t&&t.preSolve(this,p)},p.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t,!1)},p.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,!0,e,i)},p.prototype._solvePositionConstraint=function(t,e,i,s){var o=this.m_fixtureA,h=this.m_fixtureB,_=o.getBody(),u=h.getBody(),p=(_.c_velocity,u.c_velocity,_.c_position),d=u.c_position,y=r.clone(this.p_localCenterA),f=r.clone(this.p_localCenterB),v=0,g=0;e&&_!=i&&_!=s||(v=this.p_invMassA,g=this.p_invIA);var x=0,A=0;e&&u!=i&&u!=s||(x=this.p_invMassB,A=this.p_invIB);for(var b=r.clone(p.c),B=p.a,w=r.clone(d.c),S=d.a,M=0,C=0;C<this.p_pointCount;++C){var I,T,P,E=a.identity(),z=a.identity();switch(E.q.set(B),z.q.set(S),E.p=r.sub(b,m.mulVec2(E.q,y)),z.p=r.sub(w,m.mulVec2(z.q,f)),this.p_type){case l.e_circles:var V=a.mulVec2(E,this.p_localPoint),L=a.mulVec2(z,this.p_localPoints[0]);(I=r.sub(L,V)).normalize(),T=r.combine(.5,V,.5,L),P=r.dot(r.sub(L,V),I)-this.p_radiusA-this.p_radiusB;break;case l.e_faceA:I=m.mulVec2(E.q,this.p_localNormal);var F=a.mulVec2(E,this.p_localPoint),D=a.mulVec2(z,this.p_localPoints[C]);P=r.dot(r.sub(D,F),I)-this.p_radiusA-this.p_radiusB,T=D;break;case l.e_faceB:I=m.mulVec2(z.q,this.p_localNormal),F=a.mulVec2(z,this.p_localPoint),D=a.mulVec2(E,this.p_localPoints[C]),P=r.dot(r.sub(D,F),I)-this.p_radiusA-this.p_radiusB,T=D,I.mul(-1)}var k=r.sub(T,b),R=r.sub(T,w);M=n.min(M,P);var q=e?c.toiBaugarte:c.baumgarte,j=c.linearSlop,G=c.maxLinearCorrection,O=n.clamp(q*(P+j),-G,0),U=r.cross(k,I),N=r.cross(R,I),Y=v+x+g*U*U+A*N*N,J=Y>0?-O/Y:0,H=r.mul(J,I);b.subMul(v,H),B-=g*r.cross(k,H),w.addMul(x,H),S+=A*r.cross(R,H)}return p.c.set(b),p.a=B,d.c.set(w),d.a=S,M},p.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,n=e.getBody(),h=i.getBody(),l=n.c_velocity,_=h.c_velocity,u=n.c_position,p=h.c_position,d=this.p_radiusA,y=this.p_radiusB,f=this.getManifold(),v=this.v_invMassA,g=this.v_invMassB,x=this.v_invIA,A=this.v_invIB,b=r.clone(this.p_localCenterA),B=r.clone(this.p_localCenterB),w=r.clone(u.c),S=u.a,M=r.clone(l.v),C=l.w,I=r.clone(p.c),T=p.a,P=r.clone(_.v),E=_.w;s&&o.assert(f.pointCount>0);var z=a.identity(),V=a.identity();z.q.set(S),V.q.set(T),z.p.setCombine(1,w,-1,m.mulVec2(z.q,b)),V.p.setCombine(1,I,-1,m.mulVec2(V.q,B));var L=f.getWorldManifold(null,z,d,V,y);this.v_normal.set(L.normal);for(var F=0;F<this.v_pointCount;++F){var D=this.v_points[F];D.rA.set(r.sub(L.points[F],w)),D.rB.set(r.sub(L.points[F],I));var k=r.cross(D.rA,this.v_normal),R=r.cross(D.rB,this.v_normal),q=v+g+x*k*k+A*R*R;D.normalMass=q>0?1/q:0;var j=r.cross(this.v_normal,1),G=r.cross(D.rA,j),O=r.cross(D.rB,j),U=v+g+x*G*G+A*O*O;D.tangentMass=U>0?1/U:0,D.velocityBias=0;var N=r.dot(this.v_normal,P)+r.dot(this.v_normal,r.cross(E,D.rB))-r.dot(this.v_normal,M)-r.dot(this.v_normal,r.cross(C,D.rA));N<-c.velocityThreshold&&(D.velocityBias=-this.v_restitution*N)}if(2==this.v_pointCount&&t.blockSolve){var Y=this.v_points[0],J=this.v_points[1],H=r.cross(Y.rA,this.v_normal),W=r.cross(Y.rB,this.v_normal),K=r.cross(J.rA,this.v_normal),Z=r.cross(J.rB,this.v_normal),X=v+g+x*H*H+A*W*W,$=v+g+x*K*K+A*Z*Z,Q=v+g+x*H*K+A*W*Z;X*X<1e3*(X*$-Q*Q)?(this.v_K.ex.set(X,Q),this.v_K.ey.set(Q,$),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}u.c.set(w),u.a=S,l.v.set(M),l.w=C,p.c.set(I),p.a=T,_.v.set(P),_.w=E},p.prototype.warmStartConstraint=function(t){for(var e=this.m_fixtureA,i=this.m_fixtureB,s=e.getBody(),o=i.getBody(),n=s.c_velocity,a=o.c_velocity,h=(s.c_position,o.c_position,this.v_invMassA),m=this.v_invIA,c=this.v_invMassB,l=this.v_invIB,_=r.clone(n.v),u=n.w,p=r.clone(a.v),d=a.w,y=this.v_normal,f=r.cross(y,1),v=0;v<this.v_pointCount;++v){var g=this.v_points[v],x=r.combine(g.normalImpulse,y,g.tangentImpulse,f);u-=m*r.cross(g.rA,x),_.subMul(h,x),d+=l*r.cross(g.rB,x),p.addMul(c,x)}n.v.set(_),n.w=u,a.v.set(p),a.w=d},p.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},p.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,a=e.c_velocity,m=(e.c_position,i.c_velocity),c=(i.c_position,this.v_invMassA),l=this.v_invIA,_=this.v_invMassB,u=this.v_invIB,p=r.clone(a.v),d=a.w,y=r.clone(m.v),f=m.w,v=this.v_normal,g=r.cross(v,1),x=this.v_friction;s&&o.assert(1==this.v_pointCount||2==this.v_pointCount);for(var A=0;A<this.v_pointCount;++A){var b=this.v_points[A];(I=r.zero()).addCombine(1,y,1,r.cross(f,b.rB)),I.subCombine(1,p,1,r.cross(d,b.rA));var B=r.dot(I,g)-this.v_tangentSpeed,w=b.tangentMass*-B,S=x*b.normalImpulse;w=(T=n.clamp(b.tangentImpulse+w,-S,S))-b.tangentImpulse,b.tangentImpulse=T;var M=r.mul(w,g);p.subMul(c,M),d-=l*r.cross(b.rA,M),y.addMul(_,M),f+=u*r.cross(b.rB,M)}if(1==this.v_pointCount||0==t.blockSolve)for(var C=0;C<this.v_pointCount;++C){var I;b=this.v_points[C],(I=r.zero()).addCombine(1,y,1,r.cross(f,b.rB)),I.subCombine(1,p,1,r.cross(d,b.rA));var T,P=r.dot(I,v);w=-b.normalMass*(P-b.velocityBias),w=(T=n.max(b.normalImpulse+w,0))-b.normalImpulse,b.normalImpulse=T,M=r.mul(w,v),p.subMul(c,M),d-=l*r.cross(b.rA,M),y.addMul(_,M),f+=u*r.cross(b.rB,M)}else{var E=this.v_points[0],z=this.v_points[1],V=r.neo(E.normalImpulse,z.normalImpulse);s&&o.assert(V.x>=0&&V.y>=0);var L=r.zero().add(y).add(r.cross(f,E.rB)).sub(p).sub(r.cross(d,E.rA)),F=r.zero().add(y).add(r.cross(f,z.rB)).sub(p).sub(r.cross(d,z.rA)),D=r.dot(L,v),k=r.dot(F,v),R=r.neo(D-E.velocityBias,k-z.velocityBias);for(R.sub(h.mulVec2(this.v_K,V));;){var q=h.mulVec2(this.v_normalMass,R).neg();if(q.x>=0&&q.y>=0){var j=r.sub(q,V),G=r.mul(j.x,v),O=r.mul(j.y,v);p.subCombine(c,G,c,O),d-=l*(r.cross(E.rA,G)+r.cross(z.rA,O)),y.addCombine(_,G,_,O),f+=u*(r.cross(E.rB,G)+r.cross(z.rB,O)),E.normalImpulse=q.x,z.normalImpulse=q.y;break}if(q.x=-E.normalMass*R.x,q.y=0,D=0,k=this.v_K.ex.y*q.x+R.y,q.x>=0&&k>=0){j=r.sub(q,V),G=r.mul(j.x,v),O=r.mul(j.y,v),p.subCombine(c,G,c,O),d-=l*(r.cross(E.rA,G)+r.cross(z.rA,O)),y.addCombine(_,G,_,O),f+=u*(r.cross(E.rB,G)+r.cross(z.rB,O)),E.normalImpulse=q.x,z.normalImpulse=q.y;break}if(q.x=0,q.y=-z.normalMass*R.y,D=this.v_K.ey.x*q.y+R.x,k=0,q.y>=0&&D>=0){j=r.sub(q,V),G=r.mul(j.x,v),O=r.mul(j.y,v),p.subCombine(c,G,c,O),d-=l*(r.cross(E.rA,G)+r.cross(z.rA,O)),y.addCombine(_,G,_,O),f+=u*(r.cross(E.rB,G)+r.cross(z.rB,O)),E.normalImpulse=q.x,z.normalImpulse=q.y;break}if(q.x=0,q.y=0,D=R.x,k=R.y,D>=0&&k>=0){j=r.sub(q,V),G=r.mul(j.x,v),O=r.mul(j.y,v),p.subCombine(c,G,c,O),d-=l*(r.cross(E.rA,G)+r.cross(z.rA,O)),y.addCombine(_,G,_,O),f+=u*(r.cross(E.rB,G)+r.cross(z.rB,O)),E.normalImpulse=q.x,z.normalImpulse=q.y;break}break}}a.v.set(p),a.w=d,m.v.set(y),m.w=f};var v=[];p.addType=function(t,e,i){v[t]=v[t]||{},v[t][e]=i},p.create=function(t,e,i,s){var o,n,r=t.getType(),a=i.getType();if(n=v[r]&&v[r][a])o=new p(t,e,i,s,n);else{if(!(n=v[a]&&v[a][r]))return null;o=new p(i,s,t,e,n)}t=o.getFixtureA(),i=o.getFixtureB(),e=o.getChildIndexA(),s=o.getChildIndexB();var h=t.getBody(),m=i.getBody();return o.m_nodeA.contact=o,o.m_nodeA.other=m,o.m_nodeA.prev=null,o.m_nodeA.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=o.m_nodeA),h.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=h,o.m_nodeB.prev=null,o.m_nodeB.next=m.m_contactList,null!=m.m_contactList&&(m.m_contactList.prev=o.m_nodeB),m.m_contactList=o.m_nodeB,0==t.isSensor()&&0==i.isSensor()&&(h.setAwake(!0),m.setAwake(!0)),o},p.destroy=function(t,e){var i=t.m_fixtureA,s=t.m_fixtureB,o=i.getBody(),n=s.getBody();t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&0==i.isSensor()&&0==s.isSensor()&&(o.setAwake(!0),n.setAwake(!0));var r=i.getType(),a=s.getType(),h=v[r][a].destroyFcn;"function"==typeof h&&h(t)}},4052:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=h;var n=i(2088),r=(i(3216),i(4474)),a=i(905);function h(t,e,i){"object"==typeof t&&null!==t?(this.ex=a.clone(t),this.ey=a.clone(e),this.ez=a.clone(i)):(this.ex=a(),this.ey=a(),this.ez=a())}h.prototype.toString=function(){return JSON.stringify(this)},h.isValid=function(t){return t&&a.isValid(t.ex)&&a.isValid(t.ey)&&a.isValid(t.ez)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid Mat33!")},h.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},h.prototype.solve33=function(t){var e=a.dot(this.ex,a.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=new a;return i.x=e*a.dot(t,a.cross(this.ey,this.ez)),i.y=e*a.dot(this.ex,a.cross(t,this.ez)),i.z=e*a.dot(this.ex,a.cross(this.ey,t)),i},h.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!=n&&(n=1/n);var a=r.zero();return a.x=n*(o*t.x-i*t.y),a.y=n*(e*t.y-s*t.x),a},h.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!=n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},h.prototype.getSymInverse33=function(t){var e=a.dot(this.ex,a.cross(this.ey,this.ez));0!=e&&(e=1/e);var i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,h=this.ez.z;t.ex.x=e*(n*h-r*r),t.ex.y=e*(o*r-s*h),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*h-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)},h.mul=function(t,e){if(o&&h.assert(t),e&&"z"in e&&"y"in e&&"x"in e){o&&a.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,m=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new a(i,s,m)}if(e&&"y"in e&&"x"in e)return o&&r.assert(e),i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y,r.neo(i,s);o&&n.assert(!1)},h.mulVec3=function(t,e){o&&h.assert(t),o&&a.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,n=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new a(i,s,n)},h.mulVec2=function(t,e){o&&h.assert(t),o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)},h.add=function(t,e){return o&&h.assert(t),o&&h.assert(e),new h(a.add(t.ex,e.ex),a.add(t.ey,e.ey),a.add(t.ez,e.ez))}},4124:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=m;var o=i(2088),n=i(3216),r=i(4474),a=i(2669),h=i(1428);function m(t,e){s&&o.assert(void 0===t),s&&o.assert(void 0===e),this.localCenter=r.zero(),this.c=r.zero(),this.a=0,this.alpha0=0,this.c0=r.zero(),this.a0=0}m.prototype.setTransform=function(t){var e=h.mulVec2(t,this.localCenter);this.c.set(e),this.c0.set(e),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},m.prototype.setLocalCenter=function(t,e){this.localCenter.set(t);var i=h.mulVec2(e,this.localCenter);this.c.set(i),this.c0.set(i)},m.prototype.getTransform=function(t,e){e=void 0===e?0:e,t.q.setAngle((1-e)*this.a0+e*this.a),t.p.setCombine(1-e,this.c0,e,this.c),t.p.sub(a.mulVec2(t.q,this.localCenter))},m.prototype.advance=function(t){s&&o.assert(this.alpha0<1);var e=(t-this.alpha0)/(1-this.alpha0);this.c0.setCombine(e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},m.prototype.forward=function(){this.a0=this.a,this.c0.set(this.c)},m.prototype.normalize=function(){var t=n.mod(this.a0,-n.PI,+n.PI);this.a-=this.a0-t,this.a0=t},m.prototype.clone=function(){var t=new m;return t.localCenter.set(this.localCenter),t.alpha0=this.alpha0,t.a0=this.a0,t.a=this.a,t.c0.set(this.c0),t.c.set(this.c),t},m.prototype.set=function(t){this.localCenter.set(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.set(t.c0),this.c.set(t.c)}},4200:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(4299),n=i(2088),r=i(4474),a=i(7632),h=i(7945),m=i(8878),c=i(5868),l=i(3960),_={gravity:r.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};function u(t){if(!(this instanceof u))return new u(t);t&&r.isValid(t)&&(t={gravity:t}),t=o(t,_),this.m_solver=new h(this),this.m_broadPhase=new a,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=r.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0,this.addPair=this.createContact.bind(this)}u.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var s=this.getJointList();s;s=s.getNext())"function"==typeof s._serialize&&e.push(s);return{gravity:this.m_gravity,bodies:t,joints:e}},u._deserialize=function(t,e,i){if(!t)return new u;var s=new u(t.gravity);if(t.bodies)for(var o=t.bodies.length-1;o>=0;o-=1)s._addBody(i(m,t.bodies[o],s));if(t.joints)for(o=t.joints.length-1;o>=0;o--)s.createJoint(i(c,t.joints[o],s));return s},u.prototype.getBodyList=function(){return this.m_bodyList},u.prototype.getJointList=function(){return this.m_jointList},u.prototype.getContactList=function(){return this.m_contactList},u.prototype.getBodyCount=function(){return this.m_bodyCount},u.prototype.getJointCount=function(){return this.m_jointCount},u.prototype.getContactCount=function(){return this.m_contactCount},u.prototype.setGravity=function(t){this.m_gravity=t},u.prototype.getGravity=function(){return this.m_gravity},u.prototype.isLocked=function(){return this.m_locked},u.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},u.prototype.getAllowSleeping=function(){return this.m_allowSleep},u.prototype.setWarmStarting=function(t){this.m_warmStarting=t},u.prototype.getWarmStarting=function(){return this.m_warmStarting},u.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},u.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},u.prototype.setSubStepping=function(t){this.m_subStepping=t},u.prototype.getSubStepping=function(){return this.m_subStepping},u.prototype.setAutoClearForces=function(t){this.m_clearForces=t},u.prototype.getAutoClearForces=function(){return this.m_clearForces},u.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},u.prototype.queryAABB=function(t,e){s&&n.assert("function"==typeof e);var i=this.m_broadPhase;this.m_broadPhase.query(t,function(t){var s=i.getUserData(t);return e(s.fixture)})},u.prototype.rayCast=function(t,e,i){s&&n.assert("function"==typeof i);var o=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(t,e){var s=o.getUserData(e),n=s.fixture,a=s.childIndex,h={};if(n.rayCast(h,t,a)){var m=h.fraction,c=r.add(r.mul(1-m,t.p1),r.mul(m,t.p2));return i(n,c,h.normal,m)}return t.maxFraction})},u.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},u.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},u.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},u.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},u.prototype.shiftOrigin=function(t){if(s&&n.assert(0==this.m_locked),!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},u.prototype._addBody=function(t){s&&n.assert(!1===this.isLocked()),this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},u.prototype.createBody=function(t,e){if(s&&n.assert(0==this.isLocked()),this.isLocked())return null;t&&r.isValid(t)&&(t={position:t,angle:e});var i=new m(this,t);return this._addBody(i),i},u.prototype.createDynamicBody=function(t,e){return t?r.isValid(t)&&(t={position:t,angle:e}):t={},t.type="dynamic",this.createBody(t)},u.prototype.createKinematicBody=function(t,e){return t?r.isValid(t)&&(t={position:t,angle:e}):t={},t.type="kinematic",this.createBody(t)},u.prototype.destroyBody=function(t){if(s&&n.assert(this.m_bodyCount>0),s&&n.assert(0==this.isLocked()),!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var o=t.m_contactList;o;){var r=o;o=o.next,this.destroyContact(r.contact),t.m_contactList=o}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var h=a;a=a.m_next,this.publish("remove-fixture",h),h.destroyProxies(this.m_broadPhase),t.m_fixtureList=a}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},u.prototype.createJoint=function(t){if(s&&n.assert(!!t.m_bodyA),s&&n.assert(!!t.m_bodyB),s&&n.assert(0==this.isLocked()),this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},u.prototype.destroyJoint=function(t){if(s&&n.assert(0==this.isLocked()),!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,s&&n.assert(this.m_jointCount>0),--this.m_jointCount,0==t.m_collideConnected)for(var o=i.getContactList();o;)o.other==e&&o.contact.flagForFiltering(),o=o.next;this.publish("remove-joint",t)}};var p=new h.TimeStep;u.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,p.reset(t),p.velocityIterations=e,p.positionIterations=i,p.warmStarting=this.m_warmStarting,p.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(p);for(var s=this.m_bodyList;s;s=s.getNext())0!=s.m_islandFlag&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(p),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},u.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.addPair)},u.prototype.createContact=function(t,e){var i=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,r=i.getBody(),a=s.getBody();if(r!=a){for(var h=a.getContactList();h;){if(h.other==r){var m=h.contact.getFixtureA(),c=h.contact.getFixtureB(),_=h.contact.getChildIndexA(),u=h.contact.getChildIndexB();if(m==i&&c==s&&_==o&&u==n)return;if(m==s&&c==i&&_==n&&u==o)return}h=h.next}if(0!=a.shouldCollide(r)&&0!=s.shouldCollide(i)){var p=l.create(i,o,s,n);null!=p&&(p.m_prev=null,null!=this.m_contactList&&(p.m_next=this.m_contactList,this.m_contactList.m_prev=p),this.m_contactList=p,++this.m_contactCount)}}},u.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),s=t.getFixtureB(),o=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),a=s.getBody();if(t.m_filterFlag){if(0==a.shouldCollide(r)){this.destroyContact(t);continue}if(0==s.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var h=r.isAwake()&&!r.isStatic(),m=a.isAwake()&&!a.isStatic();if(0!=h||0!=m){var c=i.m_proxies[o].proxyId,l=s.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(c,l)?t.update(this):this.destroyContact(t)}}},u.prototype.destroyContact=function(t){l.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},u.prototype._listeners=null,u.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},u.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var s=i.indexOf(e);return s>=0&&i.splice(s,1),this},u.prototype.publish=function(t,e,i,s){var o=this._listeners&&this._listeners[t];if(!o||!o.length)return 0;for(var n=0;n<o.length;n++)o[n].call(this,e,i,s);return o.length},u.prototype.beginContact=function(t){this.publish("begin-contact",t)},u.prototype.endContact=function(t){this.publish("end-contact",t)},u.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},u.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)}},4299:function(t){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,Object.prototype.propertyIsEnumerable,t.exports=function(t,e){null==t&&(t={});var i=Object.assign({},t);for(var s in e)e.hasOwnProperty(s)&&void 0===t[s]&&(i[s]=e[s]);if("function"==typeof Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),n=0;n<o.length;n++){var r=o[n];e.propertyIsEnumerable(r)&&void 0===t[s]&&(i[r]=e[r])}return i}},4474:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(2088),r=i(3216);function a(t,e){if(!(this instanceof a))return new a(t,e);void 0===t?(this.x=0,this.y=0):"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),o&&a.assert(this)}a.prototype._serialize=function(){return{x:this.x,y:this.y}},a._deserialize=function(t){var e=Object.create(a.prototype);return e.x=t.x,e.y=t.y,e},a.zero=function(){var t=Object.create(a.prototype);return t.x=0,t.y=0,t},a.neo=function(t,e){var i=Object.create(a.prototype);return i.x=t,i.y=e,i},a.clone=function(t){return o&&a.assert(t),a.neo(t.x,t.y)},a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isFinite(t.x)&&r.isFinite(t.y)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Vec2!")},a.prototype.clone=function(){return a.clone(this)},a.prototype.setZero=function(){return this.x=0,this.y=0,this},a.prototype.set=function(t,e){return"object"==typeof t?(o&&a.assert(t),this.x=t.x,this.y=t.y):(o&&r.assert(t),o&&r.assert(e),this.x=t,this.y=e),this},a.prototype.wSet=function(t,e,i,s){return void 0!==i||void 0!==s?this.setCombine(t,e,i,s):this.setMul(t,e)},a.prototype.setCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,h=t*e.y+i*s.y;return this.x=n,this.y=h,this},a.prototype.setMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x=i,this.y=s,this},a.prototype.add=function(t){return o&&a.assert(t),this.x+=t.x,this.y+=t.y,this},a.prototype.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?this.addCombine(t,e,i,s):this.addMul(t,e)},a.prototype.addCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,h=t*e.y+i*s.y;return this.x+=n,this.y+=h,this},a.prototype.addMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x+=i,this.y+=s,this},a.prototype.wSub=function(t,e,i,s){return void 0!==i||void 0!==s?this.subCombine(t,e,i,s):this.subMul(t,e)},a.prototype.subCombine=function(t,e,i,s){o&&r.assert(t),o&&a.assert(e),o&&r.assert(i),o&&a.assert(s);var n=t*e.x+i*s.x,h=t*e.y+i*s.y;return this.x-=n,this.y-=h,this},a.prototype.subMul=function(t,e){o&&r.assert(t),o&&a.assert(e);var i=t*e.x,s=t*e.y;return this.x-=i,this.y-=s,this},a.prototype.sub=function(t){return o&&a.assert(t),this.x-=t.x,this.y-=t.y,this},a.prototype.mul=function(t){return o&&r.assert(t),this.x*=t,this.y*=t,this},a.prototype.length=function(){return a.lengthOf(this)},a.prototype.lengthSquared=function(){return a.lengthSquared(this)},a.prototype.normalize=function(){var t=this.length();if(t<r.EPSILON)return 0;var e=1/t;return this.x*=e,this.y*=e,t},a.lengthOf=function(t){return o&&a.assert(t),r.sqrt(t.x*t.x+t.y*t.y)},a.lengthSquared=function(t){return o&&a.assert(t),t.x*t.x+t.y*t.y},a.distance=function(t,e){o&&a.assert(t),o&&a.assert(e);var i=t.x-e.x,s=t.y-e.y;return r.sqrt(i*i+s*s)},a.distanceSquared=function(t,e){o&&a.assert(t),o&&a.assert(e);var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},a.areEqual=function(t,e){return o&&a.assert(t),o&&a.assert(e),t==e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},a.skew=function(t){return o&&a.assert(t),a.neo(-t.y,t.x)},a.dot=function(t,e){return o&&a.assert(t),o&&a.assert(e),t.x*e.x+t.y*e.y},a.cross=function(t,e){return"number"==typeof e?(o&&a.assert(t),o&&r.assert(e),a.neo(e*t.y,-e*t.x)):"number"==typeof t?(o&&r.assert(t),o&&a.assert(e),a.neo(-t*e.y,t*e.x)):(o&&a.assert(t),o&&a.assert(e),t.x*e.y-t.y*e.x)},a.addCross=function(t,e,i){return"number"==typeof i?(o&&a.assert(e),o&&r.assert(i),a.neo(i*e.y+t.x,-i*e.x+t.y)):"number"==typeof e?(o&&r.assert(e),o&&a.assert(i),a.neo(-e*i.y+t.x,e*i.x+t.y)):void(o&&n.assert(!1))},a.add=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(t.x+e.x,t.y+e.y)},a.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?a.combine(t,e,i,s):a.mul(t,e)},a.combine=function(t,e,i,s){return a.zero().setCombine(t,e,i,s)},a.sub=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(t.x-e.x,t.y-e.y)},a.mul=function(t,e){return"object"==typeof t?(o&&a.assert(t),o&&r.assert(e),a.neo(t.x*e,t.y*e)):"object"==typeof e?(o&&r.assert(t),o&&a.assert(e),a.neo(t*e.x,t*e.y)):void 0},a.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(t){return o&&a.assert(t),a.neo(-t.x,-t.y)},a.abs=function(t){return o&&a.assert(t),a.neo(r.abs(t.x),r.abs(t.y))},a.mid=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(.5*(t.x+e.x),.5*(t.y+e.y))},a.upper=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(r.max(t.x,e.x),r.max(t.y,e.y))},a.lower=function(t,e){return o&&a.assert(t),o&&a.assert(e),a.neo(r.min(t.x,e.x),r.min(t.y,e.y))},a.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=r.invSqrt(e);this.x*=i*t,this.y*=i*t}return this},a.clamp=function(t,e){return(t=a.neo(t.x,t.y)).clamp(e),t},a.scaleFn=function(t,e){return function(i){return a.neo(i.x*t,i.y*e)}},a.translateFn=function(t,e){return function(i){return a.neo(i.x+t,i.y+e)}}},4529:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=n;var s=i(4474),o=i(2669);function n(){this.c=s.zero(),this.a=0}n.prototype.getTransform=function(t,e){return t.q.set(this.a),t.p.set(s.sub(this.c,o.mulVec2(t.q,e))),t}},4560:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=h,i(4299);var s=i(7191),o=i(2409),n=(i(3216),i(1428)),r=i(2669),a=i(4474);function h(t,e){if(!(this instanceof h))return new h(t,e);h._super.call(this),this.m_type=h.TYPE,this.m_radius=s.polygonRadius,this.m_vertex1=t?a.clone(t):a.zero(),this.m_vertex2=e?a.clone(e):a.zero(),this.m_vertex0=a.zero(),this.m_vertex3=a.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}i(7221),h._super=o,h.prototype=Object.create(h._super.prototype),h.TYPE="edge",o.TYPES[h.TYPE]=h,h.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},h._deserialize=function(t){var e=new h(t.vertex1,t.vertex2);return e.hasVertex0&&e.setPrev(t.vertex0),e.hasVertex3&&e.setNext(t.vertex3),e},h.prototype.setNext=function(t){return t?(this.m_vertex3.set(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},h.prototype.setPrev=function(t){return t?(this.m_vertex0.set(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},h.prototype._set=function(t,e){return this.m_vertex1.set(t),this.m_vertex2.set(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},h.prototype._clone=function(){var t=new h;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.set(this.m_vertex1),t.m_vertex2.set(this.m_vertex2),t.m_vertex0.set(this.m_vertex0),t.m_vertex3.set(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},h.prototype.getChildCount=function(){return 1},h.prototype.testPoint=function(t,e){return!1},h.prototype.rayCast=function(t,e,i,s){var o=r.mulTVec2(i.q,a.sub(e.p1,i.p)),n=r.mulTVec2(i.q,a.sub(e.p2,i.p)),h=a.sub(n,o),m=this.m_vertex1,c=this.m_vertex2,l=a.sub(c,m),_=a.neo(l.y,-l.x);_.normalize();var u=a.dot(_,a.sub(m,o)),p=a.dot(_,h);if(0==p)return!1;var d=u/p;if(d<0||e.maxFraction<d)return!1;var y=a.add(o,a.mul(d,h)),f=a.sub(c,m),v=a.dot(f,f);if(0==v)return!1;var g=a.dot(a.sub(y,m),f)/v;return!(g<0||1<g||(t.fraction=d,t.normal=u>0?r.mulVec2(i.q,_).neg():r.mulVec2(i.q,_),0))},h.prototype.computeAABB=function(t,e,i){var s=n.mulVec2(e,this.m_vertex1),o=n.mulVec2(e,this.m_vertex2);t.combinePoints(s,o),t.extend(this.m_radius)},h.prototype.computeMass=function(t,e){t.mass=0,t.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},h.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_vertex1),t.m_vertices.push(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},4914:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=o,i(2088);var s=i(2355);function o(t,e,i,s){if(!(this instanceof o))return new o(t,e,i,s);o._super.call(this),this._setAsBox(t,e,i,s)}o._super=s,o.prototype=Object.create(o._super.prototype),o.TYPE="polygon"},5080:function(t,e,i){i(7713),i(3216),e.Vec2=i(4474),i(905),i(5154),i(4052),i(1428),i(2669),i(7221),i(2409),i(9381),i(8878),i(3960),i(5868),e.World=i(4200),i(2219),i(4560),i(2355),i(2238),e.Box=i(4914),i(7980),i(3933),i(8836),i(185),i(3627),i(9486),i(6025),i(5622),i(7608),i(1158),i(6795),i(6052),e.RevoluteJoint=i(6773),i(5479),i(355),i(7154),e.Settings=i(7191),i(4124),i(8759),i(6130),i(9352),i(8025),i(9218),e.Settings},5154:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=a;var n=i(2088),r=(i(3216),i(4474));function a(t,e,i,s){"object"==typeof t&&null!==t?(this.ex=r.clone(t),this.ey=r.clone(e)):"number"==typeof t?(this.ex=r.neo(t,i),this.ey=r.neo(e,s)):(this.ex=r.zero(),this.ey=r.zero())}a.prototype.toString=function(){return JSON.stringify(this)},a.isValid=function(t){return t&&r.isValid(t.ex)&&r.isValid(t.ey)},a.assert=function(t){if(o&&!a.isValid(t))throw s&&n.debug(t),new Error("Invalid Mat22!")},a.prototype.set=function(t,e,i,s){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof s?(this.ex.set(t,i),this.ey.set(e,s)):"object"==typeof t&&"object"==typeof e?(this.ex.set(t),this.ey.set(e)):"object"==typeof t?(o&&a.assert(t),this.ex.set(t.ex),this.ey.set(t.ey)):o&&n.assert(!1)},a.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},a.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},a.prototype.getInverse=function(){var t=this.ex.x,e=this.ey.x,i=this.ex.y,s=this.ey.y,o=t*s-e*i;0!=o&&(o=1/o);var n=new a;return n.ex.x=o*s,n.ey.x=-o*e,n.ex.y=-o*i,n.ey.y=o*t,n},a.prototype.solve=function(t){o&&r.assert(t);var e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y,a=e*n-i*s;0!=a&&(a=1/a);var h=r.zero();return h.x=a*(n*t.x-i*t.y),h.y=a*(e*t.y-s*t.x),h},a.mul=function(t,e){if(e&&"x"in e&&"y"in e){o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)}if(e&&"ex"in e&&"ey"in e)return o&&a.assert(e),new a(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y);o&&n.assert(!1)},a.mulVec2=function(t,e){o&&r.assert(e);var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return r.neo(i,s)},a.mulMat22=function(t,e){return o&&a.assert(e),new a(t.ex.x*e.ex.x+t.ey.x*e.ex.y,t.ex.x*e.ey.x+t.ey.x*e.ey.y,t.ex.y*e.ex.x+t.ey.y*e.ex.y,t.ex.y*e.ey.x+t.ey.y*e.ey.y)},a.mulT=function(t,e){return e&&"x"in e&&"y"in e?(o&&r.assert(e),r.neo(r.dot(e,t.ex),r.dot(e,t.ey))):e&&"ex"in e&&"ey"in e?(o&&a.assert(e),new a(r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey)))):void(o&&n.assert(!1))},a.mulTVec2=function(t,e){return o&&a.assert(t),o&&r.assert(e),r.neo(r.dot(e,t.ex),r.dot(e,t.ey))},a.mulTMat22=function(t,e){return o&&a.assert(t),o&&a.assert(e),new a(r.neo(r.dot(t.ex,e.ex),r.dot(t.ey,e.ex)),r.neo(r.dot(t.ex,e.ey),r.dot(t.ey,e.ey)))},a.abs=function(t){return o&&a.assert(t),new a(r.abs(t.ex),r.abs(t.ey))},a.add=function(t,e){return o&&a.assert(t),o&&a.assert(e),new a(r.add(t.ex,e.ex),r.add(t.ey,e.ey))}},5479:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=_;var s=i(4299),o=i(7191),n=i(3216),r=i(4474),a=(i(905),i(5154),i(4052),i(2669)),h=(i(4124),i(1428),i(9753),i(4529),i(5868)),m=i(8878),c=0;_.TYPE="rope-joint",h.TYPES[_.TYPE]=_,_._super=h,_.prototype=Object.create(_._super.prototype);var l={maxLength:0};function _(t,e,i,o){if(!(this instanceof _))return new _(t,e,i,o);t=s(t,l),h.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=_.TYPE,this.m_localAnchorA=o?e.getLocalPoint(o):t.localAnchorA||r.neo(-1,0),this.m_localAnchorB=o?i.getLocalPoint(o):t.localAnchorB||r.neo(1,0),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=c,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}_.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},_._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(m,t.bodyA,e),t.bodyB=i(m,t.bodyB,e),new _(t)},_.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},_.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},_.prototype.setMaxLength=function(t){this.m_maxLength=t},_.prototype.getMaxLength=function(){return this.m_maxLength},_.prototype.getLimitState=function(){return this.m_state},_.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},_.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},_.prototype.getReactionForce=function(t){return r.mul(this.m_impulse,this.m_u).mul(t)},_.prototype.getReactionTorque=function(t){return 0},_.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,n=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,l=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,u=a.neo(i),p=a.neo(m);this.m_rA=a.mulSub(u,this.m_localAnchorA,this.m_localCenterA),this.m_rB=a.mulSub(p,this.m_localAnchorB,this.m_localCenterB),this.m_u=r.zero(),this.m_u.addCombine(1,h,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length();var d=this.m_length-this.m_maxLength;if(this.m_state=d>0?2:c,!(this.m_length>o.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);var y=r.cross(this.m_rA,this.m_u),f=r.cross(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!=v?1/v:0,t.warmStarting){this.m_impulse*=t.dtRatio;var g=r.mul(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,g),n-=this.m_invIA*r.cross(this.m_rA,g),l.addMul(this.m_invMassB,g),_+=this.m_invIB*r.cross(this.m_rB,g)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=n,this.m_bodyB.c_velocity.v.set(l),this.m_bodyB.c_velocity.w=_},_.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,a=r.addCross(e,i,this.m_rA),h=r.addCross(s,o,this.m_rB),m=this.m_length-this.m_maxLength,c=r.dot(this.m_u,r.sub(h,a));m<0&&(c+=t.inv_dt*m);var l=-this.m_mass*c,_=this.m_impulse;this.m_impulse=n.min(0,this.m_impulse+l),l=this.m_impulse-_;var u=r.mul(l,this.m_u);e.subMul(this.m_invMassA,u),i-=this.m_invIA*r.cross(this.m_rA,u),s.addMul(this.m_invMassB,u),o+=this.m_invIB*r.cross(this.m_rB,u),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},_.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,m=a.neo(i),c=a.neo(h),l=a.mulSub(m,this.m_localAnchorA,this.m_localCenterA),_=a.mulSub(c,this.m_localAnchorB,this.m_localCenterB),u=r.zero();u.addCombine(1,s,1,_),u.subCombine(1,e,1,l);var p=u.normalize(),d=p-this.m_maxLength;d=n.clamp(d,0,o.maxLinearCorrection);var y=-this.m_mass*d,f=r.mul(y,u);return e.subMul(this.m_invMassA,f),i-=this.m_invIA*r.cross(l,f),s.addMul(this.m_invMassB,f),h+=this.m_invIB*r.cross(_,f),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=h,p-this.m_maxLength<o.linearSlop}},5622:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=d;var o=i(2088),n=i(4299),r=i(7191),a=i(3216),h=i(4474),m=(i(905),i(5154),i(4052),i(2669)),c=(i(4124),i(1428),i(9753),i(4529),i(5868)),l=i(8878),_=i(6773),u=i(6795);d.TYPE="gear-joint",c.TYPES[d.TYPE]=d,d._super=c,d.prototype=Object.create(d._super.prototype);var p={ratio:1};function d(t,e,i,r,l,y){if(!(this instanceof d))return new d(t,e,i,r,l,y);var f,v;t=n(t,p),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=d.TYPE,s&&o.assert(r.m_type===_.TYPE||r.m_type===u.TYPE),s&&o.assert(l.m_type===_.TYPE||l.m_type===u.TYPE),this.m_joint1=r||t.joint1,this.m_joint2=l||t.joint2,this.m_ratio=a.isFinite(y)?y:t.ratio,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType(),this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();var g=this.m_bodyA.m_xf,x=this.m_bodyA.m_sweep.a,A=this.m_bodyC.m_xf,b=this.m_bodyC.m_sweep.a;if(this.m_type1===_.TYPE){var B=this.m_joint1;this.m_localAnchorC=B.m_localAnchorA,this.m_localAnchorA=B.m_localAnchorB,this.m_referenceAngleA=B.m_referenceAngle,this.m_localAxisC=h.zero(),f=x-b-this.m_referenceAngleA}else{var w=this.m_joint1;this.m_localAnchorC=w.m_localAnchorA,this.m_localAnchorA=w.m_localAnchorB,this.m_referenceAngleA=w.m_referenceAngle,this.m_localAxisC=w.m_localXAxisA;var S=this.m_localAnchorC,M=m.mulTVec2(A.q,h.add(m.mul(g.q,this.m_localAnchorA),h.sub(g.p,A.p)));f=h.dot(M,this.m_localAxisC)-h.dot(S,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();var C=this.m_bodyB.m_xf,I=this.m_bodyB.m_sweep.a,T=this.m_bodyD.m_xf,P=this.m_bodyD.m_sweep.a;if(this.m_type2===_.TYPE)B=this.m_joint2,this.m_localAnchorD=B.m_localAnchorA,this.m_localAnchorB=B.m_localAnchorB,this.m_referenceAngleB=B.m_referenceAngle,this.m_localAxisD=h.zero(),v=I-P-this.m_referenceAngleB;else{w=this.m_joint2,this.m_localAnchorD=w.m_localAnchorA,this.m_localAnchorB=w.m_localAnchorB,this.m_referenceAngleB=w.m_referenceAngle,this.m_localAxisD=w.m_localXAxisA;var E=this.m_localAnchorD,z=m.mulTVec2(T.q,h.add(m.mul(C.q,this.m_localAnchorB),h.sub(C.p,T.p)));v=h.dot(z,this.m_localAxisD)-h.dot(E,this.m_localAxisD)}this.m_constant=f+this.m_ratio*v,this.m_impulse=0,this.m_lcA,this.m_lcB,this.m_lcC,this.m_lcD,this.m_mA,this.m_mB,this.m_mC,this.m_mD,this.m_iA,this.m_iB,this.m_iC,this.m_iD,this.m_JvAC,this.m_JvBD,this.m_JwA,this.m_JwB,this.m_JwC,this.m_JwD,this.m_mass}d.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},d._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(l,t.bodyA,e),t.bodyB=i(l,t.bodyB,e),t.joint1=i(c,t.joint1,e),t.joint2=i(c,t.joint2,e),new d(t)},d.prototype.getJoint1=function(){return this.m_joint1},d.prototype.getJoint2=function(){return this.m_joint2},d.prototype.setRatio=function(t){s&&o.assert(a.isFinite(t)),this.m_ratio=t},d.prototype.getRatio=function(){return this.m_ratio},d.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},d.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},d.prototype.getReactionForce=function(t){return h.mul(this.m_impulse,this.m_JvAC).mul(t)},d.prototype.getReactionTorque=function(t){return t*(this.m_impulse*this.m_JwA)},d.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_position.a,c=this.m_bodyC.c_velocity.v,l=this.m_bodyC.c_velocity.w,u=this.m_bodyD.c_position.a,p=this.m_bodyD.c_velocity.v,d=this.m_bodyD.c_velocity.w,y=m.neo(e),f=m.neo(o),v=m.neo(a),g=m.neo(u);if(this.m_mass=0,this.m_type1==_.TYPE)this.m_JvAC=h.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var x=m.mulVec2(v,this.m_localAxisC),A=m.mulSub(v,this.m_localAnchorC,this.m_lcC),b=m.mulSub(y,this.m_localAnchorA,this.m_lcA);this.m_JvAC=x,this.m_JwC=h.cross(A,x),this.m_JwA=h.cross(b,x),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==_.TYPE)this.m_JvBD=h.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{x=m.mulVec2(g,this.m_localAxisD);var B=m.mulSub(g,this.m_localAnchorD,this.m_lcD),w=m.mulSub(f,this.m_localAnchorB,this.m_lcB);this.m_JvBD=h.mul(this.m_ratio,x),this.m_JwD=this.m_ratio*h.cross(B,x),this.m_JwB=this.m_ratio*h.cross(w,x),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,c.subMul(this.m_mC*this.m_impulse,this.m_JvAC),l-=this.m_iC*this.m_impulse*this.m_JwC,p.subMul(this.m_mD*this.m_impulse,this.m_JvBD),d-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.set(i),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.set(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.set(c),this.m_bodyC.c_velocity.w=l,this.m_bodyD.c_velocity.v.set(p),this.m_bodyD.c_velocity.w=d},d.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,a=this.m_bodyD.c_velocity.v,m=this.m_bodyD.c_velocity.w,c=h.dot(this.m_JvAC,e)-h.dot(this.m_JvAC,n)+h.dot(this.m_JvBD,s)-h.dot(this.m_JvBD,a);c+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*o-this.m_JwD*m);var l=-this.m_mass*c;this.m_impulse+=l,e.addMul(this.m_mA*l,this.m_JvAC),i+=this.m_iA*l*this.m_JwA,s.addMul(this.m_mB*l,this.m_JvBD),o+=this.m_iB*l*this.m_JwB,n.subMul(this.m_mC*l,this.m_JvAC),r-=this.m_iC*l*this.m_JwC,a.subMul(this.m_mD*l,this.m_JvBD),m-=this.m_iD*l*this.m_JwD,this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(s),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.set(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.set(a),this.m_bodyD.c_velocity.w=m},d.prototype.solvePositionConstraints=function(t){var e,i,s,o,n,a,c,l,u=this.m_bodyA.c_position.c,p=this.m_bodyA.c_position.a,d=this.m_bodyB.c_position.c,y=this.m_bodyB.c_position.a,f=this.m_bodyC.c_position.c,v=this.m_bodyC.c_position.a,g=this.m_bodyD.c_position.c,x=this.m_bodyD.c_position.a,A=m.neo(p),b=m.neo(y),B=m.neo(v),w=m.neo(x),S=0;if(this.m_type1==_.TYPE)s=h.zero(),n=1,c=1,S+=this.m_iA+this.m_iC,e=p-v-this.m_referenceAngleA;else{var M=m.mulVec2(B,this.m_localAxisC),C=m.mulSub(B,this.m_localAnchorC,this.m_lcC),I=m.mulSub(A,this.m_localAnchorA,this.m_lcA);s=M,c=h.cross(C,M),n=h.cross(I,M),S+=this.m_mC+this.m_mA+this.m_iC*c*c+this.m_iA*n*n;var T=h.sub(this.m_localAnchorC,this.m_lcC),P=m.mulTVec2(B,h.add(I,h.sub(u,f)));e=h.dot(h.sub(P,T),this.m_localAxisC)}if(this.m_type2==_.TYPE)o=h.zero(),a=this.m_ratio,l=this.m_ratio,S+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=y-x-this.m_referenceAngleB;else{M=m.mulVec2(w,this.m_localAxisD);var E=m.mulSub(w,this.m_localAnchorD,this.m_lcD),z=m.mulSub(b,this.m_localAnchorB,this.m_lcB);o=h.mul(this.m_ratio,M),l=this.m_ratio*h.cross(E,M),a=this.m_ratio*h.cross(z,M),S+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*l*l+this.m_iB*a*a;var V=h.sub(this.m_localAnchorD,this.m_lcD),L=m.mulTVec2(w,h.add(z,h.sub(d,g)));i=h.dot(L,this.m_localAxisD)-h.dot(V,this.m_localAxisD)}var F=e+this.m_ratio*i-this.m_constant,D=0;return S>0&&(D=-F/S),u.addMul(this.m_mA*D,s),p+=this.m_iA*D*n,d.addMul(this.m_mB*D,o),y+=this.m_iB*D*a,f.subMul(this.m_mC*D,s),v-=this.m_iC*D*c,g.subMul(this.m_mD*D,o),x-=this.m_iD*D*l,this.m_bodyA.c_position.c.set(u),this.m_bodyA.c_position.a=p,this.m_bodyB.c_position.c.set(d),this.m_bodyB.c_position.a=y,this.m_bodyC.c_position.c.set(f),this.m_bodyC.c_position.a=v,this.m_bodyD.c_position.c.set(g),this.m_bodyD.c_position.a=x,0<r.linearSlop}},5868:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=r;var o=i(2088);function n(){this.other=null,this.joint=null,this.prev=null,this.next=null}function r(t,e,i){e=t.bodyA||e,i=t.bodyB||i,s&&o.assert(e),s&&o.assert(i),s&&o.assert(e!=i),this.m_type="unknown-joint",this.m_bodyA=e,this.m_bodyB=i,this.m_index=0,this.m_collideConnected=!!t.collideConnected,this.m_prev=null,this.m_next=null,this.m_edgeA=new n,this.m_edgeB=new n,this.m_islandFlag=!1,this.m_userData=t.userData}r.TYPES={},r._deserialize=function(t,e,i){var s=r.TYPES[t.type];return s&&i(s,t)},r.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},r.prototype.getType=function(){return this.m_type},r.prototype.getBodyA=function(){return this.m_bodyA},r.prototype.getBodyB=function(){return this.m_bodyB},r.prototype.getNext=function(){return this.m_next},r.prototype.getUserData=function(){return this.m_userData},r.prototype.setUserData=function(t){this.m_userData=t},r.prototype.getCollideConnected=function(){return this.m_collideConnected},r.prototype.getAnchorA=function(){},r.prototype.getAnchorB=function(){},r.prototype.getReactionForce=function(t){},r.prototype.getReactionTorque=function(t){},r.prototype.shiftOrigin=function(t){},r.prototype.initVelocityConstraints=function(t){},r.prototype.solveVelocityConstraints=function(t){},r.prototype.solvePositionConstraints=function(t){}},6025:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(2088),n=i(4299),r=(i(7191),i(3216)),a=i(4474),h=(i(905),i(5154)),m=(i(4052),i(2669)),c=(i(4124),i(1428),i(9753),i(4529),i(5868)),l=i(8878);u.TYPE="friction-joint",c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var _={maxForce:0,maxTorque:0};function u(t,e,i,s){if(!(this instanceof u))return new u(t,e,i,s);t=n(t,_),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_localAnchorA=a.clone(s?e.getLocalPoint(s):t.localAnchorA||a.zero()),this.m_localAnchorB=a.clone(s?i.getLocalPoint(s):t.localAnchorB||a.zero()),this.m_linearImpulse=a.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(l,t.bodyA,e),t.bodyB=i(l,t.bodyB,e),new u(t)},u.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},u.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},u.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},u.prototype.setMaxForce=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxForce=t},u.prototype.getMaxForce=function(){return this.m_maxForce},u.prototype.setMaxTorque=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxTorque=t},u.prototype.getMaxTorque=function(){return this.m_maxTorque},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return a.mul(t,this.m_linearImpulse)},u.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,c=m.neo(e),l=m.neo(o);this.m_rA=m.mulVec2(c,a.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=m.mulVec2(l,a.sub(this.m_localAnchorB,this.m_localCenterB));var _=this.m_invMassA,u=this.m_invMassB,p=this.m_invIA,d=this.m_invIB,y=new h;if(y.ex.x=_+u+p*this.m_rA.y*this.m_rA.y+d*this.m_rB.y*this.m_rB.y,y.ex.y=-p*this.m_rA.x*this.m_rA.y-d*this.m_rB.x*this.m_rB.y,y.ey.x=y.ex.y,y.ey.y=_+u+p*this.m_rA.x*this.m_rA.x+d*this.m_rB.x*this.m_rB.x,this.m_linearMass=y.getInverse(),this.m_angularMass=p+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var f=a.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(_,f),s-=p*(a.cross(this.m_rA,f)+this.m_angularImpulse),n.addMul(u,f),r+=d*(a.cross(this.m_rB,f)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,_=t.dt,u=o-i,p=-this.m_angularMass*u,d=this.m_angularImpulse,y=_*this.m_maxTorque;this.m_angularImpulse=r.clamp(this.m_angularImpulse+p,-y,y),i-=c*(p=this.m_angularImpulse-d),o+=l*p,u=a.sub(a.add(s,a.cross(o,this.m_rB)),a.add(e,a.cross(i,this.m_rA))),p=a.neg(h.mulVec2(this.m_linearMass,u)),d=this.m_linearImpulse,this.m_linearImpulse.add(p),y=_*this.m_maxForce,this.m_linearImpulse.lengthSquared()>y*y&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(y)),p=a.sub(this.m_linearImpulse,d),e.subMul(n,p),i-=c*a.cross(this.m_rA,p),s.addMul(m,p),o+=l*a.cross(this.m_rB,p),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){return!0}},6052:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(2088),n=i(4299),r=i(7191),a=i(3216),h=i(4474),m=(i(905),i(5154),i(4052),i(2669)),c=(i(4124),i(1428),i(9753),i(4529),i(5868)),l=i(8878);u.TYPE="pulley-joint",u.MIN_PULLEY_LENGTH=2,c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var _={collideConnected:!0};function u(t,e,i,r,m,l,p,d){if(!(this instanceof u))return new u(t,e,i,r,m,l,p,d);t=n(t,_),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_groundAnchorA=r||t.groundAnchorA||h.neo(-1,1),this.m_groundAnchorB=m||t.groundAnchorB||h.neo(1,1),this.m_localAnchorA=l?e.getLocalPoint(l):t.localAnchorA||h.neo(-1,0),this.m_localAnchorB=p?i.getLocalPoint(p):t.localAnchorB||h.neo(1,0),this.m_lengthA=a.isFinite(t.lengthA)?t.lengthA:h.distance(l,r),this.m_lengthB=a.isFinite(t.lengthB)?t.lengthB:h.distance(p,m),this.m_ratio=a.isFinite(d)?d:t.ratio,s&&o.assert(d>a.EPSILON),this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0,this.m_uA,this.m_uB,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(l,t.bodyA,e),t.bodyB=i(l,t.bodyB,e),new u(t)},u.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},u.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},u.prototype.getLengthA=function(){return this.m_lengthA},u.prototype.getLengthB=function(){return this.m_lengthB},u.prototype.getRatio=function(){return this.m_ratio},u.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return h.distance(t,e)},u.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return h.distance(t,e)},u.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},u.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},u.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},u.prototype.getReactionForce=function(t){return h.mul(this.m_impulse,this.m_uB).mul(t)},u.prototype.getReactionTorque=function(t){return 0},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,a=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=m.neo(i),u=m.neo(a);this.m_rA=m.mulVec2(_,h.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=m.mulVec2(u,h.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=h.sub(h.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=h.sub(h.add(n,this.m_rB),this.m_groundAnchorB);var p=this.m_uA.length(),d=this.m_uB.length();p>10*r.linearSlop?this.m_uA.mul(1/p):this.m_uA.setZero(),d>10*r.linearSlop?this.m_uB.mul(1/d):this.m_uB.setZero();var y=h.cross(this.m_rA,this.m_uA),f=h.cross(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*y*y,g=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=v+this.m_ratio*this.m_ratio*g,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var x=h.mul(-this.m_impulse,this.m_uA),A=h.mul(-this.m_ratio*this.m_impulse,this.m_uB);s.addMul(this.m_invMassA,x),o+=this.m_invIA*h.cross(this.m_rA,x),c.addMul(this.m_invMassB,A),l+=this.m_invIB*h.cross(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=l},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=h.add(e,h.cross(i,this.m_rA)),r=h.add(s,h.cross(o,this.m_rB)),a=-h.dot(this.m_uA,n)-this.m_ratio*h.dot(this.m_uB,r),m=-this.m_mass*a;this.m_impulse+=m;var c=h.mul(-m,this.m_uA),l=h.mul(-this.m_ratio*m,this.m_uB);e.addMul(this.m_invMassA,c),i+=this.m_invIA*h.cross(this.m_rA,c),s.addMul(this.m_invMassB,l),o+=this.m_invIB*h.cross(this.m_rB,l),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=m.neo(i),c=m.neo(o),l=m.mulVec2(n,h.sub(this.m_localAnchorA,this.m_localCenterA)),_=m.mulVec2(c,h.sub(this.m_localAnchorB,this.m_localCenterB)),u=h.sub(h.add(e,this.m_rA),this.m_groundAnchorA),p=h.sub(h.add(s,this.m_rB),this.m_groundAnchorB),d=u.length(),y=p.length();d>10*r.linearSlop?u.mul(1/d):u.setZero(),y>10*r.linearSlop?p.mul(1/y):p.setZero();var f=h.cross(l,u),v=h.cross(_,p),g=this.m_invMassA+this.m_invIA*f*f,x=this.m_invMassB+this.m_invIB*v*v,A=g+this.m_ratio*this.m_ratio*x;A>0&&(A=1/A);var b=this.m_constant-d-this.m_ratio*y,B=a.abs(b),w=-A*b,S=h.mul(-w,u),M=h.mul(-this.m_ratio*w,p);return e.addMul(this.m_invMassA,S),i+=this.m_invIA*h.cross(l,S),s.addMul(this.m_invMassB,M),o+=this.m_invIB*h.cross(_,M),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,B<r.linearSlop}},6130:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,i(2088);var s=i(4474),o=i(1428),n=i(3216),r=i(2669);function a(){this.type,this.localNormal=s.zero(),this.localPoint=s.zero(),this.points=[new h,new h],this.pointCount=0}function h(){this.localPoint=s.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new m}function m(){this.cf=new c}function c(){this.indexA,this.indexB,this.typeA,this.typeB}function l(){this.normal,this.points=[],this.separations=[]}t.exports=a,t.exports.clipSegmentToLine=function(t,e,i,o,n){var r=0,h=s.dot(i,e[0].v)-o,m=s.dot(i,e[1].v)-o;if(h<=0&&t[r++].set(e[0]),m<=0&&t[r++].set(e[1]),h*m<0){var c=h/(h-m);t[r].v.setCombine(1-c,e[0].v,c,e[1].v),t[r].id.cf.indexA=n,t[r].id.cf.indexB=e[0].id.cf.indexB,t[r].id.cf.typeA=a.e_vertex,t[r].id.cf.typeB=a.e_face,++r}return r},t.exports.clipVertex=u,t.exports.getPointStates=function(t,e,i,s){for(var o=0;o<i.pointCount;++o){var n=i.points[o].id;t[o]=_.removeState;for(var r=0;r<s.pointCount;++r)if(s.points[r].id.key==n.key){t[o]=_.persistState;break}}for(o=0;o<s.pointCount;++o)for(n=s.points[o].id,e[o]=_.addState,r=0;r<i.pointCount;++r)if(i.points[r].id.key==n.key){e[o]=_.persistState;break}},t.exports.PointState=_,a.e_circles=0,a.e_faceA=1,a.e_faceB=2,a.e_vertex=0,a.e_face=1,Object.defineProperty(m.prototype,"key",{get:function(){return this.cf.indexA+4*this.cf.indexB+16*this.cf.typeA+64*this.cf.typeB},enumerable:!0,configurable:!0}),m.prototype.set=function(t){this.cf.set(t.cf)},c.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},a.prototype.getWorldManifold=function(t,e,i,h,m){if(0!=this.pointCount){var c=(t=t||new l).normal,_=t.points,u=t.separations;switch(this.type){case a.e_circles:c=s.neo(1,0);var p=o.mulVec2(e,this.localPoint),d=o.mulVec2(h,this.points[0].localPoint),y=s.sub(d,p);s.lengthSquared(y)>n.EPSILON*n.EPSILON&&(c.set(y),c.normalize());var f=p.clone().addMul(i,c),v=d.clone().addMul(-m,c);_[0]=s.mid(f,v),u[0]=s.dot(s.sub(v,f),c),_.length=1,u.length=1;break;case a.e_faceA:c=r.mulVec2(e.q,this.localNormal);for(var g=o.mulVec2(e,this.localPoint),x=0;x<this.pointCount;++x){var A=o.mulVec2(h,this.points[x].localPoint);f=s.clone(A).addMul(i-s.dot(s.sub(A,g),c),c),v=s.clone(A).subMul(m,c),_[x]=s.mid(f,v),u[x]=s.dot(s.sub(v,f),c)}_.length=this.pointCount,u.length=this.pointCount;break;case a.e_faceB:for(c=r.mulVec2(h.q,this.localNormal),g=o.mulVec2(h,this.localPoint),x=0;x<this.pointCount;++x)A=o.mulVec2(e,this.points[x].localPoint),v=s.combine(1,A,m-s.dot(s.sub(A,g),c),c),f=s.combine(1,A,-i,c),_[x]=s.mid(f,v),u[x]=s.dot(s.sub(f,v),c);_.length=this.pointCount,u.length=this.pointCount,c.mul(-1)}return t.normal=c,t.points=_,t.separations=u,t}};var _={nullState:0,addState:1,persistState:2,removeState:3};function u(){this.v=s.zero(),this.id=new m}u.prototype.set=function(t){this.v.set(t.v),this.id.set(t.id)}},6773:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=f;var o=i(2088),n=i(4299),r=i(7191),a=i(3216),h=i(4474),m=i(905),c=i(5154),l=i(4052),_=i(2669),u=(i(4124),i(1428),i(9753),i(4529),i(5868)),p=i(8878),d=0;f.TYPE="revolute-joint",u.TYPES[f.TYPE]=f,f._super=u,f.prototype=Object.create(f._super.prototype);var y={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};function f(t,e,i,s){if(!(this instanceof f))return new f(t,e,i,s);t=n(t,y),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=f.TYPE,this.m_localAnchorA=h.clone(s?e.getLocalPoint(s):t.localAnchorA||h.zero()),this.m_localAnchorB=h.clone(s?i.getLocalPoint(s):t.localAnchorB||h.zero()),this.m_referenceAngle=a.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=m(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new l,this.m_motorMass,this.m_limitState=d}f.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},f._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(p,t.bodyA,e),t.bodyB=i(p,t.bodyB,e),new f(t)},f.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},f.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.getReferenceAngle=function(){return this.m_referenceAngle},f.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},f.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},f.prototype.isMotorEnabled=function(){return this.m_enableMotor},f.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},f.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},f.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},f.prototype.getMotorSpeed=function(){return this.m_motorSpeed},f.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},f.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},f.prototype.isLimitEnabled=function(){return this.m_enableLimit},f.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},f.prototype.getLowerLimit=function(){return this.m_lowerAngle},f.prototype.getUpperLimit=function(){return this.m_upperAngle},f.prototype.setLimits=function(t,e){s&&o.assert(t<=e),t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},f.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(t){return h.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},f.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},f.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,c=_.neo(e),l=_.neo(o);this.m_rA=_.mulVec2(c,h.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=_.mulVec2(l,h.sub(this.m_localAnchorB,this.m_localCenterB));var u=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,v=y+f===0;if(this.m_mass.ex.x=u+p+this.m_rA.y*this.m_rA.y*y+this.m_rB.y*this.m_rB.y*f,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*y-this.m_rB.y*this.m_rB.x*f,this.m_mass.ez.x=-this.m_rA.y*y-this.m_rB.y*f,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=u+p+this.m_rA.x*this.m_rA.x*y+this.m_rB.x*this.m_rB.x*f,this.m_mass.ez.y=this.m_rA.x*y+this.m_rB.x*f,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=y+f,this.m_motorMass=y+f,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||v)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==v){var g=o-e-this.m_referenceAngle;a.abs(this.m_upperAngle-this.m_lowerAngle)<2*r.angularSlop?this.m_limitState=3:g<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):g>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=d,this.m_impulse.z=0)}else this.m_limitState=d;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var x=h.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(u,x),s-=y*(h.cross(this.m_rA,x)+this.m_motorImpulse+this.m_impulse.z),n.addMul(p,x),m+=f*(h.cross(this.m_rB,x)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=m},f.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,_=c+l===0;if(this.m_enableMotor&&3!=this.m_limitState&&0==_){var u=o-i-this.m_motorSpeed,p=-this.m_motorMass*u,y=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=a.clamp(this.m_motorImpulse+p,-f,f),i-=c*(p=this.m_motorImpulse-y),o+=l*p}if(this.m_enableLimit&&this.m_limitState!=d&&0==_){var v=h.zero();v.addCombine(1,s,1,h.cross(o,this.m_rB)),v.subCombine(1,e,1,h.cross(i,this.m_rA));var g=o-i;if(u=m(v.x,v.y,g),p=m.neg(this.m_mass.solve33(u)),3==this.m_limitState)this.m_impulse.add(p);else if(1==this.m_limitState)if(this.m_impulse.z+p.z<0){var x=h.combine(-1,v,this.m_impulse.z,h.neo(this.m_mass.ez.x,this.m_mass.ez.y)),A=this.m_mass.solve22(x);p.x=A.x,p.y=A.y,p.z=-this.m_impulse.z,this.m_impulse.x+=A.x,this.m_impulse.y+=A.y,this.m_impulse.z=0}else this.m_impulse.add(p);else 2==this.m_limitState&&(this.m_impulse.z+p.z>0?(x=h.combine(-1,v,this.m_impulse.z,h.neo(this.m_mass.ez.x,this.m_mass.ez.y)),A=this.m_mass.solve22(x),p.x=A.x,p.y=A.y,p.z=-this.m_impulse.z,this.m_impulse.x+=A.x,this.m_impulse.y+=A.y,this.m_impulse.z=0):this.m_impulse.add(p));var b=h.neo(p.x,p.y);e.subMul(n,b),i-=c*(h.cross(this.m_rA,b)+p.z),s.addMul(r,b),o+=l*(h.cross(this.m_rB,b)+p.z)}else(u=h.zero()).addCombine(1,s,1,h.cross(o,this.m_rB)),u.subCombine(1,e,1,h.cross(i,this.m_rA)),p=this.m_mass.solve22(h.neg(u)),this.m_impulse.x+=p.x,this.m_impulse.y+=p.y,e.subMul(n,p),i-=c*h.cross(this.m_rA,p),s.addMul(r,p),o+=l*h.cross(this.m_rB,p);this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},f.prototype.solvePositionConstraints=function(t){var e,i=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,m=_.neo(s),l=_.neo(n),u=0,p=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&this.m_limitState!=d&&0==p){var y=n-s-this.m_referenceAngle,f=0;if(3==this.m_limitState){var v=a.clamp(y-this.m_lowerAngle,-r.maxAngularCorrection,r.maxAngularCorrection);f=-this.m_motorMass*v,u=a.abs(v)}else 1==this.m_limitState?(u=-(v=y-this.m_lowerAngle),v=a.clamp(v+r.angularSlop,-r.maxAngularCorrection,0),f=-this.m_motorMass*v):2==this.m_limitState&&(u=v=y-this.m_upperAngle,v=a.clamp(v-r.angularSlop,0,r.maxAngularCorrection),f=-this.m_motorMass*v);s-=this.m_invIA*f,n+=this.m_invIB*f}m.set(s),l.set(n);var g=_.mulVec2(m,h.sub(this.m_localAnchorA,this.m_localCenterA)),x=_.mulVec2(l,h.sub(this.m_localAnchorB,this.m_localCenterB));(v=h.zero()).addCombine(1,o,1,x),v.subCombine(1,i,1,g),e=v.length();var A=this.m_invMassA,b=this.m_invMassB,B=this.m_invIA,w=this.m_invIB,S=new c;S.ex.x=A+b+B*g.y*g.y+w*x.y*x.y,S.ex.y=-B*g.x*g.y-w*x.x*x.y,S.ey.x=S.ex.y,S.ey.y=A+b+B*g.x*g.x+w*x.x*x.x;var M=h.neg(S.solve(v));return i.subMul(A,M),s-=B*h.cross(g,M),o.addMul(b,M),n+=w*h.cross(x,M),this.m_bodyA.c_position.c.set(i),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.set(o),this.m_bodyB.c_position.a=n,e<=r.linearSlop&&u<=r.angularSlop}},6795:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=f;var o=i(2088),n=i(4299),r=i(7191),a=i(3216),h=i(4474),m=i(905),c=i(5154),l=i(4052),_=i(2669),u=(i(4124),i(1428),i(9753),i(4529),i(5868)),p=i(8878),d=0;f.TYPE="prismatic-joint",u.TYPES[f.TYPE]=f,f._super=u,f.prototype=Object.create(f._super.prototype);var y={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};function f(t,e,i,s,o){if(!(this instanceof f))return new f(t,e,i,s,o);t=n(t,y),u.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=f.TYPE,this.m_localAnchorA=h.clone(s?e.getLocalPoint(s):t.localAnchorA||h.zero()),this.m_localAnchorB=h.clone(s?i.getLocalPoint(s):t.localAnchorB||h.zero()),this.m_localXAxisA=h.clone(o?e.getLocalVector(o):t.localAxisA||h.neo(1,0)),this.m_localXAxisA.normalize(),this.m_localYAxisA=h.cross(1,this.m_localXAxisA),this.m_referenceAngle=a.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=m(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=d,this.m_axis=h.zero(),this.m_perp=h.zero(),this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_axis,this.m_perp,this.m_s1,this.m_s2,this.m_a1,this.m_a2,this.m_K=new l,this.m_motorMass}f.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},f._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(p,t.bodyA,e),t.bodyB=i(p,t.bodyB,e),t.localAxisA=h(t.localAxisA),new f(t)},f.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.set(t.localAxisA),this.m_localYAxisA.set(h.cross(1,t.localAxisA)))},f.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},f.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},f.prototype.getLocalAxisA=function(){return this.m_localXAxisA},f.prototype.getReferenceAngle=function(){return this.m_referenceAngle},f.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=h.sub(e,t),s=this.m_bodyA.getWorldVector(this.m_localXAxisA);return h.dot(i,s)},f.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=_.mulVec2(t.m_xf.q,h.sub(this.m_localAnchorA,t.m_sweep.localCenter)),s=_.mulVec2(e.m_xf.q,h.sub(this.m_localAnchorB,e.m_sweep.localCenter)),o=h.add(t.m_sweep.c,i),n=h.add(e.m_sweep.c,s),r=h.sub(n,o),a=_.mulVec2(t.m_xf.q,this.m_localXAxisA),m=t.m_linearVelocity,c=e.m_linearVelocity,l=t.m_angularVelocity,u=e.m_angularVelocity;return h.dot(r,h.cross(l,a))+h.dot(a,h.sub(h.addCross(c,u,s),h.addCross(m,l,i)))},f.prototype.isLimitEnabled=function(){return this.m_enableLimit},f.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},f.prototype.getLowerLimit=function(){return this.m_lowerTranslation},f.prototype.getUpperLimit=function(){return this.m_upperTranslation},f.prototype.setLimits=function(t,e){s&&o.assert(t<=e),t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},f.prototype.isMotorEnabled=function(){return this.m_enableMotor},f.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},f.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},f.prototype.setMaxMotorForce=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},f.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},f.prototype.getMotorSpeed=function(){return this.m_motorSpeed},f.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},f.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},f.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},f.prototype.getReactionForce=function(t){return h.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},f.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},f.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,m=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,u=_.neo(i),p=_.neo(m),y=_.mulVec2(u,h.sub(this.m_localAnchorA,this.m_localCenterA)),f=_.mulVec2(p,h.sub(this.m_localAnchorB,this.m_localCenterB)),v=h.zero();v.addCombine(1,n,1,f),v.subCombine(1,e,1,y);var g=this.m_invMassA,x=this.m_invMassB,A=this.m_invIA,b=this.m_invIB;this.m_axis=_.mulVec2(u,this.m_localXAxisA),this.m_a1=h.cross(h.add(v,y),this.m_axis),this.m_a2=h.cross(f,this.m_axis),this.m_motorMass=g+x+A*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=_.mulVec2(u,this.m_localYAxisA),this.m_s1=h.cross(h.add(v,y),this.m_perp),this.m_s2=h.cross(f,this.m_perp),h.cross(y,this.m_perp);var B=g+x+A*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,w=A*this.m_s1+b*this.m_s2,S=A*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,M=A+b;0==M&&(M=1);var C=A*this.m_a1+b*this.m_a2,I=g+x+A*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_K.ex.set(B,w,S),this.m_K.ey.set(w,M,C),this.m_K.ez.set(S,C,I),this.m_enableLimit){var T=h.dot(this.m_axis,v);a.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*r.linearSlop?this.m_limitState=3:T<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):T>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=d,this.m_impulse.z=0)}else this.m_limitState=d,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var P=h.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),E=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,z=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.subMul(g,P),o-=A*E,c.addMul(x,P),l+=b*z}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.set(c),this.m_bodyB.c_velocity.w=l},f.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,c=this.m_invIA,l=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var _=h.dot(this.m_axis,h.sub(s,e))+this.m_a2*o-this.m_a1*i,u=this.m_motorMass*(this.m_motorSpeed-_),p=this.m_motorImpulse,y=t.dt*this.m_maxMotorForce;this.m_motorImpulse=a.clamp(this.m_motorImpulse+u,-y,y),u=this.m_motorImpulse-p;var f=h.mul(u,this.m_axis),v=u*this.m_a1,g=u*this.m_a2;e.subMul(n,f),i-=c*v,s.addMul(r,f),o+=l*g}var x=h.zero();if(x.x+=h.dot(this.m_perp,s)+this.m_s2*o,x.x-=h.dot(this.m_perp,e)+this.m_s1*i,x.y=o-i,this.m_enableLimit&&this.m_limitState!=d){var A=0;A+=h.dot(this.m_axis,s)+this.m_a2*o,A-=h.dot(this.m_axis,e)+this.m_a1*i,_=m(x.x,x.y,A);var b=m(this.m_impulse),B=this.m_K.solve33(m.neg(_));this.m_impulse.add(B),1==this.m_limitState?this.m_impulse.z=a.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=a.min(this.m_impulse.z,0));var w=h.combine(-1,x,-(this.m_impulse.z-b.z),h.neo(this.m_K.ez.x,this.m_K.ez.y)),S=h.add(this.m_K.solve22(w),h.neo(b.x,b.y));this.m_impulse.x=S.x,this.m_impulse.y=S.y,B=m.sub(this.m_impulse,b),f=h.combine(B.x,this.m_perp,B.z,this.m_axis),v=B.x*this.m_s1+B.y+B.z*this.m_a1,g=B.x*this.m_s2+B.y+B.z*this.m_a2,e.subMul(n,f),i-=c*v,s.addMul(r,f),o+=l*g}else B=this.m_K.solve22(h.neg(x)),this.m_impulse.x+=B.x,this.m_impulse.y+=B.y,f=h.mul(B.x,this.m_perp),v=B.x*this.m_s1+B.y,g=B.x*this.m_s2+B.y,e.subMul(n,f),i-=c*v,s.addMul(r,f),o+=l*g;this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},f.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=_.neo(i),u=_.neo(o),p=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,v=_.mulVec2(n,h.sub(this.m_localAnchorA,this.m_localCenterA)),g=_.mulVec2(u,h.sub(this.m_localAnchorB,this.m_localCenterB)),x=h.sub(h.add(s,g),h.add(e,v)),A=_.mulVec2(n,this.m_localXAxisA),b=h.cross(h.add(x,v),A),B=h.cross(g,A),w=_.mulVec2(n,this.m_localYAxisA),S=h.cross(h.add(x,v),w),M=h.cross(g,w),C=m(),I=h.zero();I.x=h.dot(w,x),I.y=o-i-this.m_referenceAngle;var T=a.abs(I.x),P=a.abs(I.y),E=r.linearSlop,z=r.maxLinearCorrection,V=!1,L=0;if(this.m_enableLimit){var F=h.dot(A,x);a.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*E?(L=a.clamp(F,-z,z),T=a.max(T,a.abs(F)),V=!0):F<=this.m_lowerTranslation?(L=a.clamp(F-this.m_lowerTranslation+E,-z,0),T=a.max(T,this.m_lowerTranslation-F),V=!0):F>=this.m_upperTranslation&&(L=a.clamp(F-this.m_upperTranslation-E,0,z),T=a.max(T,F-this.m_upperTranslation),V=!0)}if(V){var D=p+d+y*S*S+f*M*M,k=y*S+f*M,R=y*S*b+f*M*B;0==(O=y+f)&&(O=1);var q=y*b+f*B,j=p+d+y*b*b+f*B*B;(U=new l).ex.set(D,k,R),U.ey.set(k,O,q),U.ez.set(R,q,j);var G=m();G.x=I.x,G.y=I.y,G.z=L,C=U.solve33(m.neg(G))}else{var O,U;D=p+d+y*S*S+f*M*M,k=y*S+f*M,0==(O=y+f)&&(O=1),(U=new c).ex.set(D,k),U.ey.set(k,O);var N=U.solve(h.neg(I));C.x=N.x,C.y=N.y,C.z=0}var Y=h.combine(C.x,w,C.z,A),J=C.x*S+C.y+C.z*b,H=C.x*M+C.y+C.z*B;return e.subMul(p,Y),i-=y*J,s.addMul(d,Y),o+=f*H,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,T<=r.linearSlop&&P<=r.angularSlop}},6984:function(t){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports.now=function(){return Date.now()},t.exports.diff=function(t){return Date.now()-t}},7154:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=l;var s=i(4299),o=i(7191),n=i(3216),r=i(4474),a=(i(905),i(5154),i(4052),i(2669)),h=(i(4124),i(1428),i(9753),i(4529),i(5868)),m=i(8878);l.TYPE="wheel-joint",h.TYPES[l.TYPE]=l,l._super=h,l.prototype=Object.create(l._super.prototype);var c={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};function l(t,e,i,o,n){if(!(this instanceof l))return new l(t,e,i,o,n);t=s(t,c),h.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=l.TYPE,this.m_localAnchorA=r.clone(o?e.getLocalPoint(o):t.localAnchorA||r.zero()),this.m_localAnchorB=r.clone(o?i.getLocalPoint(o):t.localAnchorB||r.zero()),this.m_localXAxisA=r.clone(n?e.getLocalVector(n):t.localAxisA||t.localAxis||r.neo(1,0)),this.m_localYAxisA=r.cross(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_ax=r.zero(),this.m_ay=r.zero(),this.m_sAx,this.m_sBx,this.m_sAy,this.m_sBy}l.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},l._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(m,t.bodyA,e),t.bodyB=i(m,t.bodyB,e),new l(t)},l.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.set(t.localAxisA),this.m_localYAxisA.set(r.cross(1,t.localAxisA)))},l.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},l.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},l.prototype.getLocalAxisA=function(){return this.m_localXAxisA},l.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),s=e.getWorldPoint(this.m_localAnchorB),o=r.sub(s,i),n=t.getWorldVector(this.m_localXAxisA);return r.dot(o,n)},l.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},l.prototype.isMotorEnabled=function(){return this.m_enableMotor},l.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},l.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},l.prototype.getMotorSpeed=function(){return this.m_motorSpeed},l.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},l.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},l.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},l.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},l.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},l.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},l.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},l.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},l.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},l.prototype.getReactionForce=function(t){return r.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},l.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},l.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,h=this.m_bodyA.c_position.c,m=this.m_bodyA.c_position.a,c=this.m_bodyA.c_velocity.v,l=this.m_bodyA.c_velocity.w,_=this.m_bodyB.c_position.c,u=this.m_bodyB.c_position.a,p=this.m_bodyB.c_velocity.v,d=this.m_bodyB.c_velocity.w,y=a.neo(m),f=a.neo(u),v=a.mulVec2(y,r.sub(this.m_localAnchorA,this.m_localCenterA)),g=a.mulVec2(f,r.sub(this.m_localAnchorB,this.m_localCenterB));if((B=r.zero()).addCombine(1,_,1,g),B.subCombine(1,h,1,v),this.m_ay=a.mulVec2(y,this.m_localYAxisA),this.m_sAy=r.cross(r.add(B,v),this.m_ay),this.m_sBy=r.cross(g,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=a.mulVec2(y,this.m_localXAxisA),this.m_sAx=r.cross(r.add(B,v),this.m_ax),this.m_sBx=r.cross(g,this.m_ax);var x=e+i+s*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(x>0){this.m_springMass=1/x;var A=r.dot(B,this.m_ax),b=2*n.PI*this.m_frequencyHz,B=2*this.m_springMass*this.m_dampingRatio*b,w=this.m_springMass*b*b,S=t.dt;this.m_gamma=S*(B+S*w),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=A*S*w*this.m_gamma,this.m_springMass=x+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var M=r.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),C=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,I=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;c.subMul(this.m_invMassA,M),l-=this.m_invIA*C,p.addMul(this.m_invMassB,M),d+=this.m_invIB*I}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.set(c),this.m_bodyA.c_velocity.w=l,this.m_bodyB.c_velocity.v.set(p),this.m_bodyB.c_velocity.w=d},l.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,a=this.m_bodyA.c_velocity.v,h=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_velocity.v,c=this.m_bodyB.c_velocity.w,l=r.dot(this.m_ax,m)-r.dot(this.m_ax,a)+this.m_sBx*c-this.m_sAx*h,_=-this.m_springMass*(l+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=_;var u=r.mul(_,this.m_ax),p=_*this.m_sAx,d=_*this.m_sBx;a.subMul(e,u),h-=s*p,m.addMul(i,u),l=(c+=o*d)-h-this.m_motorSpeed,_=-this.m_motorMass*l;var y=this.m_motorImpulse,f=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=n.clamp(this.m_motorImpulse+_,-f,f),h-=s*(_=this.m_motorImpulse-y),c+=o*_,l=r.dot(this.m_ay,m)-r.dot(this.m_ay,a)+this.m_sBy*c-this.m_sAy*h,_=-this.m_mass*l,this.m_impulse+=_,u=r.mul(_,this.m_ay),p=_*this.m_sAy,d=_*this.m_sBy,a.subMul(e,u),h-=s*p,m.addMul(i,u),c+=o*d,this.m_bodyA.c_velocity.v.set(a),this.m_bodyA.c_velocity.w=h,this.m_bodyB.c_velocity.v.set(m),this.m_bodyB.c_velocity.w=c},l.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,m=a.neo(i),c=a.neo(h),l=a.mulVec2(m,r.sub(this.m_localAnchorA,this.m_localCenterA)),_=a.mulVec2(c,r.sub(this.m_localAnchorB,this.m_localCenterB)),u=r.zero();u.addCombine(1,s,1,_),u.subCombine(1,e,1,l);var p,d=a.mulVec2(m,this.m_localYAxisA),y=r.cross(r.add(u,l),d),f=r.cross(_,d),v=r.dot(u,d),g=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;p=0!=g?-v/g:0;var x=r.mul(p,d),A=p*y,b=p*f;return e.subMul(this.m_invMassA,x),i-=this.m_invIA*A,s.addMul(this.m_invMassB,x),h+=this.m_invIB*b,this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=h,n.abs(v)<=o.linearSlop}},7191:function(t,e){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT;var i=e;i.maxManifoldPoints=2,i.maxPolygonVertices=12,i.aabbExtension=.1,i.aabbMultiplier=2,i.linearSlop=.005,i.linearSlopSquared=i.linearSlop*i.linearSlop,i.angularSlop=2/180*Math.PI,i.polygonRadius=2*i.linearSlop,i.maxSubSteps=8,i.maxTOIContacts=32,i.maxTOIIterations=20,i.maxDistnceIterations=20,i.velocityThreshold=1,i.maxLinearCorrection=.2,i.maxAngularCorrection=8/180*Math.PI,i.maxTranslation=2,i.maxTranslationSquared=i.maxTranslation*i.maxTranslation,i.maxRotation=.5*Math.PI,i.maxRotationSquared=i.maxRotation*i.maxRotation,i.baumgarte=.2,i.toiBaugarte=.75,i.timeToSleep=.5,i.linearSleepTolerance=.01,i.linearSleepToleranceSqr=Math.pow(i.linearSleepTolerance,2),i.angularSleepTolerance=2/180*Math.PI,i.angularSleepToleranceSqr=Math.pow(i.angularSleepTolerance,2)},7221:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT,n=(i(7191),i(2088)),r=i(3216),a=i(4474);function h(t,e){if(!(this instanceof h))return new h(t,e);this.lowerBound=a.zero(),this.upperBound=a.zero(),"object"==typeof t&&this.lowerBound.set(t),"object"==typeof e?this.upperBound.set(e):"object"==typeof t&&this.upperBound.set(t)}t.exports=h,h.prototype.isValid=function(){return h.isValid(this)},h.isValid=function(t){var e=a.sub(t.upperBound,t.lowerBound);return e.x>=0&&e.y>=0&&a.isValid(t.lowerBound)&&a.isValid(t.upperBound)},h.assert=function(t){if(o&&!h.isValid(t))throw s&&n.debug(t),new Error("Invalid AABB!")},h.prototype.getCenter=function(){return a.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))},h.prototype.getExtents=function(){return a.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))},h.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},h.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,s=t.upperBound,o=e.lowerBound,n=e.upperBound,a=r.min(i.x,o.x),h=r.min(i.y,o.y),m=r.max(n.x,s.x),c=r.max(n.y,s.y);this.lowerBound.set(a,h),this.upperBound.set(m,c)},h.prototype.combinePoints=function(t,e){this.lowerBound.set(r.min(t.x,e.x),r.min(t.y,e.y)),this.upperBound.set(r.max(t.x,e.x),r.max(t.y,e.y))},h.prototype.set=function(t){this.lowerBound.set(t.lowerBound.x,t.lowerBound.y),this.upperBound.set(t.upperBound.x,t.upperBound.y)},h.prototype.contains=function(t){var e=!0;return(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y},h.prototype.extend=function(t){return h.extend(this,t),this},h.extend=function(t,e){t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e},h.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,o=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0||o>0||s>0||n>0)},h.areEqual=function(t,e){return a.areEqual(t.lowerBound,e.lowerBound)&&a.areEqual(t.upperBound,e.upperBound)},h.diff=function(t,e){var i=r.max(0,r.min(t.upperBound.x,e.upperBound.x)-r.max(e.lowerBound.x,t.lowerBound.x)),s=r.max(0,r.min(t.upperBound.y,e.upperBound.y)-r.max(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*s},h.prototype.rayCast=function(t,e){for(var i=-1/0,s=1/0,o=e.p1,n=a.sub(e.p2,e.p1),h=a.abs(n),m=a.zero(),c="x";null!==c;c="x"===c?"y":null)if(h.x<r.EPSILON){if(o[c]<this.lowerBound[c]||this.upperBound[c]<o[c])return!1}else{var l=1/n[c],_=(this.lowerBound[c]-o[c])*l,u=(this.upperBound[c]-o[c])*l,p=-1;if(_>u){var d=_;_=u,u=d,p=1}if(_>i&&(m.setZero(),m[c]=p,i=_),i>(s=r.min(s,u)))return!1}return!(i<0||e.maxFraction<i||(t.fraction=i,t.normal=m,0))},h.prototype.toString=function(){return JSON.stringify(this)}},7608:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=u;var o=i(2088),n=i(4299),r=(i(7191),i(3216)),a=i(4474),h=(i(905),i(5154)),m=(i(4052),i(2669)),c=(i(4124),i(1428),i(9753),i(4529),i(5868)),l=i(8878);u.TYPE="motor-joint",c.TYPES[u.TYPE]=u,u._super=c,u.prototype=Object.create(u._super.prototype);var _={maxForce:1,maxTorque:1,correctionFactor:.3};function u(t,e,i){if(!(this instanceof u))return new u(t,e,i);t=n(t,_),c.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=u.TYPE,this.m_linearOffset=r.isFinite(t.linearOffset)?t.linearOffset:e.getLocalPoint(i.getPosition()),this.m_angularOffset=r.isFinite(t.angularOffset)?t.angularOffset:i.getAngle()-e.getAngle(),this.m_linearImpulse=a.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_linearError,this.m_angularError,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_linearMass,this.m_angularMass}u.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},u._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(l,t.bodyA,e),t.bodyB=i(l,t.bodyB,e),new u(t)},u.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB)},u.prototype.setMaxForce=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxForce=t},u.prototype.getMaxForce=function(){return this.m_maxForce},u.prototype.setMaxTorque=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_maxTorque=t},u.prototype.getMaxTorque=function(){return this.m_maxTorque},u.prototype.setCorrectionFactor=function(t){s&&o.assert(r.isFinite(t)&&0<=t&&t<=1),this.m_correctionFactor=t},u.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},u.prototype.setLinearOffset=function(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)},u.prototype.getLinearOffset=function(){return this.m_linearOffset},u.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},u.prototype.getAngularOffset=function(){return this.m_angularOffset},u.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},u.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},u.prototype.getReactionForce=function(t){return a.mul(t,this.m_linearImpulse)},u.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},u.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,c=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,_=m.neo(i),u=m.neo(r);this.m_rA=m.mulVec2(_,a.neg(this.m_localCenterA)),this.m_rB=m.mulVec2(u,a.neg(this.m_localCenterB));var p=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,f=this.m_invIB,v=new h;if(v.ex.x=p+d+y*this.m_rA.y*this.m_rA.y+f*this.m_rB.y*this.m_rB.y,v.ex.y=-y*this.m_rA.x*this.m_rA.y-f*this.m_rB.x*this.m_rB.y,v.ey.x=v.ex.y,v.ey.y=p+d+y*this.m_rA.x*this.m_rA.x+f*this.m_rB.x*this.m_rB.x,this.m_linearMass=v.getInverse(),this.m_angularMass=y+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=a.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_linearError.sub(m.mulVec2(_,this.m_linearOffset)),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var g=a.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(p,g),o-=y*(a.cross(this.m_rA,g)+this.m_angularImpulse),c.addMul(d,g),l+=f*(a.cross(this.m_rB,g)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=c,this.m_bodyB.c_velocity.w=l},u.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,_=t.dt,u=t.inv_dt,p=o-i+u*this.m_correctionFactor*this.m_angularError,d=-this.m_angularMass*p,y=this.m_angularImpulse,f=_*this.m_maxTorque;this.m_angularImpulse=r.clamp(this.m_angularImpulse+d,-f,f),i-=c*(d=this.m_angularImpulse-y),o+=l*d,(p=a.zero()).addCombine(1,s,1,a.cross(o,this.m_rB)),p.subCombine(1,e,1,a.cross(i,this.m_rA)),p.addMul(u*this.m_correctionFactor,this.m_linearError),d=a.neg(h.mulVec2(this.m_linearMass,p)),y=a.clone(this.m_linearImpulse),this.m_linearImpulse.add(d),f=_*this.m_maxForce,this.m_linearImpulse.clamp(f),d=a.sub(this.m_linearImpulse,y),e.subMul(n,d),i-=c*a.cross(this.m_rA,d),s.addMul(m,d),o+=l*a.cross(this.m_rB,d),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},u.prototype.solvePositionConstraints=function(t){return!0}},7632:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=(i(7191),i(2088)),n=i(3216),r=i(7221),a=i(9218);function h(){this.m_tree=new a,this.m_proxyCount=0,this.m_moveBuffer=[],this.queryCallback=this.queryCallback.bind(this)}t.exports=h,h.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},h.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return r.testOverlap(i,s)},h.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},h.prototype.getProxyCount=function(){return this.m_proxyCount},h.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},h.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},h.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},h.prototype.query=function(t,e){this.m_tree.query(t,e)},h.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},h.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},h.prototype.createProxy=function(t,e){s&&o.assert(r.isValid(t));var i=this.m_tree.createProxy(t,e);return this.m_proxyCount++,this.bufferMove(i),i},h.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},h.prototype.moveProxy=function(t,e,i){s&&o.assert(r.isValid(e)),this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},h.prototype.touchProxy=function(t){this.bufferMove(t)},h.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},h.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]==t&&(this.m_moveBuffer[e]=null)},h.prototype.updatePairs=function(t){for(s&&o.assert("function"==typeof t),this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},h.prototype.queryCallback=function(t){if(t==this.m_queryProxyId)return!0;var e=n.min(t,this.m_queryProxyId),i=n.max(t,this.m_queryProxyId),s=this.m_tree.getUserData(e),o=this.m_tree.getUserData(i);return this.m_callback(s,o),!0}},7713:function(t,e,i){var s=i(4200),o=i(8878),n=i(5868),r=i(9381),a=i(2409),h=i(4474),m=i(905),c=0;function l(t){var e=(t=t||{}).rootClass||s,i=t.preSerialize||function(t){return t},l=t.postSerialize||function(t,e){return t},_=t.preDeserialize||function(t){return t},u=t.postDeserialize||function(t,e){return t},p={World:s,Body:o,Joint:n,Fixture:r,Shape:a},d=Object.assign({Vec2:h,Vec3:m},p);this.toJson=function(t){var e=[],s=[t],o={};function n(t,i){if(t.__sid=t.__sid||++c,!o[t.__sid]){s.push(t);var n={refIndex:e.length+s.length,refType:i};o[t.__sid]=n}return o[t.__sid]}function r(t,e){if("object"!=typeof t||null===t)return t;if("function"==typeof t._serialize){if(t!==e)for(var s in p)if(t instanceof p[s])return n(t,s);t=function(t){var e=(t=i(t))._serialize();return l(e,t)}(t)}if(Array.isArray(t)){for(var o=[],a=0;a<t.length;a++)o[a]=r(t[a]);t=o}else{for(var a in o={},t)t.hasOwnProperty(a)&&(o[a]=r(t[a]));t=o}return t}for(;s.length;){var a=s.shift(),h=r(a,a);e.push(h)}return e},this.fromJson=function(t){var i={};function s(t,e,i){e=_(e);var s=t._deserialize(e,i,o);return u(s,e)}function o(e,o,n){if(!o.refIndex)return e&&e._deserialize&&s(e,o,n);e=d[o.refType]||e;var r=o.refIndex;if(!i[r]){var a=s(e,t[r],n);i[r]=a}return i[r]}return e._deserialize(t[0],null,o)}}t.exports=l;var _=new l;t.exports.toJson=_.toJson,t.exports.fromJson=_.fromJson},7945:function(t,e,i){var s="undefined"!=typeof DEBUG&&DEBUG,o="undefined"!=typeof ASSERT&&ASSERT;t.exports=f,t.exports.TimeStep=y;var n=i(7191),r=i(2088),a=i(4474),h=i(3216),m=i(8878),c=i(3960),l=i(5868),_=i(8025),u=_.Input,p=_.Output,d=i(9352);function y(t){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}function f(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}d.Input,d.Output,d.Proxy,d.Cache,y.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},f.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},f.prototype.addBody=function(t){o&&r.assert(t instanceof m,"Not a Body!",t),this.m_bodies.push(t)},f.prototype.addContact=function(t){o&&r.assert(t instanceof c,"Not a Contact!",t),this.m_contacts.push(t)},f.prototype.addJoint=function(t){o&&r.assert(t instanceof l,"Not a Joint!",t),this.m_joints.push(t)},f.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var s=e.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var n=e.m_jointList;n;n=n.m_next)n.m_islandFlag=!1;for(var a=this.m_stack,h=e.m_bodyList;h;h=h.m_next)if(!h.m_islandFlag&&0!=h.isAwake()&&0!=h.isActive()&&!h.isStatic()){for(this.clear(),a.push(h),h.m_islandFlag=!0;a.length>0;)if(i=a.pop(),o&&r.assert(1==i.isActive()),this.addBody(i),i.setAwake(!0),!i.isStatic()){for(var m=i.m_contactList;m;m=m.next){var c=m.contact;if(!c.m_islandFlag&&0!=c.isEnabled()&&0!=c.isTouching()){var l=c.m_fixtureA.m_isSensor,_=c.m_fixtureB.m_isSensor;l||_||(this.addContact(c),c.m_islandFlag=!0,(p=m.other).m_islandFlag||(a.push(p),p.m_islandFlag=!0))}}for(var u=i.m_jointList;u;u=u.next){var p;1!=u.joint.m_islandFlag&&0!=(p=u.other).isActive()&&(this.addJoint(u.joint),u.joint.m_islandFlag=!0,p.m_islandFlag||(a.push(p),p.m_islandFlag=!0))}}this.solveIsland(t);for(var d=0;d<this.m_bodies.length;++d)(i=this.m_bodies[d]).isStatic()&&(i.m_islandFlag=!1)}},f.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,o=e.m_allowSleep,r=t.dt,m=0;m<this.m_bodies.length;++m){var c=this.m_bodies[m],l=a.clone(c.m_sweep.c),_=c.m_sweep.a,u=a.clone(c.m_linearVelocity),p=c.m_angularVelocity;c.m_sweep.c0.set(c.m_sweep.c),c.m_sweep.a0=c.m_sweep.a,c.isDynamic()&&(u.addMul(r*c.m_gravityScale,i),u.addMul(r*c.m_invMass,c.m_force),p+=r*c.m_invI*c.m_torque,u.mul(1/(1+r*c.m_linearDamping)),p*=1/(1+r*c.m_angularDamping)),c.c_position.c=l,c.c_position.a=_,c.c_velocity.v=u,c.c_velocity.w=p}for(m=0;m<this.m_contacts.length;++m)this.m_contacts[m].initConstraint(t);for(s&&this.printBodies("M: "),m=0;m<this.m_contacts.length;++m)this.m_contacts[m].initVelocityConstraint(t);if(s&&this.printBodies("R: "),t.warmStarting)for(m=0;m<this.m_contacts.length;++m)this.m_contacts[m].warmStartConstraint(t);for(s&&this.printBodies("Q: "),m=0;m<this.m_joints.length;++m)this.m_joints[m].initVelocityConstraints(t);for(s&&this.printBodies("E: "),m=0;m<t.velocityIterations;++m){for(var d=0;d<this.m_joints.length;++d)this.m_joints[d].solveVelocityConstraints(t);for(d=0;d<this.m_contacts.length;++d)this.m_contacts[d].solveVelocityConstraint(t)}for(s&&this.printBodies("D: "),m=0;m<this.m_contacts.length;++m)this.m_contacts[m].storeConstraintImpulses(t);for(s&&this.printBodies("C: "),m=0;m<this.m_bodies.length;++m){c=this.m_bodies[m],l=a.clone(c.c_position.c),_=c.c_position.a,u=a.clone(c.c_velocity.v),p=c.c_velocity.w;var y=a.mul(r,u);if(a.lengthSquared(y)>n.maxTranslationSquared){var f=n.maxTranslation/y.length();u.mul(f)}var v=r*p;v*v>n.maxRotationSquared&&(p*=f=n.maxRotation/h.abs(v)),l.addMul(r,u),_+=r*p,c.c_position.c.set(l),c.c_position.a=_,c.c_velocity.v.set(u),c.c_velocity.w=p}s&&this.printBodies("B: ");var g=!1;for(m=0;m<t.positionIterations;++m){var x=0;for(d=0;d<this.m_contacts.length;++d){var A=this.m_contacts[d].solvePositionConstraint(t);x=h.min(x,A)}var b=x>=-3*n.linearSlop,B=!0;for(d=0;d<this.m_joints.length;++d){var w=this.m_joints[d].solvePositionConstraints(t);B=B&&w}if(b&&B){g=!0;break}}for(s&&this.printBodies("L: "),m=0;m<this.m_bodies.length;++m)(c=this.m_bodies[m]).m_sweep.c.set(c.c_position.c),c.m_sweep.a=c.c_position.a,c.m_linearVelocity.set(c.c_velocity.v),c.m_angularVelocity=c.c_velocity.w,c.synchronizeTransform();if(this.postSolveIsland(),o){var S=1/0,M=n.linearSleepToleranceSqr,C=n.angularSleepToleranceSqr;for(m=0;m<this.m_bodies.length;++m)(c=this.m_bodies[m]).isStatic()||(0==c.m_autoSleepFlag||c.m_angularVelocity*c.m_angularVelocity>C||a.lengthSquared(c.m_linearVelocity)>M?(c.m_sleepTime=0,S=0):(c.m_sleepTime+=r,S=h.min(S,c.m_sleepTime)));if(S>=n.timeToSleep&&g)for(m=0;m<this.m_bodies.length;++m)(c=this.m_bodies[m]).setAwake(!1)}},f.prototype.printBodies=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[e];r.debug(t,i.c_position.a,i.c_position.c.x,i.c_position.c.y,i.c_velocity.w,i.c_velocity.v.x,i.c_velocity.v.y)}};var v=new y;function g(){this.normalImpulses=[],this.tangentImpulses=[]}f.prototype.solveWorldTOI=function(t){var e=this.m_world;if(e.m_stepComplete){for(var i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1,i.m_sweep.alpha0=0;for(var a=e.m_contactList;a;a=a.m_next)a.m_toiFlag=!1,a.m_islandFlag=!1,a.m_toiCount=0,a.m_toi=1}for(;;){var m=null,c=1;for(a=e.m_contactList;a;a=a.m_next)if(0!=a.isEnabled()&&!(a.m_toiCount>n.maxSubSteps)){var l=1;if(a.m_toiFlag)l=a.m_toi;else{var d=a.getFixtureA(),y=a.getFixtureB();if(d.isSensor()||y.isSensor())continue;var f=d.getBody(),g=y.getBody();o&&r.assert(f.isDynamic()||g.isDynamic());var x=f.isAwake()&&!f.isStatic(),A=g.isAwake()&&!g.isStatic();if(0==x&&0==A)continue;var b=f.isBullet()||!f.isDynamic(),B=g.isBullet()||!g.isDynamic();if(0==b&&0==B)continue;var w=f.m_sweep.alpha0;f.m_sweep.alpha0<g.m_sweep.alpha0?(w=g.m_sweep.alpha0,f.m_sweep.advance(w)):g.m_sweep.alpha0<f.m_sweep.alpha0&&(w=f.m_sweep.alpha0,g.m_sweep.advance(w)),o&&r.assert(w<1);var S=a.getChildIndexA(),M=a.getChildIndexB(),C=(f.m_sweep,g.m_sweep,new u);C.proxyA.set(d.getShape(),S),C.proxyB.set(y.getShape(),M),C.sweepA.set(f.m_sweep),C.sweepB.set(g.m_sweep),C.tMax=1;var I=new p;_(I,C);var T=I.t;l=I.state==p.e_touching?h.min(w+(1-w)*T,1):1,a.m_toi=l,a.m_toiFlag=!0}l<c&&(m=a,c=l)}if(null==m||1-10*h.EPSILON<c){e.m_stepComplete=!0;break}d=m.getFixtureA(),y=m.getFixtureB(),f=d.getBody(),g=y.getBody();var P=f.m_sweep.clone(),E=g.m_sweep.clone();if(f.advance(c),g.advance(c),m.update(e),m.m_toiFlag=!1,++m.m_toiCount,0!=m.isEnabled()&&0!=m.isTouching()){f.setAwake(!0),g.setAwake(!0),this.clear(),this.addBody(f),this.addBody(g),this.addContact(m),f.m_islandFlag=!0,g.m_islandFlag=!0,m.m_islandFlag=!0;for(var z=[f,g],V=0;V<z.length;++V)if((j=z[V]).isDynamic())for(var L=j.m_contactList;L;L=L.next){var F=L.contact;if(!F.m_islandFlag){var D=L.other;if(!D.isDynamic()||j.isBullet()||D.isBullet()){var k=F.m_fixtureA.m_isSensor,R=F.m_fixtureB.m_isSensor;if(!k&&!R){var q=D.m_sweep.clone();0==D.m_islandFlag&&D.advance(c),F.update(e),0!=F.isEnabled()&&0!=F.isTouching()?(F.m_islandFlag=!0,this.addContact(F),D.m_islandFlag||(D.m_islandFlag=!0,D.isStatic()||D.setAwake(!0),this.addBody(D))):(D.m_sweep.set(q),D.synchronizeTransform())}}}}for(v.reset((1-c)*t.dt),v.dtRatio=1,v.positionIterations=20,v.velocityIterations=t.velocityIterations,v.warmStarting=!1,this.solveIslandTOI(v,f,g),V=0;V<this.m_bodies.length;++V){var j;if((j=this.m_bodies[V]).m_islandFlag=!1,j.isDynamic())for(j.synchronizeFixtures(),L=j.m_contactList;L;L=L.next)L.contact.m_toiFlag=!1,L.contact.m_islandFlag=!1}if(e.findNewContacts(),e.m_subStepping){e.m_stepComplete=!1;break}}else m.setEnabled(!1),f.m_sweep.set(P),g.m_sweep.set(E),f.synchronizeTransform(),g.synchronizeTransform()}if(s)for(i=e.m_bodyList;i;i=i.m_next)a=i.m_sweep.c,i.m_sweep.a,i.m_linearVelocity,i.m_angularVelocity},f.prototype.solveIslandTOI=function(t,e,i){this.m_world;for(var s=0;s<this.m_bodies.length;++s)(l=this.m_bodies[s]).c_position.c.set(l.m_sweep.c),l.c_position.a=l.m_sweep.a,l.c_velocity.v.set(l.m_linearVelocity),l.c_velocity.w=l.m_angularVelocity;for(s=0;s<this.m_contacts.length;++s)this.m_contacts[s].initConstraint(t);for(s=0;s<t.positionIterations;++s){for(var o=0,r=0;r<this.m_contacts.length;++r){var m=this.m_contacts[r].solvePositionConstraintTOI(t,e,i);o=h.min(o,m)}if(o>=-1.5*n.linearSlop)break}for(e.m_sweep.c0.set(e.c_position.c),e.m_sweep.a0=e.c_position.a,i.m_sweep.c0.set(i.c_position.c),i.m_sweep.a0=i.c_position.a,s=0;s<this.m_contacts.length;++s)this.m_contacts[s].initVelocityConstraint(t);for(s=0;s<t.velocityIterations;++s)for(r=0;r<this.m_contacts.length;++r)this.m_contacts[r].solveVelocityConstraint(t);var c=t.dt;for(s=0;s<this.m_bodies.length;++s){var l=this.m_bodies[s],_=a.clone(l.c_position.c),u=l.c_position.a,p=a.clone(l.c_velocity.v),d=l.c_velocity.w,y=a.mul(c,p);if(a.dot(y,y)>n.maxTranslationSquared){var f=n.maxTranslation/y.length();p.mul(f)}var v=c*d;v*v>n.maxRotationSquared&&(d*=f=n.maxRotation/h.abs(v)),_.addMul(c,p),u+=c*d,l.c_position.c=_,l.c_position.a=u,l.c_velocity.v=p,l.c_velocity.w=d,l.m_sweep.c=_,l.m_sweep.a=u,l.m_linearVelocity=p,l.m_angularVelocity=d,l.synchronizeTransform()}this.postSolveIsland()},f.prototype.postSolveIsland=function(){for(var t=new g,e=0;e<this.m_contacts.length;++e){for(var i=this.m_contacts[e],s=0;s<i.v_points.length;++s)t.normalImpulses.push(i.v_points[s].normalImpulse),t.tangentImpulses.push(i.v_points[s].tangentImpulse);this.m_world.postSolve(i,t)}}},7980:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2088),n=(i(3216),i(1428)),r=i(4474),a=(i(7191),i(2409),i(3960)),h=i(6130),m=i(2219);function c(t,e,i,s,o){t.pointCount=0;var a=n.mulVec2(i,e.m_p),m=n.mulVec2(o,s.m_p),c=r.distanceSquared(m,a),l=e.m_radius+s.m_radius;c>l*l||(t.type=h.e_circles,t.localPoint.set(e.m_p),t.localNormal.setZero(),t.pointCount=1,t.points[0].localPoint.set(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex)}a.addType(m.TYPE,m.TYPE,function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==m.TYPE),s&&o.assert(a.getType()==m.TYPE),c(t,i.getShape(),e,a.getShape(),r)}),e.CollideCircles=c},8025:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=function(t,e){var i=r.now();++a.toiCalls,t.state=v.e_unknown,t.t=e.tMax;var m=e.proxyA,c=e.proxyB,l=e.sweepA,y=e.sweepB;l.normalize(),y.normalize();var x=e.tMax,A=m.m_radius+c.m_radius,b=h.max(o.linearSlop,A-3*o.linearSlop),B=.25*o.linearSlop;s&&n.assert(b>B);var w=0,S=o.maxTOIIterations,M=0,C=new f,I=new p;for(I.proxyA=e.proxyA,I.proxyB=e.proxyB,I.useRadii=!1;;){var T=_.identity(),P=_.identity();l.getTransform(T,w),y.getTransform(P,w),I.transformA=T,I.transformB=P;var E=new d;if(u(E,C,I),E.distance<=0){t.state=v.e_overlapped,t.t=0;break}if(E.distance<b+B){t.state=v.e_touching,t.t=w;break}var z=new g;z.initialize(C,m,l,c,y,w);for(var V=!1,L=x,F=0;;){var D=z.findMinSeparation(L);if(z.indexA,z.indexB,D>b+B){t.state=v.e_separated,t.t=x,V=!0;break}if(D>b-B){w=L;break}var k=z.evaluate(w);if(z.indexA,z.indexB,k<b-B){t.state=v.e_failed,t.t=w,V=!0;break}if(k<=b+B){t.state=v.e_touching,t.t=w,V=!0;break}for(var R=0,q=w,j=L;;){var G;G=1&R?q+(b-k)*(j-q)/(D-k):.5*(q+j),++R,++a.toiRootIters;var O=z.evaluate(G);if(z.indexA,z.indexB,h.abs(O-b)<B){L=G;break}if(O>b?(q=G,k=O):(j=G,D=O),50==R)break}if(a.toiMaxRootIters=h.max(a.toiMaxRootIters,R),++F==o.maxPolygonVertices)break}if(++M,++a.toiIters,V)break;if(M==S){t.state=v.e_failed,t.t=w;break}}a.toiMaxIters=h.max(a.toiMaxIters,M);var U=r.diff(i);a.toiMaxTime=h.max(a.toiMaxTime,U),a.toiTime+=U},t.exports.Input=function(){this.proxyA=new y,this.proxyB=new y,this.sweepA=new l,this.sweepB=new l,this.tMax},t.exports.Output=v;var o=i(7191),n=i(2088),r=i(6984),a=i(8759),h=i(3216),m=i(4474),c=(i(905),i(5154),i(4052),i(2669)),l=i(4124),_=i(1428),u=(i(9753),i(4529),i(9352)),p=u.Input,d=u.Output,y=u.Proxy,f=u.Cache;function v(){this.state,this.t}function g(){this.m_proxyA=new y,this.m_proxyB=new y,this.m_sweepA,this.m_sweepB,this.indexA,this.indexB,this.m_type,this.m_localPoint=m.zero(),this.m_axis=m.zero()}v.e_unknown=0,v.e_failed=1,v.e_overlapped=2,v.e_touching=3,v.e_separated=4,a.toiTime=0,a.toiMaxTime=0,a.toiCalls=0,a.toiIters=0,a.toiMaxIters=0,a.toiRootIters=0,a.toiMaxRootIters=0,g.prototype.initialize=function(t,e,i,o,r,a){this.m_proxyA=e,this.m_proxyB=o;var h=t.count;s&&n.assert(0<h&&h<3),this.m_sweepA=i,this.m_sweepB=r;var l=_.identity(),u=_.identity();if(this.m_sweepA.getTransform(l,a),this.m_sweepB.getTransform(u,a),1==h){this.m_type=1;var p=this.m_proxyA.getVertex(t.indexA[0]),d=this.m_proxyB.getVertex(t.indexB[0]),y=_.mulVec2(l,p),f=_.mulVec2(u,d);return this.m_axis.setCombine(1,f,-1,y),this.m_axis.normalize()}if(t.indexA[0]==t.indexA[1]){this.m_type=3;var v=o.getVertex(t.indexB[0]),g=o.getVertex(t.indexB[1]);this.m_axis=m.cross(m.sub(g,v),1),this.m_axis.normalize();var x=c.mulVec2(u.q,this.m_axis);return this.m_localPoint=m.mid(v,g),f=_.mulVec2(u,this.m_localPoint),p=e.getVertex(t.indexA[0]),y=_.mulVec2(l,p),(A=m.dot(y,x)-m.dot(f,x))<0&&(this.m_axis=m.neg(this.m_axis),A=-A),A}this.m_type=2;var A,b=this.m_proxyA.getVertex(t.indexA[0]),B=this.m_proxyA.getVertex(t.indexA[1]);return this.m_axis=m.cross(m.sub(B,b),1),this.m_axis.normalize(),x=c.mulVec2(l.q,this.m_axis),this.m_localPoint=m.mid(b,B),y=_.mulVec2(l,this.m_localPoint),d=this.m_proxyB.getVertex(t.indexB[0]),f=_.mulVec2(u,d),(A=m.dot(f,x)-m.dot(y,x))<0&&(this.m_axis=m.neg(this.m_axis),A=-A),A},g.prototype.compute=function(t,e){var i=_.identity(),o=_.identity();switch(this.m_sweepA.getTransform(i,e),this.m_sweepB.getTransform(o,e),this.m_type){case 1:if(t){var r=c.mulTVec2(i.q,this.m_axis),a=c.mulTVec2(o.q,m.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(r),this.indexB=this.m_proxyB.getSupport(a)}var h=this.m_proxyA.getVertex(this.indexA),l=this.m_proxyB.getVertex(this.indexB),u=_.mulVec2(i,h),p=_.mulVec2(o,l);return m.dot(p,this.m_axis)-m.dot(u,this.m_axis);case 2:var d=c.mulVec2(i.q,this.m_axis);return u=_.mulVec2(i,this.m_localPoint),t&&(a=c.mulTVec2(o.q,m.neg(d)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(a)),l=this.m_proxyB.getVertex(this.indexB),p=_.mulVec2(o,l),m.dot(p,d)-m.dot(u,d);case 3:return d=c.mulVec2(o.q,this.m_axis),p=_.mulVec2(o,this.m_localPoint),t&&(r=c.mulTVec2(i.q,m.neg(d)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(r)),h=this.m_proxyA.getVertex(this.indexA),u=_.mulVec2(i,h),m.dot(u,d)-m.dot(p,d);default:return s&&n.assert(!1),t&&(this.indexA=-1,this.indexB=-1),0}},g.prototype.findMinSeparation=function(t){return this.compute(!0,t)},g.prototype.evaluate=function(t){return this.compute(!1,t)}},8759:function(t,e){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,e.toString=function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}},8836:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(2088),n=(i(3216),i(1428)),r=i(2669),a=i(4474),h=(i(7221),i(7191)),m=i(6130),c=i(3960),l=(i(2409),i(2355));function _(t,e,i,s){for(var o=t.m_count,h=i.m_count,m=t.m_normals,c=t.m_vertices,l=i.m_vertices,u=n.mulTXf(s,e),p=0,d=-1/0,y=0;y<o;++y){for(var f=r.mulVec2(u.q,m[y]),v=n.mulVec2(u,c[y]),g=1/0,x=0;x<h;++x){var A=a.dot(f,l[x])-a.dot(f,v);A<g&&(g=A)}g>d&&(d=g,p=y)}_._maxSeparation=d,_._bestIndex=p}function u(t,e,i,c,l){t.pointCount=0;var u=e.m_radius+c.m_radius;_(e,i,c,l);var p=_._bestIndex,d=_._maxSeparation;if(!(d>u)){_(c,l,e,i);var y=_._bestIndex,f=_._maxSeparation;if(!(f>u)){var v,g,x,A,b,B;f>d+.1*h.linearSlop?(v=c,g=e,x=l,A=i,b=y,t.type=m.e_faceB,B=1):(v=e,g=c,x=i,A=l,b=p,t.type=m.e_faceA,B=0);var w=[new m.clipVertex,new m.clipVertex];!function(t,e,i,h,c,l){var _=e.m_normals,u=c.m_count,p=c.m_vertices,d=c.m_normals;s&&o.assert(0<=h&&h<e.m_count);for(var y=r.mulT(l.q,r.mulVec2(i.q,_[h])),f=0,v=1/0,g=0;g<u;++g){var x=a.dot(y,d[g]);x<v&&(v=x,f=g)}var A=f,b=A+1<u?A+1:0;t[0].v=n.mulVec2(l,p[A]),t[0].id.cf.indexA=h,t[0].id.cf.indexB=A,t[0].id.cf.typeA=m.e_face,t[0].id.cf.typeB=m.e_vertex,t[1].v=n.mulVec2(l,p[b]),t[1].id.cf.indexA=h,t[1].id.cf.indexB=b,t[1].id.cf.typeA=m.e_face,t[1].id.cf.typeB=m.e_vertex}(w,v,x,b,g,A);var S=v.m_count,M=v.m_vertices,C=b,I=b+1<S?b+1:0,T=M[C],P=M[I],E=a.sub(P,T);E.normalize();var z=a.cross(E,1),V=a.combine(.5,T,.5,P),L=r.mulVec2(x.q,E),F=a.cross(L,1);T=n.mulVec2(x,T),P=n.mulVec2(x,P);var D=a.dot(F,T),k=-a.dot(L,T)+u,R=a.dot(L,P)+u,q=[new m.clipVertex,new m.clipVertex],j=[new m.clipVertex,new m.clipVertex];if(!(m.clipSegmentToLine(q,w,a.neg(L),k,C)<2||m.clipSegmentToLine(j,q,L,R,I)<2)){t.localNormal=z,t.localPoint=V;for(var G=0,O=0;O<j.length;++O)if(a.dot(F,j[O].v)-D<=u){var U=t.points[G];if(U.localPoint.set(n.mulTVec2(A,j[O].v)),U.id=j[O].id,B){var N=U.id.cf,Y=N.indexA,J=N.indexB,H=N.typeA,W=N.typeB;N.indexA=J,N.indexB=Y,N.typeA=W,N.typeB=H}++G}t.pointCount=G}}}}t.exports=u,c.addType(l.TYPE,l.TYPE,function(t,e,i,n,r,a,h){s&&o.assert(i.getType()==l.TYPE),s&&o.assert(a.getType()==l.TYPE),u(t,i.getShape(),e,a.getShape(),r)})},8878:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=v;var o=i(2088),n=i(4299),r=i(4474),a=i(2669),h=i(3216),m=i(4124),c=i(1428),l=i(9753),_=i(4529),u=i(9381),p=(i(2409),v.STATIC="static"),d=v.KINEMATIC="kinematic",y=v.DYNAMIC="dynamic",f={type:p,position:r.zero(),angle:0,linearVelocity:r.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};function v(t,e){e=n(e,f),s&&o.assert(r.isValid(e.position)),s&&o.assert(r.isValid(e.linearVelocity)),s&&o.assert(h.isFinite(e.angle)),s&&o.assert(h.isFinite(e.angularVelocity)),s&&o.assert(h.isFinite(e.angularDamping)&&e.angularDamping>=0),s&&o.assert(h.isFinite(e.linearDamping)&&e.linearDamping>=0),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==y?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=c.identity(),this.m_xf.p=r.clone(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new m,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new l,this.c_position=new _,this.m_force=r.zero(),this.m_torque=0,this.m_linearVelocity=r.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}function g(){this.mass=0,this.center=r.zero(),this.I=0}v.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},v._deserialize=function(t,e,i){var s=new v(e,t);if(t.fixtures)for(var o=t.fixtures.length-1;o>=0;o--){var n=i(u,t.fixtures[o],s);s._addFixture(n)}return s},v.prototype.isWorldLocked=function(){return!(!this.m_world||!this.m_world.isLocked())},v.prototype.getWorld=function(){return this.m_world},v.prototype.getNext=function(){return this.m_next},v.prototype.setUserData=function(t){this.m_userData=t},v.prototype.getUserData=function(){return this.m_userData},v.prototype.getFixtureList=function(){return this.m_fixtureList},v.prototype.getJointList=function(){return this.m_jointList},v.prototype.getContactList=function(){return this.m_contactList},v.prototype.isStatic=function(){return this.m_type==p},v.prototype.isDynamic=function(){return this.m_type==y},v.prototype.isKinematic=function(){return this.m_type==d},v.prototype.setStatic=function(){return this.setType(p),this},v.prototype.setDynamic=function(){return this.setType(y),this},v.prototype.setKinematic=function(){return this.setType(d),this},v.prototype.getType=function(){return this.m_type},v.prototype.setType=function(t){if(s&&o.assert(t===p||t===d||t===y),s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==p&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var n=this.m_world.m_broadPhase,r=this.m_fixtureList;r;r=r.m_next)for(var a=r.m_proxyCount,h=0;h<a;++h)n.touchProxy(r.m_proxies[h].proxyId)}},v.prototype.isBullet=function(){return this.m_bulletFlag},v.prototype.setBullet=function(t){this.m_bulletFlag=!!t},v.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},v.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)},v.prototype.isAwake=function(){return this.m_awakeFlag},v.prototype.setAwake=function(t){t?0==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},v.prototype.isActive=function(){return this.m_activeFlag},v.prototype.setActive=function(t){if(s&&o.assert(0==this.isWorldLocked()),t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag)for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);else{for(e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var n=this.m_contactList;n;){var r=n;n=n.next,this.m_world.destroyContact(r.contact)}this.m_contactList=null}},v.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},v.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},v.prototype.getTransform=function(){return this.m_xf},v.prototype.setTransform=function(t,e){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){this.m_xf.set(t,e),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.synchronize(i,this.m_xf,this.m_xf)}},v.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},v.prototype.synchronizeFixtures=function(){var t=c.identity();this.m_sweep.getTransform(t,0);for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.synchronize(e,t,this.m_xf)},v.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.set(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},v.prototype.getPosition=function(){return this.m_xf.p},v.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},v.prototype.getAngle=function(){return this.m_sweep.a},v.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},v.prototype.getWorldCenter=function(){return this.m_sweep.c},v.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},v.prototype.getLinearVelocity=function(){return this.m_linearVelocity},v.prototype.getLinearVelocityFromWorldPoint=function(t){var e=r.sub(t,this.m_sweep.c);return r.add(this.m_linearVelocity,r.cross(this.m_angularVelocity,e))},v.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},v.prototype.setLinearVelocity=function(t){this.m_type!=p&&(r.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.set(t))},v.prototype.getAngularVelocity=function(){return this.m_angularVelocity},v.prototype.setAngularVelocity=function(t){this.m_type!=p&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},v.prototype.getLinearDamping=function(){return this.m_linearDamping},v.prototype.setLinearDamping=function(t){this.m_linearDamping=t},v.prototype.getAngularDamping=function(){return this.m_angularDamping},v.prototype.setAngularDamping=function(t){this.m_angularDamping=t},v.prototype.getGravityScale=function(){return this.m_gravityScale},v.prototype.setGravityScale=function(t){this.m_gravityScale=t},v.prototype.getMass=function(){return this.m_mass},v.prototype.getInertia=function(){return this.m_I+this.m_mass*r.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},v.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.set(this.m_sweep.localCenter)},v.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic())return this.m_sweep.c0.set(this.m_xf.p),this.m_sweep.c.set(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);s&&o.assert(this.isDynamic());for(var t=r.zero(),e=this.m_fixtureList;e;e=e.m_next)if(0!=e.m_density){var i=new g;e.getMassData(i),this.m_mass+=i.mass,t.addMul(i.mass,i.center),this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*r.dot(t,t),s&&o.assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var n=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(r.cross(this.m_angularVelocity,r.sub(this.m_sweep.c,n)))},v.prototype.setMassData=function(t){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()&&this.m_type==y){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*r.dot(t.center,t.center),s&&o.assert(this.m_I>0),this.m_invI=1/this.m_I);var e=r.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(r.cross(this.m_angularVelocity,r.sub(this.m_sweep.c,e)))}},v.prototype.applyForce=function(t,e,i){this.m_type==y&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=r.cross(r.sub(e,this.m_sweep.c),t)))},v.prototype.applyForceToCenter=function(t,e){this.m_type==y&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},v.prototype.applyTorque=function(t,e){this.m_type==y&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},v.prototype.applyLinearImpulse=function(t,e,i){this.m_type==y&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*r.cross(r.sub(e,this.m_sweep.c),t)))},v.prototype.applyAngularImpulse=function(t,e){this.m_type==y&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},v.prototype.shouldCollide=function(t){if(this.m_type!=y&&t.m_type!=y)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0},v.prototype._addFixture=function(t){if(s&&o.assert(0==this.isWorldLocked()),1==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},v.prototype.createFixture=function(t,e){if(s&&o.assert(0==this.isWorldLocked()),1==this.isWorldLocked())return null;var i=new u(this,t,e);return this._addFixture(i),i},v.prototype.destroyFixture=function(t){if(s&&o.assert(0==this.isWorldLocked()),1!=this.isWorldLocked()){s&&o.assert(t.m_body==this);var e=!1;if(this.m_fixtureList===t)this.m_fixtureList=t.m_next,e=!0;else for(var i=this.m_fixtureList;null!=i;){if(i.m_next===t){i.m_next=t.m_next,e=!0;break}i=i.m_next}s&&o.assert(e);for(var n=this.m_contactList;n;){var r=n.contact;n=n.next;var a=r.getFixtureA(),h=r.getFixtureB();t!=a&&t!=h||this.m_world.destroyContact(r)}if(this.m_activeFlag){var m=this.m_world.m_broadPhase;t.destroyProxies(m)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},v.prototype.getWorldPoint=function(t){return c.mulVec2(this.m_xf,t)},v.prototype.getWorldVector=function(t){return a.mulVec2(this.m_xf.q,t)},v.prototype.getLocalPoint=function(t){return c.mulTVec2(this.m_xf,t)},v.prototype.getLocalVector=function(t){return a.mulTVec2(this.m_xf.q,t)}},9218:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT,o=i(7191),n=i(2088),r=i(919),a=i(4474),h=i(3216),m=i(7221);function c(t){this.id=t,this.aabb=new m,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.toString=function(){return this.id+": "+this.userData}}function l(){this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new r({create:function(){return new c}})}t.exports=l,c.prototype.isLeaf=function(){return null==this.child1},l.prototype.getUserData=function(t){var e=this.m_nodes[t];return s&&n.assert(!!e),e.userData},l.prototype.getFatAABB=function(t){var e=this.m_nodes[t];return s&&n.assert(!!e),e.aabb},l.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t,t},l.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},l.prototype.createProxy=function(t,e){s&&n.assert(m.isValid(t));var i=this.allocateNode();return i.aabb.set(t),m.extend(i.aabb,o.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},l.prototype.destroyProxy=function(t){var e=this.m_nodes[t];s&&n.assert(!!e),s&&n.assert(e.isLeaf()),this.removeLeaf(e),this.freeNode(e)},l.prototype.moveProxy=function(t,e,i){s&&n.assert(m.isValid(e)),s&&n.assert(!i||a.isValid(i));var r=this.m_nodes[t];return s&&n.assert(!!r),s&&n.assert(r.isLeaf()),!r.aabb.contains(e)&&(this.removeLeaf(r),r.aabb.set(e),e=r.aabb,m.extend(e,o.aabbExtension),i.x<0?e.lowerBound.x+=i.x*o.aabbMultiplier:e.upperBound.x+=i.x*o.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*o.aabbMultiplier:e.upperBound.y+=i.y*o.aabbMultiplier,this.insertLeaf(r),!0)},l.prototype.insertLeaf=function(t){if(s&&n.assert(m.isValid(t.aabb)),null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);for(var e=t.aabb,i=this.m_root;0==i.isLeaf();){var o=i.child1,r=i.child2,a=i.aabb.getPerimeter(),c=new m;c.combine(i.aabb,e);var l,_,u,p=c.getPerimeter(),d=2*p,y=2*(p-a);if(o.isLeaf())(u=new m).combine(e,o.aabb),l=u.getPerimeter()+y;else{(u=new m).combine(e,o.aabb);var f=o.aabb.getPerimeter();l=u.getPerimeter()-f+y}if(r.isLeaf())(u=new m).combine(e,r.aabb),_=u.getPerimeter()+y;else(u=new m).combine(e,r.aabb),f=r.aabb.getPerimeter(),_=u.getPerimeter()-f+y;if(d<l&&d<_)break;i=l<_?o:r}var v=i,g=v.parent,x=this.allocateNode();for(x.parent=g,x.userData=null,x.aabb.combine(e,v.aabb),x.height=v.height+1,null!=g?(g.child1==v?g.child1=x:g.child2=x,x.child1=v,x.child2=t,v.parent=x,t.parent=x):(x.child1=v,x.child2=t,v.parent=x,t.parent=x,this.m_root=x),i=t.parent;null!=i;)o=(i=this.balance(i)).child1,r=i.child2,s&&n.assert(null!=o),s&&n.assert(null!=r),i.height=1+h.max(o.height,r.height),i.aabb.combine(o.aabb,r.aabb),i=i.parent},l.prototype.removeLeaf=function(t){if(t!=this.m_root){var e,i=t.parent,s=i.parent;if(e=i.child1==t?i.child2:i.child1,null!=s){s.child1==i?s.child1=e:s.child2=e,e.parent=s,this.freeNode(i);for(var o=s;null!=o;){var n=(o=this.balance(o)).child1,r=o.child2;o.aabb.combine(n.aabb,r.aabb),o.height=1+h.max(n.height,r.height),o=o.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)}else this.m_root=null},l.prototype.balance=function(t){s&&n.assert(null!=t);var e=t;if(e.isLeaf()||e.height<2)return t;var i=e.child1,o=e.child2,r=o.height-i.height;if(r>1){var a=o.child1,m=o.child2;return o.child1=e,o.parent=e.parent,e.parent=o,null!=o.parent?o.parent.child1==t?o.parent.child1=o:o.parent.child2=o:this.m_root=o,a.height>m.height?(o.child2=a,e.child2=m,m.parent=e,e.aabb.combine(i.aabb,m.aabb),o.aabb.combine(e.aabb,a.aabb),e.height=1+h.max(i.height,m.height),o.height=1+h.max(e.height,a.height)):(o.child2=m,e.child2=a,a.parent=e,e.aabb.combine(i.aabb,a.aabb),o.aabb.combine(e.aabb,m.aabb),e.height=1+h.max(i.height,a.height),o.height=1+h.max(e.height,m.height)),o}if(r<-1){var c=i.child1,l=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1==e?i.parent.child1=i:i.parent.child2=i:this.m_root=i,c.height>l.height?(i.child2=c,e.child1=l,l.parent=e,e.aabb.combine(o.aabb,l.aabb),i.aabb.combine(e.aabb,c.aabb),e.height=1+h.max(o.height,l.height),i.height=1+h.max(e.height,c.height)):(i.child2=l,e.child1=c,c.parent=e,e.aabb.combine(o.aabb,c.aabb),i.aabb.combine(e.aabb,l.aabb),e.height=1+h.max(o.height,c.height),i.height=1+h.max(e.height,l.height)),i}return e},l.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},l.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,s=p.allocate().preorder(this.m_root);t=s.next();)t.height<0||(i+=t.aabb.getPerimeter());return p.release(s),i/e},l.prototype.computeHeight=function(t){var e;if((e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var i=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+h.max(i,s)},l.prototype.validateStructure=function(t){if(null!=t){t==this.m_root&&s&&n.assert(null==t.parent);var e=t.child1,i=t.child2;if(t.isLeaf())return s&&n.assert(null==e),s&&n.assert(null==i),void(s&&n.assert(0==t.height));s&&n.assert(e.parent==t),s&&n.assert(i.parent==t),this.validateStructure(e),this.validateStructure(i)}},l.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;if(t.isLeaf())return s&&n.assert(null==e),s&&n.assert(null==i),void(s&&n.assert(0==t.height));var o=e.height,r=i.height,a=1+h.max(o,r);s&&n.assert(t.height==a);var c=new m;c.combine(e.aabb,i.aabb),s&&n.assert(m.areEqual(c,t.aabb)),this.validateMetrics(e),this.validateMetrics(i)}},l.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root),s&&n.assert(this.getHeight()==this.computeHeight())},l.prototype.getMaxBalance=function(){for(var t,e=0,i=p.allocate().preorder(this.m_root);t=i.next();)if(!(t.height<=1)){s&&n.assert(0==t.isLeaf());var o=h.abs(t.child2.height-t.child1.height);e=h.max(e,o)}return p.release(i),e},l.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,s=p.allocate().preorder(this.m_root);t=s.next();)t.height<0||(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(p.release(s);i>1;){for(var o=1/0,n=-1,r=-1,a=0;a<i;++a)for(var c=e[a].aabb,l=a+1;l<i;++l){var _=e[l].aabb,u=new m;u.combine(c,_);var d=u.getPerimeter();d<o&&(n=a,r=l,o=d)}var y=e[n],f=e[r],v=this.allocateNode();v.child1=y,v.child2=f,v.height=1+h.max(y.height,f.height),v.aabb.combine(y.aabb,f.aabb),v.parent=null,y.parent=v,f.parent=v,e[r]=e[i-1],e[n]=v,--i}this.m_root=e[0],this.validate()},l.prototype.shiftOrigin=function(t){for(var e,i=p.allocate().preorder(this.m_root);e=i.next();){var s=e.aabb;s.lowerBound.x-=t.x,s.lowerBound.y-=t.y,s.upperBound.x-=t.x,s.upperBound.y-=t.y}p.release(i)},l.prototype.query=function(t,e){s&&n.assert("function"==typeof e);var i=u.allocate();for(i.push(this.m_root);i.length>0;){var o=i.pop();if(null!=o&&m.testOverlap(o.aabb,t))if(o.isLeaf()){if(0==e(o.id))return}else i.push(o.child1),i.push(o.child2)}u.release(i)},l.prototype.rayCast=function(t,e){s&&n.assert("function"==typeof e);var i=t.p1,o=t.p2,r=a.sub(o,i);s&&n.assert(r.lengthSquared()>0),r.normalize();var c=a.cross(1,r),l=a.abs(c),p=t.maxFraction,d=new m,y=a.combine(1-p,i,p,o);d.combinePoints(i,y);var f=u.allocate(),v=_.allocate();for(f.push(this.m_root);f.length>0;){var g=f.pop();if(null!=g&&0!=m.testOverlap(g.aabb,d)){var x=g.aabb.getCenter(),A=g.aabb.getExtents();if(!(h.abs(a.dot(c,a.sub(i,x)))-a.dot(l,A)>0))if(g.isLeaf()){v.p1=a.clone(t.p1),v.p2=a.clone(t.p2),v.maxFraction=p;var b=e(v,g.id);if(0==b)return;b>0&&(p=b,y=a.combine(1-p,i,p,o),d.combinePoints(i,y))}else f.push(g.child1),f.push(g.child2)}}u.release(f),_.release(v)};var _=new r({create:function(){return{}},release:function(t){}}),u=new r({create:function(){return[]},release:function(t){t.length=0}}),p=new r({create:function(){return new d},release:function(t){t.close()}});function d(){var t=[],e=[];return{preorder:function(i){return t.length=0,t.push(i),e.length=0,e.push(0),this},next:function(){for(;t.length>0;){var i=t.length-1,s=t[i];if(0===e[i])return e[i]=1,s;if(1===e[i]&&(e[i]=2,s.child1))return t.push(s.child1),e.push(1),s.child1;if(2===e[i]&&(e[i]=3,s.child2))return t.push(s.child2),e.push(1),s.child2;t.pop(),e.pop()}},close:function(){t.length=0}}}},9352:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=p,t.exports.Input=l,t.exports.Output=_,t.exports.Proxy=d,t.exports.Cache=u;var o=i(7191),n=i(2088),r=i(8759),a=i(3216),h=i(4474),m=(i(905),i(5154),i(4052),i(2669)),c=(i(4124),i(1428));function l(){this.proxyA=new d,this.proxyB=new d,this.transformA=null,this.transformB=null,this.useRadii=!1}function _(){this.pointA=h.zero(),this.pointB=h.zero(),this.distance,this.iterations}function u(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}function p(t,e,i){++r.gjkCalls;var s=i.proxyA,n=i.proxyB,l=i.transformA,_=i.transformB,u=new f;u.readCache(e,s,l,n,_);for(var p=u.m_v,d=o.maxDistnceIterations,y=[],v=[],g=0,x=0;x<d;){g=u.m_count;for(var A=0;A<g;++A)y[A]=p[A].indexA,v[A]=p[A].indexB;if(u.solve(),3==u.m_count)break;(I=u.getClosestPoint()).lengthSquared();var b=u.getSearchDirection();if(b.lengthSquared()<a.EPSILON*a.EPSILON)break;var B=p[u.m_count];B.indexA=s.getSupport(m.mulTVec2(l.q,h.neg(b))),B.wA=c.mulVec2(l,s.getVertex(B.indexA)),B.indexB=n.getSupport(m.mulTVec2(_.q,b)),B.wB=c.mulVec2(_,n.getVertex(B.indexB)),B.w=h.sub(B.wB,B.wA),++x,++r.gjkIters;var w=!1;for(A=0;A<g;++A)if(B.indexA==y[A]&&B.indexB==v[A]){w=!0;break}if(w)break;++u.m_count}if(r.gjkMaxIters=a.max(r.gjkMaxIters,x),u.getWitnessPoints(t.pointA,t.pointB),t.distance=h.distance(t.pointA,t.pointB),t.iterations=x,u.writeCache(e),i.useRadii){var S=s.m_radius,M=n.m_radius;if(t.distance>S+M&&t.distance>a.EPSILON){t.distance-=S+M;var C=h.sub(t.pointB,t.pointA);C.normalize(),t.pointA.addMul(S,C),t.pointB.subMul(M,C)}else{var I=h.mid(t.pointA,t.pointB);t.pointA.set(I),t.pointB.set(I),t.distance=0}}}function d(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}function y(){this.indexA,this.indexB,this.wA=h.zero(),this.wB=h.zero(),this.w=h.zero(),this.a}function f(){this.m_v1=new y,this.m_v2=new y,this.m_v3=new y,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}i(9753),i(4529),r.gjkCalls=0,r.gjkIters=0,r.gjkMaxIters=0,d.prototype.getVertexCount=function(){return this.m_count},d.prototype.getVertex=function(t){return s&&n.assert(0<=t&&t<this.m_count),this.m_vertices[t]},d.prototype.getSupport=function(t){for(var e=0,i=h.dot(this.m_vertices[0],t),s=0;s<this.m_count;++s){var o=h.dot(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e},d.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},d.prototype.set=function(t,e){s&&n.assert("function"==typeof t.computeDistanceProxy),t.computeDistanceProxy(this,e)},y.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=h.clone(t.wA),this.wB=h.clone(t.wB),this.w=h.clone(t.w),this.a=t.a},f.prototype.print=function(){return 3==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1==this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},f.prototype.readCache=function(t,e,i,o,r){s&&n.assert(t.count<=3),this.m_count=t.count;for(var m=0;m<this.m_count;++m){(d=this.m_v[m]).indexA=t.indexA[m],d.indexB=t.indexB[m];var l=e.getVertex(d.indexA),_=o.getVertex(d.indexB);d.wA=c.mulVec2(i,l),d.wB=c.mulVec2(r,_),d.w=h.sub(d.wB,d.wA),d.a=0}if(this.m_count>1){var u=t.metric,p=this.getMetric();(p<.5*u||2*u<p||p<a.EPSILON)&&(this.m_count=0)}var d;0==this.m_count&&((d=this.m_v[0]).indexA=0,d.indexB=0,l=e.getVertex(0),_=o.getVertex(0),d.wA=c.mulVec2(i,l),d.wB=c.mulVec2(r,_),d.w=h.sub(d.wB,d.wA),d.a=1,this.m_count=1)},f.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},f.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return h.neg(this.m_v1.w);case 2:var t=h.sub(this.m_v2.w,this.m_v1.w);return h.cross(t,h.neg(this.m_v1.w))>0?h.cross(1,t):h.cross(t,1);default:return s&&n.assert(!1),h.zero()}},f.prototype.getClosestPoint=function(){switch(this.m_count){case 0:default:return s&&n.assert(!1),h.zero();case 1:return h.clone(this.m_v1.w);case 2:return h.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w);case 3:return h.zero()}},f.prototype.getWitnessPoints=function(t,e){switch(this.m_count){case 0:default:s&&n.assert(!1);break;case 1:t.set(this.m_v1.wA),e.set(this.m_v1.wB);break;case 2:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),e.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.addMul(this.m_v3.a,this.m_v3.wA),e.set(t)}},f.prototype.getMetric=function(){switch(this.m_count){case 0:default:return s&&n.assert(!1),0;case 1:return 0;case 2:return h.distance(this.m_v1.w,this.m_v2.w);case 3:return h.cross(h.sub(this.m_v2.w,this.m_v1.w),h.sub(this.m_v3.w,this.m_v1.w))}},f.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3();break;default:s&&n.assert(!1)}},f.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=h.sub(e,t),s=-h.dot(t,i);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);var o=h.dot(e,i);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);var n=1/(o+s);this.m_v1.a=o*n,this.m_v2.a=s*n,this.m_count=2},f.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=h.sub(e,t),o=h.dot(t,s),n=h.dot(e,s),r=-o,a=h.sub(i,t),m=h.dot(t,a),c=h.dot(i,a),l=-m,_=h.sub(i,e),u=h.dot(e,_),p=h.dot(i,_),d=-u,y=h.cross(s,a),f=y*h.cross(e,i),v=y*h.cross(i,t),g=y*h.cross(t,e);if(r<=0&&l<=0)return this.m_v1.a=1,void(this.m_count=1);if(n>0&&r>0&&g<=0){var x=1/(n+r);return this.m_v1.a=n*x,this.m_v2.a=r*x,void(this.m_count=2)}if(c>0&&l>0&&v<=0){var A=1/(c+l);return this.m_v1.a=c*A,this.m_v3.a=l*A,this.m_count=2,void this.m_v2.set(this.m_v3)}if(n<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(c<=0&&p<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(p>0&&d>0&&f<=0){var b=1/(p+d);return this.m_v2.a=p*b,this.m_v3.a=d*b,this.m_count=2,void this.m_v1.set(this.m_v3)}var B=1/(f+v+g);this.m_v1.a=f*B,this.m_v2.a=v*B,this.m_v3.a=g*B,this.m_count=3},p.testOverlap=function(t,e,i,s,o,n){var r=new l;r.proxyA.set(t,e),r.proxyB.set(i,s),r.transformA=o,r.transformB=n,r.useRadii=!0;var h=new u,m=new _;return p(m,h,r),m.distance<10*a.EPSILON}},9381:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG;var s="undefined"!=typeof ASSERT&&ASSERT;t.exports=_;var o=i(2088),n=i(4299),r=i(3216),a=i(4474),h=i(7221),m=i(2409),c={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};function l(t,e){this.aabb=new h,this.fixture=t,this.childIndex=e,this.proxyId}function _(t,e,i){e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=n(i,c),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var s=this.m_shape.getChildCount(),o=0;o<s;++o)this.m_proxies[o]=new l(this,o);this.m_userData=i.userData}_.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),s=0;s<i;++s)this.m_proxies[s]=new l(this,s);this.createProxies(e,t.m_xf),t.resetMassData()},_.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},_._deserialize=function(t,e,i){var s=i(m,t.shape);return s&&new _(e,s,t)},_.prototype.getType=function(){return this.m_shape.getType()},_.prototype.getShape=function(){return this.m_shape},_.prototype.isSensor=function(){return this.m_isSensor},_.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},_.prototype.getUserData=function(){return this.m_userData},_.prototype.setUserData=function(t){this.m_userData=t},_.prototype.getBody=function(){return this.m_body},_.prototype.getNext=function(){return this.m_next},_.prototype.getDensity=function(){return this.m_density},_.prototype.setDensity=function(t){s&&o.assert(r.isFinite(t)&&t>=0),this.m_density=t},_.prototype.getFriction=function(){return this.m_friction},_.prototype.setFriction=function(t){this.m_friction=t},_.prototype.getRestitution=function(){return this.m_restitution},_.prototype.setRestitution=function(t){this.m_restitution=t},_.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},_.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},_.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},_.prototype.getAABB=function(t){return s&&o.assert(0<=t&&t<this.m_proxyCount),this.m_proxies[t].aabb},_.prototype.createProxies=function(t,e){s&&o.assert(0==this.m_proxyCount),this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i];this.m_shape.computeAABB(n.aabb,e,i),n.proxyId=t.createProxy(n.aabb,n)}},_.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},_.prototype.synchronize=function(t,e,i){for(var s=0;s<this.m_proxyCount;++s){var o=this.m_proxies[s],n=new h,r=new h;this.m_shape.computeAABB(n,e,o.childIndex),this.m_shape.computeAABB(r,i,o.childIndex),o.aabb.combine(n,r);var m=a.sub(i.p,e.p);t.moveProxy(o.proxyId,o.aabb,m)}},_.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},_.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},_.prototype.setFilterGroupIndex=function(t){return this.m_filterGroupIndex=t},_.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},_.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t},_.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},_.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t},_.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),s=e.getFixtureB();i!=this&&s!=this||e.flagForFiltering(),t=t.next}var o=this.m_body.getWorld();if(null!=o)for(var n=o.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},_.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=0!==(t.m_filterMaskBits&this.m_filterCategoryBits),i=0!==(t.m_filterCategoryBits&this.m_filterMaskBits);return e&&i}},9486:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=l;var s=i(4299),o=i(7191),n=i(3216),r=i(4474),a=(i(905),i(5154),i(4052),i(2669)),h=(i(4124),i(1428),i(9753),i(4529),i(5868)),m=i(8878);l.TYPE="distance-joint",h.TYPES[l.TYPE]=l,l._super=h,l.prototype=Object.create(l._super.prototype);var c={frequencyHz:0,dampingRatio:0};function l(t,e,i,o,a){if(!(this instanceof l))return new l(t,e,i,o,a);if(i&&o&&"m_type"in o&&"x"in i&&"y"in i){var m=i;i=o,o=m}t=s(t,c),h.call(this,t,e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=l.TYPE,this.m_localAnchorA=r.clone(o?e.getLocalPoint(o):t.localAnchorA||r.zero()),this.m_localAnchorB=r.clone(a?i.getLocalPoint(a):t.localAnchorB||r.zero()),this.m_length=n.isFinite(t.length)?t.length:r.distance(e.getWorldPoint(this.m_localAnchorA),i.getWorldPoint(this.m_localAnchorB)),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0,this.m_u,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass}l.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},l._deserialize=function(t,e,i){return(t=Object.assign({},t)).bodyA=i(m,t.bodyA,e),t.bodyB=i(m,t.bodyB,e),new l(t)},l.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.set(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.set(t.localAnchorA),t.anchorB?this.m_localAnchorB.set(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.set(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=r.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))},l.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},l.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},l.prototype.setLength=function(t){this.m_length=t},l.prototype.getLength=function(){return this.m_length},l.prototype.setFrequency=function(t){this.m_frequencyHz=t},l.prototype.getFrequency=function(){return this.m_frequencyHz},l.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},l.prototype.getDampingRatio=function(){return this.m_dampingRatio},l.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},l.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},l.prototype.getReactionForce=function(t){return r.mul(this.m_impulse,this.m_u).mul(t)},l.prototype.getReactionTorque=function(t){return 0},l.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,h=this.m_bodyA.c_velocity.w,m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,l=this.m_bodyB.c_velocity.v,_=this.m_bodyB.c_velocity.w,u=a.neo(i),p=a.neo(c);this.m_rA=a.mulVec2(u,r.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=a.mulVec2(p,r.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=r.sub(r.add(m,this.m_rB),r.add(e,this.m_rA));var d=this.m_u.length();d>o.linearSlop?this.m_u.mul(1/d):this.m_u.set(0,0);var y=r.cross(this.m_rA,this.m_u),f=r.cross(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*y*y+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!=v?1/v:0,this.m_frequencyHz>0){var g=d-this.m_length,x=2*n.PI*this.m_frequencyHz,A=2*this.m_mass*this.m_dampingRatio*x,b=this.m_mass*x*x,B=t.dt;this.m_gamma=B*(A+B*b),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=g*B*b*this.m_gamma,v+=this.m_gamma,this.m_mass=0!=v?1/v:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var w=r.mul(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,w),h-=this.m_invIA*r.cross(this.m_rA,w),l.addMul(this.m_invMassB,w),_+=this.m_invIB*r.cross(this.m_rB,w)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.set(s),this.m_bodyA.c_velocity.w=h,this.m_bodyB.c_velocity.v.set(l),this.m_bodyB.c_velocity.w=_},l.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=r.add(e,r.cross(i,this.m_rA)),a=r.add(s,r.cross(o,this.m_rB)),h=r.dot(this.m_u,a)-r.dot(this.m_u,n),m=-this.m_mass*(h+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var c=r.mul(m,this.m_u);e.subMul(this.m_invMassA,c),i-=this.m_invIA*r.cross(this.m_rA,c),s.addMul(this.m_invMassB,c),o+=this.m_invIB*r.cross(this.m_rB,c),this.m_bodyA.c_velocity.v.set(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.set(s),this.m_bodyB.c_velocity.w=o},l.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,h=this.m_bodyB.c_position.a,m=a.neo(i),c=a.neo(h),l=a.mulSub(m,this.m_localAnchorA,this.m_localCenterA),_=a.mulSub(c,this.m_localAnchorB,this.m_localCenterB),u=r.sub(r.add(s,_),r.add(e,l)),p=u.normalize()-this.m_length;p=n.clamp(p,-o.maxLinearCorrection,o.maxLinearCorrection);var d=-this.m_mass*p,y=r.mul(d,u);return e.subMul(this.m_invMassA,y),i-=this.m_invIA*r.cross(l,y),s.addMul(this.m_invMassB,y),h+=this.m_invIB*r.cross(_,y),this.m_bodyA.c_position.c.set(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.set(s),this.m_bodyB.c_position.a=h,n.abs(p)<o.linearSlop}},9753:function(t,e,i){"undefined"!=typeof DEBUG&&DEBUG,"undefined"!=typeof ASSERT&&ASSERT,t.exports=function(){this.v=s.zero(),this.w=0};var s=i(4474)}},e={};function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}!function(){"use strict";var t=i(5080);class e{constructor(){this.world=null,this.runner=null,this.ground=null,this.hurdle=null,this.finishLine=null,this.forces={leftThigh:!1,rightThigh:!1,leftCalf:!1,rightCalf:!1},this.runnerState={distance:0,hasFallen:!1,position:{x:0,y:0},velocity:{x:0,y:0}},this.scale=30,this.gravity=9.81,this.timeStep=1/60,this.runnerParts={},this.joints={}}async init(){try{this.world=new t.World({gravity:t.Vec2(0,-this.gravity)}),this.createGround(),this.createHurdle(),this.createFinishLine(),this.createRunner(),console.log("Physics Engine initialized successfully")}catch(t){throw console.error("Failed to initialize Physics Engine:",t),t}}createGround(){const e=t.Box(100,1);this.ground=this.world.createBody({type:"static",position:t.Vec2(0,-.5)}),this.ground.createFixture({shape:e,density:0,friction:.8,restitution:.1})}createHurdle(){const e=t.Box(.5,1);this.hurdle=this.world.createBody({type:"static",position:t.Vec2(50,.5)}),this.hurdle.createFixture({shape:e,density:0,friction:.3,restitution:.2})}createFinishLine(){const e=t.Box(.1,2);this.finishLine=this.world.createBody({type:"static",position:t.Vec2(100,1)}),this.finishLine.createFixture({shape:e,density:0,friction:0,restitution:0,isSensor:!0})}createRunner(){this.runnerParts={head:this.createBodyPart(.3,.3,.5,1.8,.5),torso:this.createBodyPart(.4,.6,.5,1.2,1),leftThigh:this.createBodyPart(.15,.4,.3,.8,.8),rightThigh:this.createBodyPart(.15,.4,.7,.8,.8),leftCalf:this.createBodyPart(.12,.35,.3,.4,.6),rightCalf:this.createBodyPart(.12,.35,.7,.4,.6),leftFoot:this.createBodyPart(.2,.1,.3,.05,.1),rightFoot:this.createBodyPart(.2,.1,.7,.05,.1)},this.joints={neck:this.createJoint(this.runnerParts.head,this.runnerParts.torso,.5,1.5),leftHip:this.createJoint(this.runnerParts.torso,this.runnerParts.leftThigh,.3,.8),rightHip:this.createJoint(this.runnerParts.torso,this.runnerParts.rightThigh,.7,.8),leftKnee:this.createJoint(this.runnerParts.leftThigh,this.runnerParts.leftCalf,.3,.4),rightKnee:this.createJoint(this.runnerParts.rightThigh,this.runnerParts.rightCalf,.7,.4),leftAnkle:this.createJoint(this.runnerParts.leftCalf,this.runnerParts.leftFoot,.3,.05),rightAnkle:this.createJoint(this.runnerParts.rightCalf,this.runnerParts.rightFoot,.7,.05)},this.setupJointLimits()}createBodyPart(e,i,s,o,n=1){const r=t.Box(e/2,i/2),a=this.world.createBody({type:"dynamic",position:t.Vec2(s,o),fixedRotation:!1});return a.createFixture({shape:r,density:n,friction:.3,restitution:.1}),a}createJoint(e,i,s,o){return this.world.createJoint(t.RevoluteJoint({bodyA:e,bodyB:i,localAnchorA:t.Vec2(0,0),localAnchorB:t.Vec2(0,0),referenceAngle:0,enableLimit:!0,lowerAngle:-Math.PI/2,upperAngle:Math.PI/2}))}setupJointLimits(){this.joints.leftHip.setLimits(-Math.PI/3,Math.PI/3),this.joints.rightHip.setLimits(-Math.PI/3,Math.PI/3),this.joints.leftKnee.setLimits(-Math.PI/6,Math.PI/2),this.joints.rightKnee.setLimits(-Math.PI/6,Math.PI/2),this.joints.leftAnkle.setLimits(-Math.PI/4,Math.PI/4),this.joints.rightAnkle.setLimits(-Math.PI/4,Math.PI/4),this.joints.neck.setLimits(-Math.PI/6,Math.PI/6)}update(t){this.world.step(this.timeStep),this.updateRunnerState(),this.applyForces()}updateRunnerState(){const t=this.runnerParts.torso.getPosition(),e=this.runnerParts.torso.getLinearVelocity();this.runnerState.distance=Math.max(0,t.x),this.runnerState.position={x:t.x,y:t.y},this.runnerState.velocity={x:e.x,y:e.y},this.runnerState.hasFallen=this.checkIfFallen()}checkIfFallen(){const t=this.runnerParts.head.getPosition(),e=this.runnerParts.torso.getPosition();return t.y<.5||e.y<.3}applyForces(){this.forces.leftThigh?(this.joints.leftHip.setMotorSpeed(2),this.joints.leftHip.setMaxMotorTorque(20),this.joints.leftHip.enableMotor(!0)):this.joints.leftHip.enableMotor(!1),this.forces.rightThigh?(this.joints.rightHip.setMotorSpeed(2),this.joints.rightHip.setMaxMotorTorque(20),this.joints.rightHip.enableMotor(!0)):this.joints.rightHip.enableMotor(!1),this.forces.leftCalf?(this.joints.leftKnee.setMotorSpeed(-1),this.joints.leftKnee.setMaxMotorTorque(20),this.joints.leftKnee.enableMotor(!0)):this.joints.leftKnee.enableMotor(!1),this.forces.rightCalf?(this.joints.rightKnee.setMotorSpeed(-1),this.joints.rightKnee.setMaxMotorTorque(20),this.joints.rightKnee.enableMotor(!0)):this.joints.rightKnee.enableMotor(!1)}applyLeftThighForce(){this.forces.leftThigh=!0}applyRightThighForce(){this.forces.rightThigh=!0}applyLeftCalfForce(){this.forces.leftCalf=!0}applyRightCalfForce(){this.forces.rightCalf=!0}stopLeftThighForce(){this.forces.leftThigh=!1}stopRightThighForce(){this.forces.rightThigh=!1}stopLeftCalfForce(){this.forces.leftCalf=!1}stopRightCalfForce(){this.forces.rightCalf=!1}getRunnerState(){return{...this.runnerState,world:this.world,bodyParts:this.runnerParts}}getAllBodyParts(){return this.runnerParts}getAllJoints(){return this.joints}getWorld(){return this.world}reset(){this.forces={leftThigh:!1,rightThigh:!1,leftCalf:!1,rightCalf:!1},this.runnerState={distance:0,hasFallen:!1,position:{x:0,y:0},velocity:{x:0,y:0}};const e={head:{x:.5,y:1.8},torso:{x:.5,y:1.2},leftThigh:{x:.3,y:.8},rightThigh:{x:.7,y:.8},leftCalf:{x:.3,y:.4},rightCalf:{x:.7,y:.4},leftFoot:{x:.3,y:.05},rightFoot:{x:.7,y:.05}};Object.keys(this.runnerParts).forEach(i=>{const s=this.runnerParts[i],o=e[i];s.setPosition(t.Vec2(o.x,o.y)),s.setLinearVelocity(t.Vec2(0,0)),s.setAngularVelocity(0)}),Object.values(this.joints).forEach(t=>{t.enableMotor(!1)})}destroy(){this.world&&(this.world.clear(),this.world=null),this.runnerParts={},this.joints={},console.log("Physics Engine destroyed")}}class s{constructor(){this.canvas=null,this.ctx=null,this.scale=30,this.camera={x:0,y:0,width:800,height:400},this.colors={background:"#87CEEB",ground:"#8B4513",runner:{head:"#FFB6C1",torso:"#FF6B6B",thigh:"#FF8C00",calf:"#FFA500",foot:"#8B4513"},hurdle:"#FF4500",finishLine:"#32CD32",track:"#90EE90"}}init(){if(this.canvas=document.getElementById("game-canvas"),!this.canvas)throw new Error("Canvas element not found");this.ctx=this.canvas.getContext("2d"),this.setupCanvas(),console.log("Renderer initialized successfully")}setupCanvas(){this.canvas.width=800,this.canvas.height=400,this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high"}render(t){this.clear(),console.log("Rendering frame:",t),this.updateCamera(t),this.ctx.save(),this.ctx.translate(-this.camera.x,0),this.drawBackground(),this.drawTrack(),this.drawHurdle(),this.drawFinishLine(),this.drawRunner(t),this.drawDistanceMarkers(),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}updateCamera(t){const e=t.position.x*this.scale-this.canvas.width/2;this.camera.x=Math.max(0,e)}drawBackground(){const t=this.ctx.createLinearGradient(0,0,0,this.canvas.height);t.addColorStop(0,"#87CEEB"),t.addColorStop(1,"#98FB98"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width+this.camera.x,this.canvas.height)}drawTrack(){const t=this.canvas.height-50;this.ctx.fillStyle=this.colors.track,this.ctx.fillRect(0,t,this.canvas.width+this.camera.x,50),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=2,this.ctx.setLineDash([5,5]);for(let e=0;e<=100;e+=10){const i=e*this.scale;this.ctx.beginPath(),this.ctx.moveTo(i,t),this.ctx.lineTo(i,t+50),this.ctx.stroke()}this.ctx.setLineDash([])}drawHurdle(){const t=50*this.scale,e=this.canvas.height-100;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t+2,e+2,15,30),this.ctx.fillStyle=this.colors.hurdle,this.ctx.fillRect(t,e,15,30),this.ctx.strokeStyle="#8B0000",this.ctx.lineWidth=2,this.ctx.strokeRect(t,e,15,30)}drawFinishLine(){const t=100*this.scale,e=this.canvas.height-80;this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.fillRect(t+2,e+2,5,60),this.ctx.fillStyle=this.colors.finishLine,this.ctx.fillRect(t,e,5,60),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=1;for(let i=0;i<60;i+=10)this.ctx.beginPath(),this.ctx.moveTo(t,e+i),this.ctx.lineTo(t+5,e+i),this.ctx.stroke()}drawRunner(t){const e=t.world,i=t.bodyParts;if(console.log("Drawing runner:",{world:!!e,bodyParts:!!i,position:t.position}),!e||!i)return console.log("Using mock runner"),void this.drawMockRunner(t);Object.keys(i).forEach(t=>{const e=i[t],s=e.getPosition(),o=e.getAngle();this.drawBodyPart(t,s,o)})}drawMockRunner(t){const e=t.position.x*this.scale,i=this.canvas.height-150-t.position.y*this.scale;this.ctx.fillStyle=this.colors.runner.head,this.ctx.beginPath(),this.ctx.arc(e,i-40,15,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=this.colors.runner.torso,this.ctx.fillRect(e-20,i-20,40,40),this.ctx.fillStyle=this.colors.runner.thigh,this.ctx.fillRect(e-30,i-10,10,30),this.ctx.fillRect(e+20,i-10,10,30),this.ctx.fillStyle=this.colors.runner.calf,this.ctx.fillRect(e-15,i+20,8,25),this.ctx.fillRect(e+7,i+20,8,25),this.ctx.fillStyle=this.colors.runner.foot,this.ctx.fillRect(e-20,i+45,12,5),this.ctx.fillRect(e+8,i+45,12,5)}drawBodyPart(t,e,i){const s=e.x*this.scale,o=this.canvas.height-50-e.y*this.scale;this.ctx.save(),this.ctx.translate(s,o),this.ctx.rotate(i);let n=this.colors.runner.torso,r=20,a=30;switch(t){case"head":n=this.colors.runner.head,r=15,a=15;break;case"torso":n=this.colors.runner.torso,r=20,a=30;break;case"leftThigh":case"rightThigh":n=this.colors.runner.thigh,r=8,a=20;break;case"leftCalf":case"rightCalf":n=this.colors.runner.calf,r=6,a=18;break;case"leftFoot":case"rightFoot":n=this.colors.runner.foot,r=12,a=3}this.ctx.fillStyle=n,this.ctx.fillRect(-r/2,-a/2,r,a),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=1,this.ctx.strokeRect(-r/2,-a/2,r,a),this.ctx.restore()}drawDistanceMarkers(){this.ctx.fillStyle="#000000",this.ctx.font="12px Arial",this.ctx.textAlign="center";for(let t=0;t<=100;t+=10){const e=t*this.scale,i=this.canvas.height-10;this.ctx.fillText(`${t}m`,e,i)}}handleResize(){const t=this.canvas.parentElement;if(!t)return;const e=t.getBoundingClientRect();this.canvas.width=e.width,this.canvas.height=e.height,this.camera.width=this.canvas.width,this.camera.height=this.canvas.height,console.log("Canvas resized to:",this.canvas.width,"x",this.canvas.height)}worldToScreen(t){return{x:t.x*this.scale,y:this.canvas.height-t.y*this.scale}}screenToWorld(t){return{x:t.x/this.scale,y:(this.canvas.height-t.y)/this.scale}}getContext(){return this.ctx}getCanvas(){return this.canvas}setScale(t){this.scale=t}getScale(){return this.scale}destroy(){this.canvas=null,this.ctx=null,console.log("Renderer destroyed")}}class o{constructor(t,e,i){this.screenManager=t,this.firebaseService=e,this.inputManager=i,this.physicsEngine=null,this.renderer=null,this.gameState={isRunning:!1,isPaused:!1,currentDistance:0,finalDistance:0,gameStartTime:0,lastUpdateTime:0},this.playerData={name:"",email:""},this.animationId=null}async init(){try{this.physicsEngine=new e,await this.physicsEngine.init(),this.renderer=new s,this.renderer.init(),this.inputManager.onKeyPress(t=>{this.handleKeyPress(t)}),this.inputManager.onKeyRelease(t=>{this.handleKeyRelease(t)}),console.log("Game Manager initialized successfully")}catch(t){throw console.error("Failed to initialize Game Manager:",t),t}}startGame(){try{console.log("Starting new game..."),console.log("GameManager state:",this.gameState),console.log("PhysicsEngine available:",!!this.physicsEngine),console.log("Renderer available:",!!this.renderer),this.gameState.isRunning=!0,this.gameState.isPaused=!1,this.gameState.currentDistance=0,this.gameState.finalDistance=0,this.gameState.gameStartTime=Date.now(),this.gameState.lastUpdateTime=performance.now(),this.physicsEngine.reset(),this.inputManager.reset(),this.screenManager.showScreen("game-screen"),this.startGameLoop(),console.log("Game started successfully")}catch(t){console.error("Failed to start game:",t),this.screenManager.showError("Fehler beim Spielstart")}}resetGame(){this.gameState.isRunning&&this.startGame()}pauseGame(){this.gameState.isRunning&&!this.gameState.isPaused&&(this.gameState.isPaused=!0,console.log("Game paused"))}resumeGame(){this.gameState.isRunning&&this.gameState.isPaused&&(this.gameState.isPaused=!1,this.gameState.lastUpdateTime=performance.now(),console.log("Game resumed"))}stopGame(){this.gameState.isRunning=!1,this.gameState.isPaused=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),console.log("Game stopped")}startGameLoop(){console.log("Starting game loop...");const t=e=>{if(!this.gameState.isRunning)return;if(this.gameState.isPaused)return void(this.animationId=requestAnimationFrame(t));const i=e-this.gameState.lastUpdateTime;this.gameState.lastUpdateTime=e,this.physicsEngine.update(i),this.updateDistance(),this.renderer.render(this.physicsEngine.getRunnerState()),this.checkGameEnd()?this.endGame():this.animationId=requestAnimationFrame(t)};this.animationId=requestAnimationFrame(t)}updateDistance(){const t=this.physicsEngine.getRunnerState();this.gameState.currentDistance=t.distance,this.screenManager.updateDistance(this.gameState.currentDistance)}checkGameEnd(){const t=this.physicsEngine.getRunnerState();return!!t.hasFallen||t.distance>=100}endGame(){console.log("Game ended"),this.stopGame(),this.gameState.finalDistance=this.gameState.currentDistance,this.screenManager.updateDistance(this.gameState.finalDistance),this.screenManager.updateResultMessage(this.gameState.finalDistance),this.screenManager.showScreen("game-over-screen")}handleKeyPress(t){if(this.gameState.isRunning&&!this.gameState.isPaused)switch(t){case"q":this.physicsEngine.applyLeftThighForce();break;case"w":this.physicsEngine.applyRightThighForce();break;case"o":this.physicsEngine.applyLeftCalfForce();break;case"p":this.physicsEngine.applyRightCalfForce()}}handleKeyRelease(t){if(this.gameState.isRunning&&!this.gameState.isPaused)switch(t){case"q":this.physicsEngine.stopLeftThighForce();break;case"w":this.physicsEngine.stopRightThighForce();break;case"o":this.physicsEngine.stopLeftCalfForce();break;case"p":this.physicsEngine.stopRightCalfForce()}}async showHighscores(){try{this.screenManager.showLoading("Lade Highscores...");const t=await this.firebaseService.getHighscores(20);this.screenManager.updateHighscoresList(t),this.screenManager.hideLoading(),this.screenManager.showScreen("highscores-screen")}catch(t){console.error("Failed to load highscores:",t),this.screenManager.hideLoading(),this.screenManager.showError("Fehler beim Laden der Highscores")}}async submitScore(){try{const t=this.screenManager.getFormData();if(!t.name||!t.email)return void this.screenManager.showError("Bitte fülle alle Felder aus");if(!this.firebaseService.validateEmail(t.email))return void this.screenManager.showError("Bitte gib eine gültige E-Mail-Adresse ein");if(!this.firebaseService.validateName(t.name))return void this.screenManager.showError("Name muss zwischen 2 und 50 Zeichen lang sein");this.playerData.name=t.name,this.playerData.email=t.email,this.screenManager.showLoading("Score wird eingetragen...");const e=await this.firebaseService.submitScore({name:t.name,email:t.email,distance:this.gameState.finalDistance});this.screenManager.hideLoading(),e.success?e.updated?this.screenManager.showSuccess("Score erfolgreich eingetragen!"):this.screenManager.showSuccess("Score nicht besser als dein bisheriger Rekord"):this.screenManager.showError("Fehler beim Eintragen des Scores")}catch(t){console.error("Failed to submit score:",t),this.screenManager.hideLoading(),this.screenManager.showError("Fehler beim Eintragen des Scores")}}handleResize(){this.renderer&&this.renderer.handleResize(),this.inputManager&&this.inputManager.updateButtonPositions()}isGameRunning(){return this.gameState.isRunning}isGamePaused(){return this.gameState.isPaused}getCurrentDistance(){return this.gameState.currentDistance}getFinalDistance(){return this.gameState.finalDistance}getGameState(){return{...this.gameState}}loadPlayerData(){try{const t=localStorage.getItem("qwop_player_name"),e=localStorage.getItem("qwop_player_email");t&&e&&(this.playerData.name=t,this.playerData.email=e,this.screenManager.setFormData(t,e))}catch(t){console.warn("Failed to load player data:",t)}}savePlayerData(){try{this.playerData.name&&localStorage.setItem("qwop_player_name",this.playerData.name),this.playerData.email&&localStorage.setItem("qwop_player_email",this.playerData.email)}catch(t){console.warn("Failed to save player data:",t)}}destroy(){this.stopGame(),this.physicsEngine&&this.physicsEngine.destroy(),this.renderer&&this.renderer.destroy(),console.log("Game Manager destroyed")}}class n{constructor(){this.currentScreen=null,this.screens={}}init(){document.querySelectorAll(".screen").forEach(t=>{const e=t.id;this.screens[e]=t}),console.log("Screen Manager initialized with screens:",Object.keys(this.screens))}showScreen(t){this.currentScreen&&this.currentScreen.classList.remove("active");const e=this.screens[t];e?(e.classList.add("active"),this.currentScreen=e,console.log(`Switched to screen: ${t}`)):console.error(`Screen not found: ${t}`)}getCurrentScreen(){return this.currentScreen?this.currentScreen.id:null}isScreenActive(t){const e=this.screens[t];return e&&e.classList.contains("active")}updateDistance(t){const e=document.getElementById("distance"),i=document.getElementById("final-distance");e&&(e.textContent=`${t.toFixed(1)}m`),i&&(i.textContent=`${t.toFixed(1)}m`)}updateResultMessage(t,e=!1){const i=document.getElementById("result-message");if(i){let e="",s="";t>=100?(e="🎉 Ziel erreicht! Du hast es geschafft! 🎉",s="success"):t>=50?(e=`Gut gemacht! Du hast ${t.toFixed(1)}m erreicht!`,s="success"):t>=10?(e=`Nicht schlecht! ${t.toFixed(1)}m sind ein guter Start!`,s="success"):(e="Das war knapp! Versuche es noch einmal!",s="failure"),i.textContent=e,i.className=`result-message ${s}`}}updateHighscoresList(t){const e=document.getElementById("highscores-list");if(e){if(e.innerHTML="",0===t.length)return void(e.innerHTML="<p>Noch keine Scores vorhanden. Sei der Erste!</p>");t.forEach((t,i)=>{const s=i+1,o=new Date(t.timestamp).toLocaleDateString("de-DE"),n=document.createElement("div");n.className="highscore-item",n.innerHTML=`\n                    <span class="highscore-rank">#${s}</span>\n                    <span class="highscore-name">${this.escapeHtml(t.name)}</span>\n                    <span class="highscore-distance">${t.distance.toFixed(1)}m</span>\n                    <span class="highscore-date">${o}</span>\n                `,e.appendChild(n)})}}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}getFormData(){const t=document.getElementById("player-name"),e=document.getElementById("player-email");return{name:t?t.value.trim():"",email:e?e.value.trim():""}}setFormData(t,e){const i=document.getElementById("player-name"),s=document.getElementById("player-email");i&&t&&(i.value=t),s&&e&&(s.value=e)}clearFormData(){const t=document.getElementById("player-name"),e=document.getElementById("player-email");t&&(t.value=""),e&&(e.value="")}showLoading(t="Lade..."){const e=document.getElementById("loading-screen");if(e){const i=e.querySelector(".loading-content p");i&&(i.textContent=t),e.classList.add("active")}}hideLoading(){const t=document.getElementById("loading-screen");t&&t.classList.remove("active")}showError(t){const e=this.getCurrentScreen();if(e&&this.screens[e]){const e=document.createElement("div");e.className="error-message",e.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    left: 50%;\n                    transform: translateX(-50%);\n                    background: rgba(255, 71, 87, 0.9);\n                    color: white;\n                    padding: 10px 20px;\n                    border-radius: 5px;\n                    z-index: 1000;\n                    font-weight: bold;\n                ",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},3e3)}}showSuccess(t){const e=this.getCurrentScreen();if(e&&this.screens[e]){const e=document.createElement("div");e.className="success-message",e.style.cssText="\n                    position: fixed;\n                    top: 20px;\n                    left: 50%;\n                    transform: translateX(-50%);\n                    background: rgba(46, 213, 115, 0.9);\n                    color: white;\n                    padding: 10px 20px;\n                    border-radius: 5px;\n                    z-index: 1000;\n                    font-weight: bold;\n                ",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},3e3)}}}const r={apiKey:"your-api-key",authDomain:"your-project.firebaseapp.com",projectId:"your-project-id",storageBucket:"your-project.appspot.com",messagingSenderId:"your-messaging-sender-id",appId:"your-app-id"};class a{constructor(){this.db=null,this.isInitialized=!1,this.config=r}async init(){try{if("undefined"==typeof firebase)return console.warn("Firebase not available, using mock mode"),void this.setupMockMode();firebase.apps.length||firebase.initializeApp(this.config),this.db=firebase.firestore(),this.isInitialized=!0,console.log("Firebase Service initialized successfully")}catch(t){console.error("Failed to initialize Firebase:",t),this.setupMockMode()}}setupMockMode(){console.log("Setting up mock Firebase service"),this.isInitialized=!1,this.mockData={scores:[{name:"Test Player",email:"test@example.com",distance:85.5,timestamp:Date.now()-864e5},{name:"Demo User",email:"demo@example.com",distance:67.2,timestamp:Date.now()-1728e5},{name:"QWOP Master",email:"master@example.com",distance:45.8,timestamp:Date.now()-2592e5}]}}async submitScore(t){try{if(!this.isInitialized)return this.submitScoreMock(t);const{name:e,email:i,distance:s}=t;if(!e||!i||"number"!=typeof s)throw new Error("Invalid score data");if(s<0||s>100)throw new Error("Invalid distance value");const o={name:e.trim(),email:i.trim().toLowerCase(),distance:parseFloat(s.toFixed(1)),timestamp:Date.now()},n=await this.getScoreByEmail(i);if(n)return s>n.distance?(await this.db.collection("scores").doc(n.id).update(o),console.log("Updated existing score"),{success:!0,updated:!0,score:o}):(console.log("New score not better than existing score"),{success:!0,updated:!1,score:n});{const t=await this.db.collection("scores").add(o);return console.log("Added new score with ID:",t.id),{success:!0,updated:!0,score:{...o,id:t.id}}}}catch(t){throw console.error("Error submitting score:",t),t}}async getHighscores(t=10){try{if(!this.isInitialized)return this.getHighscoresMock(t);const e=await this.db.collection("scores").orderBy("distance","desc").limit(t).get(),i=[];return e.forEach(t=>{i.push({id:t.id,...t.data()})}),i}catch(t){throw console.error("Error getting highscores:",t),t}}async getScoreByEmail(t){try{if(!this.isInitialized)return this.getScoreByEmailMock(t);const e=await this.db.collection("scores").where("email","==",t.toLowerCase()).limit(1).get();if(!e.empty){const t=e.docs[0];return{id:t.id,...t.data()}}return null}catch(t){return console.error("Error getting score by email:",t),null}}async getPlayerRank(t){try{if(!this.isInitialized)return this.getPlayerRankMock(t);const e=await this.getScoreByEmail(t);return e?(await this.db.collection("scores").where("distance",">",e.distance).get()).size+1:null}catch(t){return console.error("Error getting player rank:",t),null}}submitScoreMock(t){const{name:e,email:i,distance:s}=t,o=this.mockData.scores.findIndex(t=>t.email.toLowerCase()===i.toLowerCase()),n={name:e.trim(),email:i.trim().toLowerCase(),distance:parseFloat(s.toFixed(1)),timestamp:Date.now()};return-1!==o?s>this.mockData.scores[o].distance?(this.mockData.scores[o]=n,console.log("Updated existing score (mock)"),{success:!0,updated:!0,score:n}):(console.log("New score not better than existing score (mock)"),{success:!0,updated:!1,score:this.mockData.scores[o]}):(this.mockData.scores.push(n),console.log("Added new score (mock)"),{success:!0,updated:!0,score:n})}getHighscoresMock(t=10){return[...this.mockData.scores].sort((t,e)=>e.distance-t.distance).slice(0,t)}getScoreByEmailMock(t){return this.mockData.scores.find(e=>e.email.toLowerCase()===t.toLowerCase())||null}getPlayerRankMock(t){const e=this.getScoreByEmailMock(t);return e?this.mockData.scores.filter(t=>t.distance>e.distance).length+1:null}validateEmail(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)}validateName(t){return t&&t.trim().length>=2&&t.trim().length<=50}sanitizeInput(t){return t.trim().replace(/[<>]/g,"")}isConnected(){return this.isInitialized}getMockData(){return this.mockData}clearMockData(){this.mockData={scores:[]}}}class h{constructor(){this.keys={q:!1,w:!1,o:!1,p:!1},this.touchActive=!1,this.controlButtons={},this.callbacks={onKeyPress:null,onKeyRelease:null}}init(){this.setupControlButtons(),this.setupEventListeners(),console.log("Input Manager initialized")}setupControlButtons(){["q-btn","w-btn","o-btn","p-btn"].forEach(t=>{const e=document.getElementById(t);if(e){const t=e.dataset.key;this.controlButtons[t]=e}})}setupEventListeners(){Object.keys(this.controlButtons).forEach(t=>{const e=this.controlButtons[t];e.addEventListener("mousedown",e=>{e.preventDefault(),this.pressKey(t)}),e.addEventListener("mouseup",e=>{e.preventDefault(),this.releaseKey(t)}),e.addEventListener("mouseleave",e=>{e.preventDefault(),this.releaseKey(t)})}),Object.keys(this.controlButtons).forEach(t=>{const e=this.controlButtons[t];e.addEventListener("touchstart",e=>{e.preventDefault(),this.touchActive=!0,this.pressKey(t)}),e.addEventListener("touchend",e=>{e.preventDefault(),this.touchActive=!1,this.releaseKey(t)}),e.addEventListener("touchcancel",e=>{e.preventDefault(),this.touchActive=!1,this.releaseKey(t)})}),document.addEventListener("keydown",t=>{const e=t.key.toLowerCase();this.keys.hasOwnProperty(e)&&(t.preventDefault(),this.pressKey(e))}),document.addEventListener("keyup",t=>{const e=t.key.toLowerCase();this.keys.hasOwnProperty(e)&&(t.preventDefault(),this.releaseKey(e))}),document.addEventListener("touchstart",t=>{t.target.classList.contains("control-btn")&&t.preventDefault()},{passive:!1}),document.addEventListener("touchmove",t=>{t.target.classList.contains("control-btn")&&t.preventDefault()},{passive:!1}),window.addEventListener("blur",()=>{this.releaseAllKeys()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.releaseAllKeys()})}pressKey(t){this.keys.hasOwnProperty(t)&&!this.keys[t]&&(this.keys[t]=!0,this.updateButtonVisual(t,!0),this.callbacks.onKeyPress&&this.callbacks.onKeyPress(t),console.log(`Key pressed: ${t}`))}releaseKey(t){this.keys.hasOwnProperty(t)&&this.keys[t]&&(this.keys[t]=!1,this.updateButtonVisual(t,!1),this.callbacks.onKeyRelease&&this.callbacks.onKeyRelease(t),console.log(`Key released: ${t}`))}releaseAllKeys(){Object.keys(this.keys).forEach(t=>{this.keys[t]&&this.releaseKey(t)})}updateButtonVisual(t,e){const i=this.controlButtons[t];i&&(e?i.classList.add("active"):i.classList.remove("active"))}isKeyPressed(t){return this.keys[t]||!1}getPressedKeys(){return Object.keys(this.keys).filter(t=>this.keys[t])}onKeyPress(t){this.callbacks.onKeyPress=t}onKeyRelease(t){this.callbacks.onKeyRelease=t}getInputState(){return{...this.keys}}reset(){this.releaseAllKeys(),this.touchActive=!1}isAnyKeyPressed(){return Object.values(this.keys).some(t=>t)}getActiveKeysCount(){return Object.values(this.keys).filter(t=>t).length}simulateKeyPress(t){this.pressKey(t)}simulateKeyRelease(t){this.releaseKey(t)}isTouchActive(){return this.touchActive}getButton(t){return this.controlButtons[t]||null}updateButtonPositions(){const t=document.getElementById("game-canvas");t&&(t.getBoundingClientRect(),Object.keys(this.controlButtons).forEach(t=>{const e=this.controlButtons[t];if(e){const t=e.getBoundingClientRect();t.left<0&&(e.style.left="10px"),t.right>window.innerWidth&&(e.style.right="10px"),t.top<0&&(e.style.top="10px"),t.bottom>window.innerHeight&&(e.style.bottom="10px")}}))}}class m{constructor(){this.gameManager=null,this.screenManager=null,this.firebaseService=null,this.inputManager=null,this.isInitialized=!1}async init(){try{console.log("Initializing QWOP Multiplayer Game..."),this.showLoadingScreen(),this.firebaseService=new a,await this.firebaseService.init(),this.screenManager=new n,this.screenManager.init(),this.inputManager=new h,this.inputManager.init(),this.gameManager=new o(this.screenManager,this.firebaseService,this.inputManager),await this.gameManager.init(),this.setupEventListeners(),this.hideLoadingScreen(),this.screenManager.showScreen("start-screen"),setTimeout(()=>{console.log("Auto-starting game for testing...");try{this.gameManager.startGame(),console.log("Auto-start completed successfully")}catch(t){console.error("Auto-start failed:",t)}},2e3),this.isInitialized=!0,console.log("QWOP Game initialized successfully!")}catch(t){console.error("Failed to initialize QWOP Game:",t),this.showErrorScreen(t.message)}}showLoadingScreen(){const t=document.getElementById("loading-screen");t&&t.classList.add("active")}hideLoadingScreen(){const t=document.getElementById("loading-screen");t&&t.classList.remove("active")}showErrorScreen(t){const e=document.getElementById("loading-screen");e&&(e.classList.remove("active"),e.innerHTML=`\n                <div class="loading-content">\n                    <h2>Fehler beim Laden</h2>\n                    <p>${t}</p>\n                    <button onclick="location.reload()" class="btn btn-primary">Neu laden</button>\n                </div>\n            `,e.classList.add("active"))}setupEventListeners(){const t=document.getElementById("start-game-btn");t&&t.addEventListener("click",()=>{this.gameManager.startGame()});const e=document.getElementById("show-highscores-btn");e&&e.addEventListener("click",()=>{this.gameManager.showHighscores()});const i=document.getElementById("reset-btn");i&&i.addEventListener("click",()=>{this.gameManager.resetGame()});const s=document.getElementById("play-again-btn");s&&s.addEventListener("click",()=>{this.gameManager.startGame()});const o=document.getElementById("view-highscores-btn");o&&o.addEventListener("click",()=>{this.gameManager.showHighscores()});const n=document.getElementById("back-to-menu-btn");n&&n.addEventListener("click",()=>{this.screenManager.showScreen("start-screen")});const r=document.getElementById("play-from-highscores-btn");r&&r.addEventListener("click",()=>{this.gameManager.startGame()});const a=document.getElementById("submit-score-btn");a&&a.addEventListener("click",()=>{this.gameManager.submitScore()}),window.addEventListener("resize",()=>{this.gameManager&&this.gameManager.isGameRunning()&&this.gameManager.handleResize()}),window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.gameManager&&this.gameManager.isGameRunning()&&this.gameManager.handleResize()},100)});const h=document.getElementById("game-canvas");h&&h.addEventListener("contextmenu",t=>{t.preventDefault()}),document.addEventListener("visibilitychange",()=>{this.gameManager&&this.gameManager.isGameRunning()&&(document.hidden?this.gameManager.pauseGame():this.gameManager.resumeGame())})}static getInstance(){return m.instance||(m.instance=new m),m.instance}}document.addEventListener("DOMContentLoaded",async()=>{const t=m.getInstance();await t.init()}),window.QWOPGame=m}()}();
//# sourceMappingURL=bundle.js.map